**编译器**（compiler）是将编程语言的代码转换为其他形式的软件。这 种转换操作就称为**编译**（compile）。

下面从头开始制作一门语言 Cb 的编译器。通过实际地设计、制作编译器，使读者对编译器产生具体、深刻的认 识。这样通过实践获得的知识，在其他语言的编译器上也是通用的。

Cb是C语言的子集。C 语言的编译器无论写起来还是读起来都非常难，所以最终放弃了。

使用Cb编译器编译出的程序，是在Linux平台上运行的。

## 编译示例
1.1 hello.c
```c
#include <stdio.c>
int main(int argc, char **argv) { 
	printf("Hello, World!\n"); /* 打个招呼 */ 
	return 0; 
}
```
`gcc hello.c -o hello` 生成名为 hello 的**可执行文件** *executable file* 。
运行刚才生成的 hello 命令，用 `./hello` 。

## 可执行文件
GCC生成的可执行文件是什么？

现代Linux上的可执行文件，通常是指符合 *ELF, Executable and Linking Format* 这种特定形式的文件。`ls, cp` 这些**命令**（command）对应的实体文件都是可执行文件，例如 `/bin/ls` 和 `/bin/cp` 等。

使用 `file` 命令，能查看文件是否符合ELF的形式。要查看 `/bin/ls` 文件是不是 ELF，在 shell 中输入如下命令即可：
```shell
$ file /bin/ls 
/bin/ls: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), for GNU/Linux 2.4.1, dynamically linked (uses shared libs), for GNU/Linux 2.4.1, stripped
```
如果像这样显示 ELF......executable，就表示该文件为 ELF 的可执行文件。根据所使用的 Linux 机器的不同，可能显示 ELF 64-bit，也可能显示 ELF 32-bit MSB，这些都是 ELF 的可执行文件。

ELF 文件中包含了程序（**代码**）以及如何运行该程序的相关信息（**元数据**）。程序（代码） 就是**机器语言**（machine language）的列表。机器语言是唯一一种 CPU 能直接执行的语言，不同种类的 CPU 使用不同的机器语言，互相不能运行彼此的机器语言。

GCC 将 C 语言的程序转化为用机器语言（例如 486 的机器语言）描述的**程序**。==将机器语言的程序按照 **ELF 这种特定的文件格式**注入文件，得到的就是**可执行文件**==。

## 编译
gcc命令从 `hello.c` 这样的单个文件来生成可执行文件时，虽然只需执行一次 gcc 命令，但实际上其内部经历了如下 4 个阶段的处理（这四个阶段统称为 `build` ）：
1. 预处理：C 语言代码首先由**预处理器**（preprocessor）对 `#include` 和 `#define` 进行处理。具体来说，读入头文件，将所有的宏展开，这就是**预处理**（preprocess），在编译之前的处理。==预处理的内容近似于 sed 命令和 awk 命令这样的纯文本操作，不考虑 C 语言语法的含义==。
2. （狭义）编译，是真正意义上的编译。之后所提到的编译，指的就是狭义的编译。**编译器**对预处理器的输出进行编译，生成**汇编语言**（assemble language）的代码。一 般来说，汇编语言的代码的文件扩展名是 `.s` 。汇编语言是由机器语言转换过来的、人类较易阅读的文本形式的语言，与机器语言直接对应，方便人类理解。
3. 汇编。汇编语言的代码由**汇编器**（assembler）转换为机器语言，这个处理过程称为**汇编** （assemble）。 汇编器的输出称为**目标文件**（object file）。一般来说，目标文件的扩展名是 `.o` 。
	 > Linux 中，目标文件也是 ELF 文件。既然都是 ELF 文件，那究竟是目标文件还是可执行文件呢？这不是区分不了吗？不用担心。**ELF 文件中有用于提示文件种类的标志**。用 file 命令来查看目标文件，会像下面这样显示 ELF...relocatable ，据此就能够将其和 可执行文件区分开：
	 > ```shell
	 > $ file t.o 
	 > t.o: ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
	 > ```
4. 链接。目标文件本身不能之间使用，无论是**直接运行**还是作为**程序库**（library）文件调用都不可以。将目标文件转换为最终可用的形式的处理称为**链接**（link）。如果用了程序库，会在这个阶段处理程序库的加载。
	假设 Hello,World! 程序经过编译和汇编生成了目标文件 hello.o，链接 hello.o 即可生成可执行文件。**生成的可执行文件的默认文件名为 a.out** ，可以使用 gcc 命令的 -o 选 项来修改输出的文件名。
	**通过链接处理生成的并不一定是可执行文件，也可以是程序库文件**。程序库文件话题将在19节中详细说明。

**build过程总结**
C 语言的代码经过预处理、编译、汇编、链接这 4 个阶段的处理，最终生成可执行文件。图 1.1 中总结了各个阶段的输出文件。