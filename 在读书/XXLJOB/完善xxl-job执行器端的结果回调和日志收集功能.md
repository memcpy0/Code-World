å¤§å®¶å¥½ï¼Œè¿™ä¸€ç« æˆ‘å°†ç»§ç»­ä¸ºå¤§å®¶è®²è§£xxl-jobçš„å¦ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯æ‰§è¡Œå™¨æ‰§è¡Œå®Œå®šæ—¶ä»»åŠ¡åçš„ç»“æœå›è°ƒï¼Œå½“ç„¶ï¼Œæ˜¯å›è°ƒç»™è°ƒåº¦ä¸­å¿ƒé‚£ä¸€ç«¯çš„ã€‚ä¹‹æ‰€ä»¥å®Œå–„è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å› ä¸ºåœ¨ä¹‹å‰è°ƒåº¦ä¸­å¿ƒè°ƒåº¦å®šæ—¶ä»»åŠ¡ä¹‹åï¼Œæ ¹æœ¬ä¸çŸ¥é“å®šæ—¶ä»»åŠ¡æ˜¯å¦è°ƒåº¦æˆåŠŸäº†ã€‚åªæœ‰æŠŠè¿™ä¸ªåŠŸèƒ½æ·»åŠ ä¸Šäº†ï¼Œè°ƒåº¦ä¸­å¿ƒçš„è°ƒåº¦æµç¨‹æ‰ç®—çœŸæ­£å®Œæ•´äº†ã€‚è°ƒåº¦ä¸­å¿ƒå‘èµ·ä»»åŠ¡è°ƒåº¦ï¼Œæ‰§è¡Œå™¨æ¥æ”¶åˆ°è°ƒåº¦ä¸­å¿ƒå‘é€è¿‡æ¥çš„è¦è°ƒåº¦çš„å®šæ—¶ä»»åŠ¡çš„ä¿¡æ¯åï¼Œå¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚å®šæ—¶ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼ŒæŠŠå®šæ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦çš„ç»“æœå›è°ƒç»™è°ƒåº¦ä¸­å¿ƒé‚£ä¸€ç«¯ã€‚è¯´æ˜¯å›è°ƒï¼Œå…¶å®å°±æ˜¯åœ¨æ‰§è¡Œå™¨é‚£ä¸€ç«¯æœ‰ä¸€ä¸ªè´Ÿè´£å›è°ƒæ‰§è¡Œç»“æœç»™è°ƒåº¦ä¸­å¿ƒçš„çº¿ç¨‹ï¼Œå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¼šè¢«å°è£…åˆ°HandleCallbackParamå¯¹è±¡ä¸­ï¼Œå›è°ƒçº¿ç¨‹å°±è´Ÿè´£æŠŠè¿™ä¸ªå¯¹è±¡é€šè¿‡httpåè®®å‘é€ç»™è°ƒåº¦ä¸­å¿ƒã€‚è€Œè°ƒåº¦ä¸­å¿ƒåœ¨æ¥æ”¶åˆ°è¿™ä¸ªç»“æœåï¼Œä¼šè¿›ä¸€æ­¥æ›´æ–°æ•°æ®åº“ä¸­å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„æ—¥å¿—ä¿¡æ¯ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯å°½å¿«çœ‹ä¸€ä¸‹ä»£ç çš„æµç¨‹å§ã€‚åœ¨çœ‹ä»£ç ä¹‹å‰ï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ä¸‹ï¼Œæœ¬ç« çš„çŸ¥è¯†ç‚¹åªæœ‰è¿™ä¸€ä¸ªï¼Œæ‰€ä»¥è®²å®Œå°±ç»“æŸäº†ï¼Œè¿™å°±æ„å‘³ç€å†…å®¹ä¸ä¼šå¤ªå¤šã€‚å¯èƒ½æ¯”å¤§å®¶æƒ³è±¡çš„è¿˜è¦çŸ­ï¼Œæ‰€ä»¥æ–‡ç« å¦‚æœç»“æŸå¾—å¾ˆå¿«ï¼Œå¤§å®¶ä¸€å®šä¸è¦ä»‹æ„ã€‚åé¢å‡ ç« éƒ½æ˜¯è¿™æ ·çš„ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æˆ‘æŠŠæ¶‰åŠåˆ°çš„åŠŸèƒ½è®²è§£ä¸€ä¸‹ï¼Œç„¶åæŠŠè¿™éƒ¨åˆ†åŠŸèƒ½åœ¨ä»£ç ä¸­çš„å®ç°ä½ç½®å±•ç¤ºä¸€ä¸‹å°±ç»“æŸäº†ã€‚å› ä¸ºç¡®å®æ²¡æœ‰ä»€ä¹ˆå¯è®²çš„å†…å®¹ã€‚

å¥½äº†ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨æ²¡æœ‰æ·»åŠ æ‰§è¡Œç»“æœå›è°ƒåŠŸèƒ½ä¹‹å‰çš„ä»£ç æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚

```
	//è¯¥æ–¹æ³•å†…è¿›è¡Œè¿œç¨‹è°ƒç”¨
    public static ReturnT<String> runExecutor(TriggerParam triggerParam, String address){
        ReturnT<String> runResult = null;
        try {
            //è·å–ä¸€ä¸ªç”¨äºè¿œç¨‹è°ƒç”¨çš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œä¸€ä¸ªåœ°å€å°±å¯¹åº”ç€ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯å®¢æˆ·ç«¯ï¼Œå› ä¸ºè¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨
            //å°±æˆä¸ºäº†æœåŠ¡ç«¯ï¼Œå› ä¸ºæ‰§è¡Œå™¨è¦æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è°ƒç”¨æ¶ˆæ¯
            ExecutorBiz executorBiz = XxlJobScheduler.getExecutorBiz(address);
            //å®¢æˆ·ç«¯è·å¾—ä¹‹åï¼Œå°±åœ¨runæ–¹æ³•å†…è¿›è¡Œè¿œç¨‹è°ƒç”¨äº†
            runResult = executorBiz.run(triggerParam);
        } catch (Exception e) {
            logger.error(">>>>>>>>>>> xxl-job trigger error, please check if the executor[{}] is running.", address, e);
            runResult = new ReturnT<String>(ReturnT.FAIL_CODE, ThrowableUtil.toString(e));
        }
        //åœ¨è¿™é‡Œæ‹¼æ¥ä¸€ä¸‹è¿œç¨‹è°ƒç”¨è¿”å›çš„çŠ¶æ€ç å’Œæ¶ˆæ¯
        StringBuffer runResultSB = new StringBuffer(I18nUtil.getString("jobconf_trigger_run") + "ï¼š");
        runResultSB.append("<br>addressï¼š").append(address);
        runResultSB.append("<br>codeï¼š").append(runResult.getCode());
        runResultSB.append("<br>msgï¼š").append(runResult.getMsg());
        runResult.setMsg(runResultSB.toString());
        return runResult;
    }
```

åœ¨XxlJobTriggerç±»çš„runExecutoræ–¹æ³•ä¸­æ‰§è¡Œè¿œç¨‹è°ƒç”¨ã€‚è€Œåœ¨æ‰§è¡Œè¿œç¨‹è°ƒç”¨ä¹‹å‰ï¼Œç¨‹åºä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼Œæ¯”å¦‚æœ¬æ¬¡æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¥å¿—ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ²¡æœ‰æ”¶é›†ï¼Œæ›´åˆ«è¯´è®°å½•åˆ°æ•°æ®åº“ä¸­äº†ã€‚è€ŒexecutorBiz.run(triggerParam)è¿™è¡Œä»£ç è¿”å›çš„ç»“æœï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œåˆ°æ‰§è¡Œå™¨é‚£ä¸€ç«¯ä¸€çœ‹ä¾¿çŸ¥ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚

```
//åœ¨è¿™ä¸ªç±»runæ–¹æ³•ä¸­è¿”å›äº†å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„ç»“æœ
public class ExecutorBizImpl implements ExecutorBiz {

     @Override
    public ReturnT<String> run(TriggerParam triggerParam) {

        //çœç•¥éƒ¨åˆ†å†…å®¹

        
        //å¦‚æœèµ°åˆ°è¿™é‡Œï¼Œä¸ç®¡ä¸Šé¢æ˜¯ä»€ä¹ˆæƒ…å†µå§ï¼Œæ€»ä¹‹jobThreadè‚¯å®šå­˜åœ¨äº†ï¼Œæ‰€ä»¥ç›´æ¥æŠŠè¦è°ƒåº¦çš„ä»»åŠ¡æ”¾åˆ°è¿™ä¸ªçº¿ç¨‹å†…éƒ¨çš„é˜Ÿåˆ—ä¸­
        //ç­‰å¾…çº¿ç¨‹å»è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç»“æœ
        ReturnT<String> pushResult = jobThread.pushTriggerQueue(triggerParam);
        return pushResult;
    }

}
```

åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨runæ–¹æ³•ä¸­ï¼Œæœ€ååªæ˜¯æŠŠè¦æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡çš„ä¿¡æ¯å‚æ•°å¯¹è±¡æ”¾åˆ°äº†å®šæ—¶ä»»åŠ¡å¯¹åº”çš„å·¥ä½œçº¿ç¨‹çš„å†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°±è¿”å›ä¸€ä¸ªç»“æœäº†ã€‚è€Œè¿™ä¸ªç»“æœä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

```
public ReturnT<String> pushTriggerQueue(TriggerParam triggerParam) {
		//åœ¨è¿™é‡Œæ”¾è¿›é˜Ÿåˆ—ä¸­
		triggerQueue.add(triggerParam);
		//è¿”å›æˆåŠŸç»“æœ
        return ReturnT.SUCCESS;
}
```

åœ¨JobThreadç±»çš„pushTriggerQueueæ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åªè¦æŠŠå®šæ—¶ä»»åŠ¡çš„ä¿¡æ¯å¯¹è±¡æ”¾è¿›å†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªæˆåŠŸçš„ç»“æœã€‚ç„¶åè¿™ä¸ªç»“æœå°±ä¼šè¢«Nettyçš„æœåŠ¡å™¨è¿”å›ç»™è°ƒåº¦ä¸­å¿ƒã€‚æ‰€ä»¥ï¼Œåˆ°è¿™é‡Œå¤§å®¶åº”è¯¥ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“æˆ‘ä»¬è¿˜æ²¡æœ‰å¼•å…¥å®šæ—¶ä»»åŠ¡ç»“æœå›è°ƒçš„åŠŸèƒ½æ—¶ï¼Œç›®å‰çš„è°ƒåº¦ä¸­å¿ƒæ¯ä¸€æ¬¡è°ƒåº¦ä»»åŠ¡å¾—åˆ°çš„ç»“æœè¦ä¹ˆæ˜¯å¤±è´¥ï¼Œè¦ä¹ˆæ˜¯æˆåŠŸï¼Œå¦‚æœæ˜¯æˆåŠŸï¼Œä¹Ÿä»…ä»…æ„å‘³ç€è¿™ä¸ªå®šæ—¶ä»»åŠ¡ä¿¡æ¯è¢«æ”¾è¿›å¯¹åº”çš„å·¥ä½œçº¿ç¨‹çš„å†…éƒ¨é˜Ÿåˆ—ä¸­äº†ã€‚è‡³äºè¿™ä¸ªå®šæ—¶ä»»åŠ¡æœ‰æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œè°ƒåº¦ä¸­å¿ƒæ˜¯ä¸çŸ¥é“çš„ã€‚é‚£ä¹ˆé’ˆå¯¹ç°åœ¨ç¨‹åºä¸­çš„ç¼ºé™·ï¼Œè¯¥æ€ä¹ˆæ”¹è¿›å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæœ‰ä¸€ç‚¹å¿…é¡»è¦æ„è¯†åˆ°ï¼Œå®šæ—¶ä»»åŠ¡æ—¢ç„¶æ˜¯åœ¨æ‰§è¡Œå™¨é‚£ä¸€ç«¯æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„ç»“æœå°±å¿…é¡»å¾—ä»æ‰§è¡Œå™¨é‚£ä¸€ç«¯è¿”å›ã€‚å¯æ˜¯ï¼Œä»æ‰§è¡Œå™¨é‚£ä¸€ç«¯è¿”å›çš„æ‰§è¡Œç»“æœè¿”å›ç»™è°ƒåº¦ä¸­å¿ƒä¹‹åï¼Œè°ƒåº¦ä¸­å¿ƒæ€ä¹ˆçŸ¥é“è¿™ä¸ªç»“æœæ˜¯å±äºå“ªä¸ªå®šæ—¶ä»»åŠ¡çš„å‘¢ï¼Ÿ åˆ†æåˆ°è¿™é‡Œï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿéƒ½æ„è¯†åˆ°äº†ï¼Œè‚¯å®šè¦ç»™å®šæ—¶ä»»åŠ¡é™„åŠ ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œè€Œä¸”ç°æˆçš„å°±æœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å®šæ—¶ä»»åŠ¡åœ¨æ•°æ®åº“ä¸­çš„ä¸»é”®IDã€‚å®šæ—¶ä»»åŠ¡çš„ä¿¡æ¯ä¼šå°è£…åˆ°XxlJobInfoå¯¹è±¡ä¸­ï¼Œè¯¥å¯¹è±¡åœ¨è®°å½•åˆ°æ•°æ®åº“åï¼Œå…¶å†…éƒ¨çš„ä¸»é”®IDå±æ€§å°±ä¼šè¢«èµ‹å€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡éƒ½ä¼šå¯¹åº”ä¸€ä¸ªä¸»é”®IDã€‚å®šæ—¶ä»»åŠ¡çš„ä¸»é”®IDä¼šè¢«è°ƒåº¦ä¸­å¿ƒå‘é€ç»™æ‰§è¡Œå™¨ï¼Œæ‰§è¡Œå™¨æ‰§è¡Œå®Œå®šæ—¶ä»»åŠ¡ï¼Œå¾—åˆ°çš„é‚£ä¸ªæ‰§è¡Œç»“æœä¹Ÿä¼šå’Œå®šæ—¶ä»»åŠ¡çš„ä¸»é”®IDä¸€èµ·å°è£…åˆ°HandleCallbackParamå¯¹è±¡ä¸­ï¼Œç„¶åé€šè¿‡å›è°ƒçº¿ç¨‹å‘é€ç»™è°ƒåº¦ä¸­å¿ƒã€‚è°ƒåº¦ä¸­å¿ƒåœ¨æ¥æ”¶åˆ°HandleCallbackParamå¯¹è±¡åï¼Œæ ¹æ®é‡Œé¢çš„å®šæ—¶ä»»åŠ¡IDå°±å¯ä»¥çŸ¥é“è¿™ä¸ªæ‰§è¡Œç»“æœæ˜¯å±äºå“ªä¸ªå®šæ—¶ä»»åŠ¡çš„äº†ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¦æ€ä¹ˆå­˜å‚¨å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œæ ¹æ®æˆ‘ä»¬çš„ç¼–ç¨‹ç»éªŒï¼Œè¿™äº›æ‰§è¡Œç»“æœåº”è¯¥ä»¥æ—¥å¿—çš„å½¢å¼å±•ç¤ºç»™ç”¨æˆ·ï¼Œå¹¶ä¸”è¦å±•ç¤ºå¾—å¾ˆæ¸…æ¥šï¼Œè®©ç”¨æˆ·å¯ä»¥ä¸€ç›®äº†ç„¶ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä¸“é—¨ä¸ºå®šæ—¶ä»»åŠ¡çš„æ—¥å¿—ä¿¡æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¢«è°ƒåº¦çš„å®šæ—¶ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯å’Œæ‰§è¡Œç»“æœéƒ½å¯ä»¥å°è£…åˆ°è¿™ä¸ªæ—¥å¿—å¯¹è±¡ä¸­ã€‚è¿™ä¸ªæ—¥å¿—å¯¹è±¡å¯ä»¥è®°å½•åˆ°æ•°æ®åº“ä¸­ï¼Œå½“ç”¨æˆ·éœ€è¦çŸ¥é“å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦ä¿¡æ¯æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»æ•°æ®åº“ä¸­è¿”å›è¿™äº›å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—å¯¹è±¡ä¿¡æ¯ç»™ç”¨æˆ·äº†ã€‚è®²åˆ°è¿™é‡Œï¼Œæœ¬èŠ‚è¯¾çš„æ ¸å¿ƒçŸ¥è¯†å…¶å®ä¹Ÿå°±è®²è§£å®Œäº†ã€‚æ¥ä¸‹æ¥ï¼Œå°±è®©æˆ‘ä»¬ä»é‡æ„ä¹‹åçš„ä»£ç ä¸­ï¼Œçœ‹çœ‹ç¨‹åºé‡æ„æˆä»€ä¹ˆæ ·äº†ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

é¦–å…ˆæ˜¯é‡æ„ä¹‹åçš„è°ƒåº¦ä¸­å¿ƒã€‚

```
public class XxlJobTrigger {

    
    private static void processTrigger(XxlJobGroup group, XxlJobInfo jobInfo, int finalFailRetryCount, TriggerTypeEnum triggerType, int index, int total){
        //å¾—åˆ°å½“å‰è¦è°ƒåº¦çš„æ‰§è¡Œä»»åŠ¡çš„è·¯ç”±ç­–ç•¥ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰
        ExecutorRouteStrategyEnum executorRouteStrategyEnum = ExecutorRouteStrategyEnum.match(jobInfo.getExecutorRouteStrategy(), null);
        //è¿™é‡Œå°±è¦å¼€å§‹æ‰§è¡Œå’Œå®šæ—¶ä»»åŠ¡æ—¥å¿—ç›¸å…³çš„æ“ä½œäº†
        //å…ˆåˆ›å»ºä¸€ä¸ªæ—¥å¿—å¯¹è±¡ï¼Œç”¨äºè®°å½•è¯¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ˜¯çš„ä¸€äº›ä¿¡æ¯
        XxlJobLog jobLog = new XxlJobLog();
        //è®°å½•å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œå™¨ç»„id
        jobLog.setJobGroup(jobInfo.getJobGroup());
        //è®¾ç½®å®šæ—¶ä»»åŠ¡çš„id
        jobLog.setJobId(jobInfo.getId());
        //è®¾ç½®å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´
        jobLog.setTriggerTime(new Date());
        //åœ¨è¿™é‡ŒæŠŠå®šæ—¶ä»»åŠ¡æ—¥å¿—ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä¿å­˜æˆåŠŸä¹‹åï¼Œå®šæ—¶ä»»åŠ¡æ—¥å¿—çš„idä¹Ÿå°±æœ‰äº†
        XxlJobAdminConfig.getAdminConfig().getXxlJobLogDao().save(jobLog);
        logger.debug(">>>>>>>>>>> xxl-job trigger start, jobId:{}", jobLog.getId());
        //åˆå§‹åŒ–è§¦å‘å™¨å‚æ•°ï¼Œè¿™é‡Œçš„è¿™ä¸ªè§¦å‘å™¨å‚æ•°ï¼Œæ˜¯è¦åœ¨è¿œç¨‹è°ƒç”¨çš„å¦ä¸€ç«¯ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œå™¨é‚£ä¸€ç«¯ä½¿ç”¨çš„
        TriggerParam triggerParam = new TriggerParam();
        //è®¾ç½®ä»»åŠ¡id
        triggerParam.setJobId(jobInfo.getId());
        //è®¾ç½®æ‰§è¡Œå™¨è¦æ‰§è¡Œçš„ä»»åŠ¡çš„æ–¹æ³•åç§°
        triggerParam.setExecutorHandler(jobInfo.getExecutorHandler());
        //æŠŠæ‰§è¡Œå™¨è¦æ‰§è¡Œçš„ä»»åŠ¡çš„å‚æ•°è®¾ç½®è¿›å»
        triggerParam.setExecutorParams(jobInfo.getExecutorParam());
        //å®šæ—¶ä»»åŠ¡çš„è·¯ç”±ç­–ç•¥è®¾ç½®è¿›å»
        triggerParam.setExecutorBlockStrategy(jobInfo.getExecutorBlockStrategy());
        //è®¾ç½®å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—id
        triggerParam.setLogId(jobLog.getId());
        //è®¾ç½®å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´ï¼Œè¿™ä¸ªè§¦å‘æ—¶é—´å°±æ˜¯jobLogåˆšæ‰è®¾ç½®çš„é‚£ä¸ªæ—¶é—´
        triggerParam.setLogDateTime(jobLog.getTriggerTime().getTime());
        //è®¾ç½®æ‰§è¡Œæ¨¡å¼ï¼Œä¸€èˆ¬éƒ½æ˜¯beanæ¨¡å¼
        triggerParam.setGlueType(jobInfo.getGlueType());
        //æ¥ä¸‹æ¥è¦å†æ¬¡è®¾å®šè¿œç¨‹è°ƒç”¨çš„æœåŠ¡å®ä¾‹çš„åœ°å€
        //è¿™é‡Œå…¶å®æ˜¯è€ƒè™‘åˆ°äº†è·¯ç”±ç­–ç•¥
        String address = null;
        ReturnT<String> routeAddressResult = null;
        //å¾—åˆ°æ‰€æœ‰æ³¨å†Œåˆ°æœåŠ¡ç«¯çš„æ‰§è¡Œå™¨çš„åœ°å€ï¼Œå¹¶ä¸”åšåˆ¤ç©ºå¤„ç†
        List<String> registryList = group.getRegistryList();
        if (registryList!=null && !registryList.isEmpty()) {
            //åœ¨è¿™é‡Œæ ¹æ®è·¯ç”±ç­–ç•¥è·å¾—æœ€ç»ˆé€‰ç”¨çš„æ‰§è¡Œå™¨åœ°å€
            routeAddressResult = executorRouteStrategyEnum.getRouter().route(triggerParam, registryList);
            if (routeAddressResult.getCode() == ReturnT.SUCCESS_CODE) {
                address = routeAddressResult.getContent();
            } else {
                //å¦‚æœæ²¡å¾—åˆ°åœ°å€ï¼Œå°±èµ‹å€¼å¤±è´¥ï¼Œè¿™é‡Œè¿˜ç”¨ä¸åˆ°è¿™ä¸ªå¤±è´¥ç»“æœï¼Œä½†æ˜¯å…ˆåˆ—å‡ºæ¥å§
                routeAddressResult = new ReturnT<String>(ReturnT.FAIL_CODE, I18nUtil.getString("jobconf_trigger_address_empty"));
            }
        }
        //æ¥ä¸‹æ¥å°±å®šä¹‰ä¸€ä¸ªè¿œç¨‹è°ƒç”¨çš„ç»“æœå˜é‡
        ReturnT<String> triggerResult = null;
        //å¦‚æœåœ°å€ä¸ä¸ºç©º
        if (address != null) {
            //åœ¨è¿™é‡Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œè¿™é‡Œå°±æ˜¯æœ€æ ¸å¿ƒè¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯æ–¹æ³•å†…éƒ¨çš„é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨httpå‘é€è°ƒç”¨
            //æ¶ˆæ¯è€Œå·²
            triggerResult = runExecutor(triggerParam, address);
            //è¿™é‡Œå°±è¾“å‡ºä¸€ä¸‹çŠ¶æ€ç å§ï¼Œæ ¹æ®è¿”å›çš„çŠ¶æ€ç åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
            logger.info("è¿”å›çš„çŠ¶æ€ç "+triggerResult.getCode());
        } else {
            triggerResult = new ReturnT<String>(ReturnT.FAIL_CODE, null);
        }
        //åœ¨è¿™é‡Œæ‹¼æ¥ä¸€ä¸‹è§¦å‘ä»»åŠ¡çš„ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯webç•Œé¢çš„è°ƒåº¦å¤‡æ³¨
        StringBuffer triggerMsgSb = new StringBuffer();
        triggerMsgSb.append(I18nUtil.getString("jobconf_trigger_type")).append("ï¼š").append(triggerType.getTitle());
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobconf_trigger_admin_adress")).append("ï¼š").append(IpUtil.getIp());
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobconf_trigger_exe_regtype")).append("ï¼š")
                .append( (group.getAddressType() == 0)?I18nUtil.getString("jobgroup_field_addressType_0"):I18nUtil.getString("jobgroup_field_addressType_1") );
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobconf_trigger_exe_regaddress")).append("ï¼š").append(group.getRegistryList());
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobinfo_field_executorRouteStrategy")).append("ï¼š").append(executorRouteStrategyEnum.getTitle());
        //triggerMsgSb.append("<br>").append(I18nUtil.getString("jobinfo_field_executorBlockStrategy")).append("ï¼š").append(blockStrategy.getTitle());
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobinfo_field_timeout")).append("ï¼š").append(jobInfo.getExecutorTimeout());
        triggerMsgSb.append("<br>").append(I18nUtil.getString("jobinfo_field_executorFailRetryCount")).append("ï¼š").append(finalFailRetryCount);
        triggerMsgSb.append("<br><br><span style=\"color:#00c0ef;\" > >>>>>>>>>>>"+ I18nUtil.getString("jobconf_trigger_run") +"<<<<<<<<<<< </span><br>")
                .append((routeAddressResult!=null&&routeAddressResult.getMsg()!=null)?routeAddressResult.getMsg()+"<br><br>":"").append(triggerResult.getMsg()!=null?triggerResult.getMsg():"");
        //è®¾ç½®æ‰§è¡Œå™¨åœ°å€
        jobLog.setExecutorAddress(address);
        //è®¾ç½®æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ–¹æ³•åç§°
        jobLog.setExecutorHandler(jobInfo.getExecutorHandler());
        //è®¾ç½®æ‰§è¡Œå‚æ•°
        jobLog.setExecutorParam(jobInfo.getExecutorParam());
        //jobLog.setExecutorShardingParam(shardingParam);
        //è®¾ç½®å¤±è´¥é‡è¯•æ¬¡æ•°
        jobLog.setExecutorFailRetryCount(finalFailRetryCount);
        //è®¾ç½®è§¦å‘ç»“æœç 
        jobLog.setTriggerCode(triggerResult.getCode());
        //è®¾ç½®è§¦å‘ä»»åŠ¡ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è°ƒåº¦å¤‡æ³¨
        jobLog.setTriggerMsg(triggerMsgSb.toString());
        //æ›´æ–°æ•°æ®åº“ä¿¡æ¯
        XxlJobAdminConfig.getAdminConfig().getXxlJobLogDao().updateTriggerInfo(jobLog);
        logger.debug(">>>>>>>>>>> xxl-job trigger end, jobId:{}", jobLog.getId());
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨XxlJobTriggerç±»çš„processTriggeræ–¹æ³•ä¸­ï¼Œåœ¨å¼€å§‹è¿œç¨‹è°ƒåº¦å®šæ—¶ä»»åŠ¡ä¹‹å‰ï¼Œåœ¨ä¸Šé¢ä»£ç å—çš„ç¬¬9åˆ°ç¬¬15è¡Œï¼Œç›´æ¥ä¸ºå½“å‰è¦è¢«è°ƒåº¦çš„å®šæ—¶ä»»åŠ¡åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—å¯¹è±¡ï¼Œè¯¥æ—¥å¿—å¯¹è±¡å®šä¹‰ä¸ºXxlJobLogï¼Œå†…éƒ¨çš„å…·ä½“å±æ€§å¦‚ä¸‹ã€‚

```
public class XxlJobLog {

	//æ—¥å¿—id
	private long id;
	//æ‰§è¡Œå™¨ç»„id
	private int jobGroup;
	//å®šæ—¶ä»»åŠ¡id
	private int jobId;
	//æ‰§è¡Œå™¨åœ°å€
	private String executorAddress;
	//å°è£…å®šæ—¶ä»»åŠ¡çš„JobHandlerçš„åç§°
	private String executorHandler;
	//æ‰§è¡Œå™¨å‚æ•°
	private String executorParam;
	//æ‰§è¡Œå™¨åˆ†ç‰‡å‚æ•°
	private String executorShardingParam;
	//å¤±è´¥é‡è¯•æ¬¡æ•°
	private int executorFailRetryCount;
	//è§¦å‘å™¨è§¦å‘æ—¶é—´
	private Date triggerTime;
	//è§¦å‘å™¨ä»»åŠ¡çš„å“åº”ç 
	private int triggerCode;
	//è§¦å‘ä»»åŠ¡ä¿¡æ¯
	private String triggerMsg;
	//å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´
	private Date handleTime;
	//æ‰§è¡Œçš„å“åº”ç 
	private int handleCode;
	//æ‰§è¡Œçš„å…·ä½“ç»“æœ
	private String handleMsg;
	//è­¦æŠ¥çš„çŠ¶æ€ç  0æ˜¯é»˜è®¤ï¼Œ1æ˜¯ä¸éœ€è¦æŠ¥è­¦ï¼Œ2æ˜¯æŠ¥è­¦æˆåŠŸï¼Œ3æ˜¯æŠ¥è­¦å¤±è´¥
	private int alarmStatus;

    //å…¶å®ƒgetå’Œsetæ–¹æ³•çœç•¥
    
}
```

å¹¶ä¸”é€šè¿‡jobLog.setJobId(jobInfo.getId())è¿™è¡Œä»£ç ï¼ŒæŠŠå®šæ—¶ä»»åŠ¡çš„ä¸»é”®IDï¼Œè®¾ç½®åˆ°XxlJobLogæ—¥å¿—å¯¹è±¡ä¸­äº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒXxlJobLogå¯¹è±¡è¿˜æœ‰å¾ˆå¤šå±æ€§å¹¶æ²¡æœ‰èµ‹å€¼ã€‚ä½†è¿™æ—¶å€™ï¼Œåœ¨è°ƒåº¦ä¸­å¿ƒè¿™ä¸€è¾¹ï¼Œå®šæ—¶ä»»åŠ¡å·²ç»å’Œå…¶æ—¥å¿—ä¿¡æ¯ç»‘å®šæˆåŠŸäº†ï¼Œåªéœ€è¦è€å¿ƒç­‰å¾…æ‰§è¡Œå™¨é‚£ä¸€ç«¯è¿”å›å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œç„¶åæ ¹æ®æ‰§è¡Œç»“æœä¸­çš„å®šæ—¶ä»»åŠ¡IDï¼ŒæŠŠå¯¹åº”çš„ä¿¡æ¯è·Ÿæ–°åˆ°æ•°æ®åº“ä¸­çš„XxlJobLogä¸­å³å¯ã€‚æ‰€ä»¥ï¼Œç°åœ¨çš„é‡ç‚¹ï¼Œå°±æ¥åˆ°äº†æ‰§è¡Œå™¨è¿™ä¸€ç«¯ã€‚åˆšæ‰æˆ‘ä¸€ç›´åœ¨è¯´ï¼Œå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¼šå°è£…åˆ°HandleCallbackParamå¯¹è±¡ä¸­ï¼Œè¢«å›è°ƒçº¿ç¨‹å‘é€ç»™è°ƒåº¦ä¸­å¿ƒï¼Œä½†æ˜¯HandleCallbackParamå¯¹è±¡çš„å†…éƒ¨å±æ€§ç©¶ç«Ÿæœ‰ä»€ä¹ˆï¼Œæˆ‘å¹¶æ²¡æœ‰è¯¦ç»†è§£é‡Šã€‚ç°åœ¨ï¼Œå°±è¯·å¤§å®¶çœ‹çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

```
public class HandleCallbackParam implements Serializable {
    private static final long serialVersionUID = 42L;
	//è¿™ä¸ªå°±æ˜¯å®šæ—¶ä»»åŠ¡çš„ä¸»é”®ID
    private long logId;
    private long logDateTim;
    //å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœçš„çŠ¶æ€ç ï¼ŒæˆåŠŸè¿˜æ˜¯å¤±è´¥
    private int handleCode;
    private String handleMsg;

    //å…¶ä»–å†…å®¹æš‚ä¸”çœç•¥
}
```

HandleCallbackParamå¯¹è±¡å·²ç»ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥ï¼Œå°±è¯¥å…·ä½“åˆ†æä¸€ä¸‹ï¼Œæ‰§è¡Œå™¨é‚£ä¸€ç«¯å›è°ƒçº¿ç¨‹æ˜¯æ€ä¹ˆæŠŠå°è£…ç€å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœä¿¡æ¯çš„HandleCallbackParamå¯¹è±¡å‘é€ç»™è°ƒåº¦ä¸­å¿ƒçš„ã€‚å½“ç„¶ï¼Œé¦–å…ˆè¦æ˜ç¡®çš„å°±æ˜¯å›è°ƒçº¿ç¨‹æ˜¯æ€ä¹ˆå¾—åˆ°HandleCallbackParamå¯¹è±¡çš„ï¼Œè¿™ä¸ªé—®é¢˜å®é™…ä¸Šå¯ä»¥æ¢ä¸€ç§é—®æ³•ï¼Œé‚£å°±æ˜¯HandleCallbackParamå¯¹è±¡æ˜¯è°åˆ›å»ºçš„ï¼Œæ€ä¹ˆäº¤ç»™å›è°ƒçº¿ç¨‹çš„ã€‚ç»è¿‡å‰é¢å‡ ç« çš„å­¦ä¹ ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½æŒæ¡äº†å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„æ–¹å¼ã€‚åœ¨æ‰§è¡Œå™¨è¿™ä¸€ç«¯ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯åœ¨å¯¹åº”çš„å·¥ä½œçº¿ç¨‹ä¸­è¢«çœŸæ­£æ‰§è¡Œçš„ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

```
public class JobThread extends Thread{


    //å…¶ä»–å†…å®¹çœç•¥
    
    @Override
	public void run() {
        while(!toStop){
            //çœç•¥éƒ¨åˆ†å†…å®¹

            //é€šè¿‡åå°„æ‰§è¡Œäº†å®šæ—¶ä»»åŠ¡ï¼Œç»ˆäºåœ¨è¿™é‡Œæ‰§è¡Œäº†
			handler.execute();
        }
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œå®šæ—¶ä»»åŠ¡å°±åœ¨JobThreadç±»çš„runæ–¹æ³•ä¸­è¢«åå°„è°ƒç”¨äº†ã€‚ä½†æ˜¯ï¼Œä¸Šé¢ä»£ç å—ä¸­ä¹Ÿä»…ä»…æ˜¯æ‰§è¡Œäº†å®šæ—¶ä»»åŠ¡ï¼Œå’Œå®šæ—¶ä»»åŠ¡æœ‰å…³çš„ä¸€åˆ‡ï¼Œä¼¼ä¹å¹¶æ²¡æœ‰æ¶‰åŠåˆ°ã€‚è¿™æ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿæˆ‘æƒ³æˆ‘åº”è¯¥ä¸ºå¤§å®¶è§£é‡Šä¸€ä¸‹ï¼Œè™½ç„¶æœ¬ç« æˆ‘ä»¬çš„é‡ç‚¹æ˜¯è¦å®Œå–„å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœçš„å›è°ƒåŠŸèƒ½ï¼Œä½†æ˜¯è¯·å¤§å®¶æƒ³ä¸€æƒ³ï¼Œå®šæ—¶ä»»åŠ¡æœ¬èº«å°±æ˜¯åœ¨æ‰§è¡Œå™¨è¿™ä¸€ç«¯æ‰§è¡Œçš„ï¼Œå¦‚æœæ‰§è¡Œå™¨è¿™ä¸€ç«¯æŠŠå®šæ—¶ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œç„¶åç›´æ¥æŠŠç»“æœå‘é€ç»™è°ƒåº¦ä¸­å¿ƒï¼Œæ‰§è¡Œå™¨è¿™ä¸€ç«¯å¥½åƒä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹ï¼Œæˆ–è€…è¯´ï¼Œå®šæ—¶ä»»åŠ¡çš„ä»»ä½•ä¿¡æ¯éƒ½æ²¡æœ‰è®°å½•ã€‚é‚£ç”¨æˆ·å°±æƒ³æŸ¥çœ‹æ‰§è¡Œå™¨è¿™ä¸€ç«¯çš„å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œä¿¡æ¯å‘¢ï¼Ÿè¯´å¾—æ›´è¯¦ç»†ä¸€äº›ï¼Œå®šæ—¶ä»»åŠ¡ä»€ä¹ˆæ—¶å€™å¼€ä¼šæ‰§è¡Œçš„ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œç»“æŸäº†ï¼Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡åˆ°ä»€ä¹ˆå¼‚å¸¸äº†ï¼Œå¦‚æœçœŸçš„æœ‰å¼‚å¸¸è€Œå¯¼è‡´å®šæ—¶ä»»åŠ¡è¢«è¿«ç»ˆæ­¢äº†ï¼Œé‚£èƒ½ä¸èƒ½æŠŠè¢«è¿«ç»ˆæ­¢çš„åŸå› è®°å½•ä¸‹æ¥å‘¢ï¼Ÿè¿™äº›ä¿¡æ¯å¯¹ç”¨æˆ·æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ç›®å‰çš„ç¨‹åºå´ä»€ä¹ˆéƒ½æ²¡æœ‰è®°å½•ï¼Œè¿™æ‰æ˜¯ç›®å‰ç¨‹åºæœ€å¤§çš„ç¼ºé™·ã€‚æ‰€ä»¥ï¼Œæ‰§è¡Œå™¨è¿™ä¸€ç«¯ä¸ä»…è¦æŠŠå®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœå›è°ƒç»™è°ƒåº¦ä¸­å¿ƒï¼Œè¿˜è¦æŠŠå®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ä»¥æ—¥å¿—çš„æ–¹å¼æ”¶é›†èµ·æ¥ï¼Œå¹¶ä¸”è¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘å°±è¦å†ç»™æ‰§è¡Œå™¨è¿™ä¸€ç«¯å¼•å…¥ä¸¤ä¸ªæ–°çš„ç»„ä»¶ã€‚ä¸€ä¸ªå°±æ˜¯XxlJobFileAppenderç±»ï¼Œå…·ä½“å†…å®¹è¯·çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

```
public class XxlJobFileAppender {

	private static Logger logger = LoggerFactory.getLogger(XxlJobFileAppender.class);

	//é»˜è®¤çš„æ—¥å¿—å­˜å‚¨çš„è·¯å¾„ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå™¨å¯åŠ¨çš„æ—¶å€™ï¼Œè¯¥è·¯å¾„ä¼šè¢«ç”¨æˆ·åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„è·¯å¾„å–ä»£
	private static String logBasePath = "/data/applogs/xxl-job/jobhandler";

	//ä¸‹é¢è¿™ä¸ªä¼šåœ¨webç«¯åœ¨çº¿ç¼–è¾‘ä»£ç ï¼Œæ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œç”¨è¿™ä¸ªè·¯å¾„æŠŠç”¨æˆ·ç¼–è¾‘çš„ä»£ç è®°å½•ä¸‹æ¥
	private static String glueSrcPath = logBasePath.concat("/gluesource");

	/**
	 * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
	 * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
	 * @Date:2023/7/17
	 * @Description:åˆå§‹åŒ–å­˜å‚¨æ—¥å¿—æ–‡ä»¶è·¯å¾„çš„æ–¹æ³•ï¼Œéå¸¸ç®€å•ï¼Œå°±ä¸ç»†è®²äº†
	 */
	public static void initLogPath(String logPath){
		if (logPath!=null && logPath.trim().length()>0) {
			logBasePath = logPath;
		}
		File logPathDir = new File(logBasePath);
		if (!logPathDir.exists()) {
			logPathDir.mkdirs();
		}
		logBasePath = logPathDir.getPath();
		File glueBaseDir = new File(logPathDir, "gluesource");
		if (!glueBaseDir.exists()) {
			glueBaseDir.mkdirs();
		}
		glueSrcPath = glueBaseDir.getPath();
	}


	public static String getLogPath() {
		return logBasePath;
	}

	public static String getGlueSrcPath() {
		return glueSrcPath;
	}


	/**
	 * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
	 * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
	 * @Date:2023/7/17
	 * @Description:è¯¥æ–¹æ³•ä¼šæ ¹æ®å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´å’Œå…¶å¯¹åº”çš„æ—¥å¿—idåˆ›é€ ä¸€ä¸ªæ–‡ä»¶åï¼Œè¿™ä¸ªæ—¥å¿—idæ˜¯åœ¨è°ƒåº¦ä¸­å¿ƒå°±åˆ›å»ºå¥½çš„
	 * é€šè¿‡è§¦å‘å™¨å‚æ•°ä¼ é€’ç»™æ‰§è¡Œå™¨çš„ï¼Œæ–‡ä»¶å¤¹çš„åç§°æ˜¯å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„å¹´æœˆæ—¥æ—¶é—´
	 * æ¯”å¦‚ï¼Œ2023-06-30ï¼Œ2023-07-02ç­‰ç­‰ï¼Œæ¯ä¸ªæ—¶é—´éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸­æœ‰å¾ˆå¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ä»¶åç§°å°±æ˜¯å®šæ—¶ä»»åŠ¡çš„ID
	 */
	public static String makeLogFileName(Date triggerDate, long logId) {
		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
		//è¿™é‡Œçš„getLogPath()ä¼šå¾—åˆ°å­˜å‚¨æ—¥å¿—çš„åŸºç¡€è·¯å¾„ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨é…ç½®æ–‡ä»¶è®¾ç½®çš„é‚£ä¸ªè·¯å¾„
		File logFilePath = new File(getLogPath(), sdf.format(triggerDate));
		if (!logFilePath.exists()) {
			logFilePath.mkdir();
		}
		String logFileName = logFilePath.getPath()
				.concat(File.separator)
				.concat(String.valueOf(logId))
				.concat(".log");
		return logFileName;
	}


	/**
	 * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
	 * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
	 * @Date:2023/7/17
	 * @Description:æŠŠæ—¥å¿—è®°å½•åˆ°æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶ä¸­
	 */
	public static void appendLog(String logFileName, String appendLog) {
		if (logFileName==null || logFileName.trim().length()==0) {
			return;
		}
		File logFile = new File(logFileName);
		if (!logFile.exists()) {
			try {
				logFile.createNewFile();
			} catch (IOException e) {
				logger.error(e.getMessage(), e);
				return;
			}
		}
		if (appendLog == null) {
			appendLog = "";
		}
		appendLog += "\r\n";
		FileOutputStream fos = null;
		try {
			fos = new FileOutputStream(logFile, true);
			fos.write(appendLog.getBytes("utf-8"));
			fos.flush();
		} catch (Exception e) {
			logger.error(e.getMessage(), e);
		} finally {
			if (fos != null) {
				try {
					fos.close();
				} catch (IOException e) {
					logger.error(e.getMessage(), e);
				}
			}
		}
		
	}

	/**
	 * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
	 * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
	 * @Date:2023/7/17
	 * @Description:è¯»å–æœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œè¿™ä¸ªæ–¹æ³•è™½ç„¶æœ‰ç‚¹é•¿ï¼Œä½†éƒ½æ˜¯å¸¸è§„é€»è¾‘ï¼Œå°±æ˜¯æœ€åŸºç¡€çš„è¯»å–æ–‡ä»¶çš„æ“ä½œ
	 */
	public static LogResult readLog(String logFileName, int fromLineNum){
		if (logFileName==null || logFileName.trim().length()==0) {
            return new LogResult(fromLineNum, 0, "readLog fail, logFile not found", true);
		}
		File logFile = new File(logFileName);
		if (!logFile.exists()) {
            return new LogResult(fromLineNum, 0, "readLog fail, logFile not exists", true);
		}
		StringBuffer logContentBuffer = new StringBuffer();
		int toLineNum = 0;
		LineNumberReader reader = null;
		try {
			reader = new LineNumberReader(new InputStreamReader(new FileInputStream(logFile), "utf-8"));
			String line = null;
			while ((line = reader.readLine())!=null) {
				toLineNum = reader.getLineNumber();
				if (toLineNum >= fromLineNum) {
					logContentBuffer.append(line).append("\n");
				}
			}
		} catch (IOException e) {
			logger.error(e.getMessage(), e);
		} finally {
			if (reader != null) {
				try {
					reader.close();
				} catch (IOException e) {
					logger.error(e.getMessage(), e);
				}
			}
		}
		LogResult logResult = new LogResult(fromLineNum, toLineNum, logContentBuffer.toString(), false);
		return logResult;
	}
}
```

å¦ä¸€ä¸ªç»„ä»¶å°±æ˜¯XxlJobHelperç±»ï¼Œå…·ä½“çš„å†…å®¹å¦‚ä¸‹ã€‚

```
public class XxlJobHelper {
    //è¯¥ç±»åªå±•ç¤ºéƒ¨åˆ†ä»£ç 


     /**
     * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
     * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
     * @Date:2023/7/17
     * @Description:å­˜å‚¨å®šæ—¶ä»»åŠ¡æ—¥å¿—çš„å…¥å£æ–¹æ³•
     */
    public static boolean log(String appendLogPattern, Object ... appendLogArguments) {
        //è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯ç”¨æ¥æ ¼å¼åŒ–è¦è®°å½•çš„æ—¥å¿—ä¿¡æ¯
        FormattingTuple ft = MessageFormatter.arrayFormat(appendLogPattern, appendLogArguments);
        String appendLog = ft.getMessage();
        //ä»æ ˆå¸§ä¸­è·å¾—æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯
        StackTraceElement callInfo = new Throwable().getStackTrace()[1];
        //åœ¨è¿™é‡Œå¼€å§‹å­˜å‚¨æ—¥å¿—ï¼Œä½†è¿™é‡Œå®é™…ä¸Šåªæ˜¯ä¸ªå…¥å£æ–¹æ³•ï¼ŒçœŸæ­£çš„æ“ä½œè¿˜æ˜¯ä¼šè¿›ä¸€æ­¥è°ƒç”¨XxlJobFileAppenderç±»çš„æ–¹æ³•æ¥å®Œæˆçš„
        return logDetail(callInfo, appendLog);
    }



    /**
     * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
     * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
     * @Date:2023/7/17
     * @Description:æŠŠå®šæ—¶ä»»åŠ¡çš„æ—¥å¿—å­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„æ–¹æ³•
     */
    private static boolean logDetail(StackTraceElement callInfo, String appendLog) {
        //ä»å½“å‰çº¿ç¨‹ä¸­è·å¾—å®šæ—¶ä»»åŠ¡ä¸Šä¸‹æ–‡å¯¹è±¡
        XxlJobContext xxlJobContext = XxlJobContext.getXxlJobContext();
        if (xxlJobContext == null) {
            return false;
        }
        StringBuffer stringBuffer = new StringBuffer();
        //åœ¨è¿™é‡ŒæŠŠæ–¹æ³•è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯æ‹¼æ¥ä¸€ä¸‹
        stringBuffer.append(DateUtil.formatDateTime(new Date())).append(" ")
                .append("["+ callInfo.getClassName() + "#" + callInfo.getMethodName() +"]").append("-")
                .append("["+ callInfo.getLineNumber() +"]").append("-")
                .append("["+ Thread.currentThread().getName() +"]").append(" ")
                .append(appendLog!=null?appendLog:"");
        //è½¬æ¢æˆå­—ç¬¦ä¸²
        String formatAppendLog = stringBuffer.toString();
        //è·å–å®šæ—¶ä»»åŠ¡å¯¹åº”çš„æ—¥å¿—å­˜å‚¨è·¯å¾„
        String logFileName = xxlJobContext.getJobLogFileName();
        if (logFileName!=null && logFileName.trim().length()>0) {
            //çœŸæ­£å­˜å‚¨æ—¥å¿—çš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå°±æŠŠæ—¥å¿—å­˜å‚¨åˆ°æœ¬åœ°æ–‡ä»¶äº†
            XxlJobFileAppender.appendLog(logFileName, formatAppendLog);
            return true;
        } else {
            logger.info(">>>>>>>>>>> {}", formatAppendLog);
            return false;
        }
    }


    //å‰©ä¸‹çš„æ–¹æ³•æš‚ä¸”çœç•¥
}
```

ä¸Šé¢ä¸¤ä¸ªæ–°çš„ç»„ä»¶çš„å…³ç³»å·²ç»å¾ˆæ˜æ˜¾äº†ï¼ŒXxlJobHelperä¸­çš„æ–¹æ³•æ˜¯è®°å½•æ—¥å¿—åˆ°æœ¬åœ°çš„å…¥å£æ–¹æ³•ï¼Œè€ŒçœŸæ­£å¹²æ´»çš„æ˜¯XxlJobFileAppenderç±»ä¸­çš„æ–¹æ³•ã€‚æ¯”å¦‚XxlJobHelperè°ƒç”¨äº†å…¶å†…éƒ¨çš„logæ–¹æ³•ï¼Œæ‰“ç®—å°†å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯è®°å½•åˆ°æœ¬åœ°ï¼Œä½†æ˜¯åœ¨logæ–¹æ³•å†…éƒ¨ï¼Œåˆè°ƒç”¨äº†logDetailæ–¹æ³•ï¼Œè€Œåœ¨logDetailæ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨äº†XxlJobFileAppenderç±»ä¸­çš„appendLogæ–¹æ³•ï¼ŒçœŸæ­£å°†æ—¥å¿—å†…å®¹æ‹¼æ¥åˆ°å¯¹åº”çš„æœ¬åœ°æ–‡ä»¶ä¸­ã€‚è¿™ä¸€ç‚¹ï¼Œå¯¹å¤§å®¶æ¥è¯´ï¼Œåº”è¯¥æ˜¯å¾ˆæ¸…æ¥šäº†ã€‚å½“ç„¶ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šéƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œåœ¨ä¸Šé¢çš„ä¸¤ä¸ªä»£ç å—ä¸­ï¼Œæœ‰ä¸€ä¸ªæ–°çš„ç±»æ˜¯å¤§å®¶ä¸è®¤è¯†çš„ï¼Œé‚£å°±æ˜¯XxlJobContextã€‚è¿™ä¸ªç±»ä»åç§°ä¸Šå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼Œé‚£è¿™ä¸ªç±»çš„å…·ä½“ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘æƒ³ä¸ºå¤§å®¶ç®€å•åˆ†æä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨æ‰§è¡Œå™¨è¿™ä¸€ç«¯è¢«æ‰§è¡Œäº†ä¹‹åï¼Œæ‰§è¡Œç»“æœæ˜¯è¦è¢«å‘é€ç»™è°ƒåº¦ä¸­å¿ƒçš„ã€‚å¯æ˜¯åœ¨ä¹‹å‰ç»™å¤§å®¶å±•ç¤ºçš„é‚£ä¸ªJobThreadå·¥ä½œçº¿ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»»ä½•ä¸€ç‚¹æ‰§è¡Œç»“æœçš„ä¿¡æ¯ã€‚é‚£æ‰§è¡Œç»“æœçš„ä¿¡æ¯ç©¶ç«Ÿå­˜æ”¾åœ¨å“ªé‡Œå‘¢ï¼Ÿæˆ–è€…è¯´æ‰§è¡Œç»“æœçš„ä¿¡æ¯åˆ°åº•è¯¥æ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿ

è¿™ä¸ªå…¶å®å°±è¦ç»“åˆåˆšæ‰å¼•è¿›çš„é‚£ä¸¤ä¸ªæ—¥å¿—ç»„ä»¶æ¥åˆ†æäº†ï¼Œåˆšæ‰æˆ‘å·²ç»ä¸ºå¤§å®¶åˆ†æäº†ï¼Œå¼•å…¥çš„è¿™ä¸¤ä¸ªæ—¥å¿—ç»„ä»¶å°±æ˜¯ä¸ºäº†å°†æ‰§è¡Œå™¨è¿™ä¸€ç«¯æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯è¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶ä¸­çš„ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæ—¢ç„¶å®šæ—¶ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯å·²ç»è®°å½•åˆ°æ‰§è¡Œå™¨æ‰€éƒ¨ç½²çš„æœåŠ¡å™¨çš„æœ¬åœ°äº†ï¼Œå·²ç»è¢«è¯¦ç»†è®°å½•äº†ï¼Œé‚£ä¹ˆï¼Œè¿”è¿˜ç»™è°ƒåº¦ä¸­å¿ƒçš„å…¶å®å°±æ²¡å¿…è¦é‚£ä¹ˆå¤æ‚äº†ï¼Œåªéœ€è¦è¿”å›å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ˜¯æˆåŠŸæˆ–è€…å¤±è´¥å³å¯ã€‚æ­£å› ä¸ºè¿™æ ·ï¼Œæ‰€ä»¥å°è£…å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¿¡æ¯çš„HandleCallbackParamå¯¹è±¡æ‰ä¼šé‚£ä¹ˆç®€æ´ã€‚å¥½äº†ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹åˆ†æï¼Œå®šæ—¶ä»»åŠ¡è¿”å›ç»™è°ƒåº¦ä¸­å¿ƒçš„ç»“æœä¿¡æ¯å·²ç»æ˜ç¡®äº†ï¼Œå…¶å®æœ€é‡è¦çš„å°±æ˜¯é‚£ä¸ªæˆåŠŸæˆ–å¤±è´¥çš„çŠ¶æ€ç ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªçŠ¶æ€ç è¯¥å¦‚ä½•å¾—åˆ°å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä¹Ÿå°±ä¸å†å–å…³å­äº†ï¼Œå…¶å®åœ¨xxl-jobä¸­ï¼Œé»˜è®¤å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœéƒ½æ˜¯æˆåŠŸï¼Œåªæœ‰æ‰§è¡Œå¤±è´¥æˆ–è€…å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œæ‰ä¼šæŠŠæ‰§è¡Œç»“æœç½®ä¸ºå¤±è´¥ï¼Œç„¶åå‘é€ç»™è°ƒåº¦ä¸­å¿ƒã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœç©¶ç«Ÿå­˜å‚¨åœ¨å“ªé‡Œå‘¢ï¼Ÿå…¶å®å°±å­˜æ”¾åœ¨XxlJobContextè¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ã€‚

ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå¤§å®¶åˆ«å¿˜äº†ï¼Œæ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡éƒ½å¯¹åº”ç€ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè€Œæ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯å’Œè¿”å›ç»“æœéƒ½æ˜¯ç‹¬ä¸€ä»½çš„ï¼Œæ—¢ç„¶æ˜¯è¿™æ ·ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨çº¿ç¨‹çš„ç§æœ‰Mapæ¥å­˜æ”¾å‘¢ï¼Ÿä¹Ÿå°±æ˜¯ThreadLocalæ¥è¿›è¡Œå­˜æ”¾ã€‚è¿™æ ·ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œè‡ªå·±çš„å®šæ—¶ä»»åŠ¡åï¼Œå°±æŠŠç»“æœæš‚æ—¶å­˜æ”¾åˆ°çº¿ç¨‹çš„ç§æœ‰Mapä¸­ï¼Œç­‰åˆ°å®šæ—¶ä»»åŠ¡å¯¹åº”çš„å·¥ä½œçº¿ç¨‹è¦å¤„ç†å®šæ—¶ä»»åŠ¡çš„æ—¥å¿—ä¿¡æ¯äº†ï¼Œå°±ä»æœ¬åœ°Mapä¸­é‡æ–°å–å‡ºå®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ç§å¤„ç†æ‰‹æ®µæ—¢ç®€å•åˆé«˜æ•ˆï¼Œå®åœ¨æ˜¯ç²¾å¦™ã€‚ä¸‹é¢ï¼Œå°±è¯·å¤§å®¶çœ‹çœ‹å…·ä½“çš„ä»£ç ã€‚

é¦–å…ˆæ˜¯XxlJobContextç±»çš„å…·ä½“å†…å®¹ã€‚

```
public class XxlJobContext {

    //ä¸‹é¢å°±æ˜¯å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœçš„ä¸‰ç§çŠ¶æ€ç 
    //200æ˜¯æˆåŠŸï¼Œ500æ˜¯å¤±è´¥ï¼Œ502æ˜¯è¶…æ—¶
    public static final int HANDLE_CODE_SUCCESS = 200;
    public static final int HANDLE_CODE_FAIL = 500;
    public static final int HANDLE_CODE_TIMEOUT = 502;


    private final long jobId;


    private final String jobParam;


    private final String jobLogFileName;


    private final int shardIndex;


    private final int shardTotal;


    private int handleCode;


    private String handleMsg;


    public XxlJobContext(long jobId, String jobParam, String jobLogFileName, int shardIndex, int shardTotal) {
        this.jobId = jobId;
        this.jobParam = jobParam;
        this.jobLogFileName = jobLogFileName;
        this.shardIndex = shardIndex;
        this.shardTotal = shardTotal;
        //æ„é€ æ–¹æ³•ä¸­å”¯ä¸€å€¼å¾—æ³¨æ„çš„å°±æ˜¯è¿™é‡Œï¼Œåˆ›å»ºXxlJobContextå¯¹è±¡çš„æ—¶å€™é»˜è®¤å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœå°±æ˜¯æˆåŠŸ
        //å¦‚æœæ‰§è¡Œå¤±è´¥äº†ï¼Œè‡ªæœ‰å…¶ä»–æ–¹æ³•æŠŠè¿™é‡Œè®¾ç½®æˆå¤±è´¥
        this.handleCode = HANDLE_CODE_SUCCESS;
    }

    public long getJobId() {
        return jobId;
    }

    public String getJobParam() {
        return jobParam;
    }

    public String getJobLogFileName() {
        return jobLogFileName;
    }

    public int getShardIndex() {
        return shardIndex;
    }

    public int getShardTotal() {
        return shardTotal;
    }

    public void setHandleCode(int handleCode) {
        this.handleCode = handleCode;
    }

    public int getHandleCode() {
        return handleCode;
    }

    public void setHandleMsg(String handleMsg) {
        this.handleMsg = handleMsg;
    }

    public String getHandleMsg() {
        return handleMsg;
    }

    //è¿™é‡Œæ˜¯ä¸€ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œå› ä¸ºå®šæ—¶ä»»åŠ¡çœŸæ­£æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æ‰§è¡Œå™¨ç«¯æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä»»åŠ¡å¯¹åº”ä¸€ä¸ªçº¿ç¨‹
    //è¿™æ ·å°±æŠŠå®šæ—¶ä»»åŠ¡éš”ç¦»å¼€äº†ï¼Œè‡ªç„¶å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼ŒæŠŠéœ€è¦çš„æ•°æ®å­˜å‚¨åœ¨é‡Œé¢
    //è¿™é‡Œä½¿ç”¨çš„è¿™ä¸ªå˜é‡æ˜¯å¯ç»§æ‰¿çš„threadlocalï¼Œä¹Ÿå°±å­çº¿ç¨‹å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹å­˜å‚¨åœ¨æœ¬åœ°çš„æ•°æ®äº†
    private static InheritableThreadLocal<XxlJobContext> contextHolder = new InheritableThreadLocal<XxlJobContext>();


    public static void setXxlJobContext(XxlJobContext xxlJobContext){
        contextHolder.set(xxlJobContext);
    }


    public static XxlJobContext getXxlJobContext(){
        return contextHolder.get();
    }

}
```

æ¥ç€å°±æ˜¯é‡æ„ä¹‹åçš„JobThreadç±»ã€‚

```
public class JobThread extends Thread{


    //å…¶ä»–å†…å®¹çœç•¥
    
    @Override
	public void run() {
        while(!toStop){
			//ç°åœ¨å°±è¦åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä¸æ–­çš„ä»è§¦å‘å™¨é˜Ÿåˆ—ä¸­å–å‡ºå¾…æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œå¼€å§‹æ‰§è¡Œ
			//çº¿ç¨‹æ˜¯å¦å·¥ä½œçš„æ ‡è®°ï¼Œé»˜è®¤ä¸ºfalse
			running = false;
            //è¿™ä¸ªæ˜¯çº¿ç¨‹çš„ç©ºé—²æ—¶é—´
			idleTimes++;
			//å…ˆå£°æ˜ä¸€ä¸ªè§¦å‘å™¨å‚æ•°å˜é‡
            TriggerParam triggerParam = null;
            try {
				//ä»è§¦å‘å™¨å‚æ•°é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªè§¦å‘å™¨å‚æ•°å¯¹è±¡
				//è¿™é‡Œæ˜¯é™æ—¶çš„é˜»å¡è·å–ï¼Œå¦‚æœè¶…è¿‡3ç§’æ²¡è·å–åˆ°ï¼Œå°±ä¸é˜»å¡äº†
				triggerParam = triggerQueue.poll(3L, TimeUnit.SECONDS);
				if (triggerParam!=null) {
					//èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜è·å¾—äº†è§¦å‘å™¨å‚æ•°ï¼Œè¿™æ—¶å€™å°±æŠŠçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ ‡è®°è®¾ç½®ä¸ºtrue
					running = true;
                    //ç©ºé—²æ—¶é—´ä¹Ÿå¯ä»¥ç½®ä¸º0äº†
					idleTimes = 0;
					//æ¥ä¸‹æ¥å°±æ˜¯ä¸€ç³»åˆ—çš„å¤„ç†æ‰§è¡Œå™¨ç«¯å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„æ—¥å¿—æ“ä½œ
					//å…ˆæ ¹æ®å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´å’Œå®šæ—¶ä»»åŠ¡çš„æ—¥å¿—idï¼Œåˆ›å»ºä¸€ä¸ªè®°å½•å®šæ—¶ä»»åŠ¡æ—¥çš„æ–‡ä»¶å
					String logFileName = XxlJobFileAppender.makeLogFileName(new Date(triggerParam.getLogDateTime()), triggerParam.getLogId());
					//ç„¶ååˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåˆ›å»ºçš„æ—¶å€™
                    //å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœå°±è¢«è®¾ç½®ä¸ºæˆåŠŸçŠ¶æ€äº†
					XxlJobContext xxlJobContext = new XxlJobContext(
							triggerParam.getJobId(),
							triggerParam.getExecutorParams(),
							logFileName,
							triggerParam.getBroadcastIndex(),
							triggerParam.getBroadcastTotal());
					//å…ˆæŠŠåˆ›å»ºå‡ºæ¥çš„å®šæ—¶ä»»åŠ¡ä¸Šä¸‹æ–‡å¯¹è±¡å­˜å‚¨åˆ°æ‰§è¡Œå®šæ—¶ä»»åŠ¡çº¿ç¨‹çš„ç§æœ‰å®¹å™¨ä¸­
					XxlJobContext.setXxlJobContext(xxlJobContext);
					//è¿™é‡Œä¼šå‘logFileNameæ–‡ä»¶ä¸­è®°å½•ä¸€ä¸‹æ—¥å¿—ï¼Œè®°å½•çš„å°±æ˜¯ä¸‹é¢çš„è¿™å¥è¯ï¼Œå®šæ—¶ä»»åŠ¡å¼€å§‹æ‰§è¡Œäº†
					XxlJobHelper.log("<br>----------- xxl-job job execute start -----------<br>----------- Param:" + xxlJobContext.getJobParam());
					//é€šè¿‡åå°„æ‰§è¡Œäº†å®šæ—¶ä»»åŠ¡ï¼Œç»ˆäºåœ¨è¿™é‡Œæ‰§è¡Œäº†
					handler.execute();
					//å®šæ—¶ä»»åŠ¡æ‰§è¡Œäº†ï¼Œæ‰€ä»¥è¿™é‡Œè¦åˆ¤æ–­ä¸€ä¸‹æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„XxlJobContextä¸Šä¸‹æ–‡å¯¹è±¡
					//ä»åˆ›å»ºçš„æ—¶å€™å°±é»˜è®¤æ‰§è¡Œç»“æœä¸ºæˆåŠŸã€‚åœ¨æºç ä¸­ï¼Œåœ¨è¿™è¡Œä»£ç ä¹‹å‰å…¶å®è¿˜æœ‰ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶é—´çš„åˆ¤æ–­ï¼Œå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œå®šæ—¶ä»»åŠ¡
					//ç„¶åå†åˆ¤æ–­ä»»åŠ¡æ‰§è¡ŒæˆåŠŸäº†æ²¡ï¼Œå¦‚æœæ²¡æˆåŠŸXxlJobHelperç±»å°±ä¼šä¿®æ”¹ä¸Šä¸‹æ–‡å¯¹è±¡çš„æ‰§è¡Œç»“æœã€‚ç­‰æˆ‘ä»¬å¼•å…¥ä»»åŠ¡è¶…æ—¶çš„åŠŸèƒ½åï¼Œè¿™é‡Œçš„é€»è¾‘å°±ä¼šæ›´ä¸°å¯Œäº†
					if (XxlJobContext.getXxlJobContext().getHandleCode() <= 0) {
						XxlJobHelper.handleFail("job handle result lost.");
					}else {
						//èµ°åˆ°è¿™é‡Œæ„å‘³ç€å®šæ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸäº†ï¼Œä»å®šæ—¶ä»»åŠ¡ä¸Šä¸‹æ–‡ä¸­å–å‡ºæ‰§è¡Œçš„ç»“æœä¿¡æ¯
						String tempHandleMsg = XxlJobContext.getXxlJobContext().getHandleMsg();
						//è¿™é‡Œæœ‰ä¸€ä¸ªä¸‰å…ƒè¿ç®—ï¼Œä¼šåˆ¤æ–­æ‰§è¡Œç»“æœä¿¡æ¯æ˜¯ä¸æ˜¯nullï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œæ¯«æ— å¼‚å¸¸ï¼Œè¿™ä¸ªç»“æœä¿¡æ¯å°±ä¼šæ˜¯null
						//åªæœ‰åœ¨æ‰§è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œæ‰ä¼šæœ‰å¤±è´¥ä¿¡æ¯è¢«XxlJobHelperè®°å½•è¿›å»
						tempHandleMsg = (tempHandleMsg!=null&&tempHandleMsg.length()>50000)
								?tempHandleMsg.substring(0, 50000).concat("...")
								:tempHandleMsg;
						//è¿™é‡Œæ˜¯æ‰§è¡ŒæˆåŠŸäº†ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯nullï¼Œèµ‹å€¼å…¶å®å°±æ˜¯ä»€ä¹ˆä¹Ÿæ²¡èµ‹æˆ
						XxlJobContext.getXxlJobContext().setHandleMsg(tempHandleMsg);
					}
					//èµ°åˆ°è¿™é‡Œï¼Œä¸ç®¡æ˜¯æ‰§è¡ŒæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æŠŠç»“æœå­˜å‚¨åˆ°å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ä¸­
					//èµ°åˆ°è¿™é‡Œå¤§å®¶ä¹Ÿåº”è¯¥æ„è¯†åˆ°äº†ï¼Œæ‰§è¡Œå™¨è¿™ä¸€ç«¯æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œå®é™…ä¸Šæ˜¯æ¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡éƒ½ä¼šå¯¹åº”ä¸€ä¸ªæœ¬åœ°çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœéƒ½ä¼šå­˜å‚¨åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­
					//å½“ç„¶ï¼Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡å¯èƒ½ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œæ‰€ä»¥å®šæ—¶ä»»åŠ¡å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶å°±ä¼šè®°å½•è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ¯æ¬¡æ‰§è¡Œçš„ä¿¡æ¯
					XxlJobHelper.log("<br>----------- xxl-job job execute end(finish) -----------<br>----------- Result: handleCode="
							+ XxlJobContext.getXxlJobContext().getHandleCode()
							+ ", handleMsg = "
							+ XxlJobContext.getXxlJobContext().getHandleMsg()
					);
				} else {
					//èµ°åˆ°è¿™é‡Œè¯´æ˜è§¦å‘å™¨é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®ï¼Œä¹Ÿå°±æ„å‘³ç€æ²¡æœ‰è¦æ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡
					//å¦‚æœçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¤§äº30æ¬¡ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å¾ªç¯çš„æ¬¡æ•°ï¼Œæ¯å¾ªç¯ä¸€æ¬¡ç©ºé—²æ—¶é—´å°±è‡ªå¢1ï¼Œ
					//æœ‰å®šæ—¶ä»»åŠ¡è¢«æ‰§è¡Œç©ºé—²æ—¶é—´å°±æ¸…é›¶ï¼Œä¸å¯èƒ½æ²¡ä»»åŠ¡çº¿ç¨‹ç©ºè½¬ï¼Œå¤ªæµªè´¹èµ„æºäº†
					if (idleTimes > 30) {
						//è€Œä¸”è§¦å‘å™¨é˜Ÿåˆ—ä¹Ÿæ²¡æœ‰æ•°æ®
						if(triggerQueue.size() == 0) {
							//å°±ä»ç¼“å­˜JobThreadçº¿ç¨‹çš„jobThreadRepositoryè¿™ä¸ªMapä¸­ç§»é™¤ç¼“å­˜çš„JobThreadçº¿ç¨‹
							//åœ¨ç§»é™¤çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¯¥çº¿ç¨‹çš„toStopæ–¹æ³•å’Œinterruptæ–¹æ³•ï¼Œè®©çº¿ç¨‹çœŸæ­£åœä¸‹æ¥
							XxlJobExecutor.removeJobThread(jobId, "excutor idel times over limit.");
						}
					}
				}
			} catch (Throwable e) {
				if (toStop) {
					//å¦‚æœçº¿ç¨‹åœæ­¢äº†ï¼Œå°±è®°å½•çº¿ç¨‹åœæ­¢çš„æ—¥å¿—åˆ°å®šæ—¶ä»»åŠ¡å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ä¸­
					XxlJobHelper.log("<br>----------- JobThread toStop, stopReason:" + stopReason);
					//ä¸‹é¢å°±æ˜¯å°†å¼‚å¸¸ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„æ“ä½œï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯åœ¨catchä¸­æ‰§è¡Œçš„
					//å°±æ„å‘³ç€è‚¯å®šæœ‰å¼‚å¸¸äº†ï¼Œæ‰€ä»¥è¦è®°å½•å¼‚å¸¸ä¿¡æ¯
					StringWriter stringWriter = new StringWriter();
					e.printStackTrace(new PrintWriter(stringWriter));
					String errorMsg = stringWriter.toString();
					XxlJobHelper.handleFail(errorMsg);
					//åœ¨è¿™é‡Œè®°å½•å¼‚å¸¸ä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶ä¸­
					XxlJobHelper.log("<br>----------- JobThread Exception:" + errorMsg + "<br>----------- xxl-job job execute end(error) -----------");
				}
			} finally {
				//è¿™é‡Œå°±èµ°åˆ°äº†finallyä¸­ï¼Œä¹Ÿå°±è¦å¼€å§‹æ‰§è¡Œæ—¥å¿—å›è°ƒç»™è°ƒåº¦ä¸­å¿ƒçš„æ“ä½œäº†
				//åˆ«å¿˜äº†ï¼Œè°ƒåº¦ä¸­å¿ƒåœ¨è¿œç¨‹è°ƒç”¨ä¹‹å‰åˆ›å»ºäº†XxlJobLogè¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¦è®°å½•å¾ˆå¤šæ—¥è®°è°ƒç”¨ä¿¡æ¯çš„
				if(triggerParam != null) {
					if (!toStop) {
						//è¿™é‡Œè¦å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœæ­¢è¿è¡Œ
						//å¦‚æœæ²¡æœ‰åœæ­¢ï¼Œå°±åˆ›å»ºå°è£…å›è°ƒä¿¡æ¯çš„HandleCallbackParamå¯¹è±¡
						//æŠŠè¿™ä¸ªå¯¹è±¡æäº¤ç»™TriggerCallbackThreadå†…éƒ¨çš„callBackQueueé˜Ÿåˆ—ä¸­
						TriggerCallbackThread.pushCallBack(new HandleCallbackParam(
								triggerParam.getLogId(),
								triggerParam.getLogDateTime(),
								XxlJobContext.getXxlJobContext().getHandleCode(),
								XxlJobContext.getXxlJobContext().getHandleMsg() )
						);
					} else {
						//å¦‚æœèµ°åˆ°è¿™é‡Œè¯´æ˜çº¿ç¨‹è¢«ç»ˆæ­¢äº†ï¼Œå°±è¦å°è£…å¤„ç†å¤±è´¥çš„å›ä¿¡
						TriggerCallbackThread.pushCallBack(new HandleCallbackParam(
								triggerParam.getLogId(),
								triggerParam.getLogDateTime(),
								XxlJobContext.HANDLE_CODE_FAIL,
								stopReason + " [job running, killed]" )
						);
					}
				}
			}
        }
    }
}
```

åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œæˆ‘æ·»åŠ äº†ç‰¹åˆ«ç‰¹åˆ«è¯¦ç»†çš„æ³¨é‡Šï¼Œä»è¿™äº›æ³¨é‡Šä¸­ï¼Œå¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ‰§è¡Œå™¨è¿™ä¸€ç«¯æ˜¯æ€ä¹ˆè®°å½•å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œä¿¡æ¯åˆ°æœ¬åœ°æ–‡ä»¶ä¸­çš„ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥äº†è§£éƒ½è®°å½•äº†å“ªäº›ä¿¡æ¯åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚è€Œä¸”XxlJobContextå¯¹è±¡çš„ä½œç”¨ä¹Ÿä½“ç°å¾—å¾ˆæ˜æ˜¾äº†ã€‚æœ€æœ€å…³é”®çš„å°±æ˜¯ï¼Œåœ¨JobThreadçš„runæ–¹æ³•çš„finallyå—ä¸­ï¼Œæ‰§è¡Œå™¨è¿™ä¸€ç«¯å›è°ƒçº¿ç¨‹çš„ç»„ä»¶ç»ˆäºè¢«è°ƒç”¨äº†ã€‚å°±æ˜¯ä¸‹é¢è¿™ä¸ªä»£ç å—ä¸­çš„å†…å®¹ã€‚

```
åˆ›å»ºå°è£…å›è°ƒä¿¡æ¯çš„HandleCallbackParamå¯¹è±¡
//æŠŠè¿™ä¸ªå¯¹è±¡æäº¤ç»™TriggerCallbackThreadå†…éƒ¨çš„callBackQueueé˜Ÿåˆ—ä¸­
TriggerCallbackThread.pushCallBack(new HandleCallbackParam(
		triggerParam.getLogId(),
		triggerParam.getLogDateTime(),
		XxlJobContext.getXxlJobContext().getHandleCode(),
		XxlJobContext.getXxlJobContext().getHandleMsg() )
);
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨JobThreadä¸­ï¼Œå…ˆåˆ›å»ºäº†ä¸€ä¸ªHandleCallbackParamå¯¹è±¡ï¼Œç„¶åæŠŠå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¿¡æ¯éƒ½å°è£…åˆ°è¯¥å¯¹è±¡ä¸­ï¼Œå…¶ä¸­æœ€å…³é”®çš„å°±æ˜¯å®šæ—¶ä»»åŠ¡çš„ä¸»é”®IDï¼Œè¿˜æœ‰æ‰§è¡Œç»“æœçš„çŠ¶æ€ç ã€‚ç´§æ¥ç€ï¼Œè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«pushCallBackæ–¹æ³•æ”¾åˆ°TriggerCallbackThreadç»„ä»¶ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ç›´æ¥ä»ä»£ç å±‚é¢çœ‹çœ‹TriggerCallbackThreadç»„ä»¶ä¸­çš„å†…å®¹å§ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç å—ã€‚

```
public class TriggerCallbackThread {

     //å•ä¾‹å¯¹è±¡ï¼Œå°±ä¸å†é‡å¤è§£é‡Šäº†
    private static TriggerCallbackThread instance = new TriggerCallbackThread();

    public static TriggerCallbackThread getInstance(){
        return instance;
    }

    //è¦è¢«å›è°ƒç»™è°ƒåº¦ä¸­å¿ƒçš„å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœçš„ä¿¡æ¯ï¼Œä¼šå°è£…åœ¨HandleCallbackParamå¯¹è±¡ä¸­ï¼Œè€Œè¯¥å¯¹è±¡ä¼šå…ˆå­˜æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­
    private LinkedBlockingQueue<HandleCallbackParam> callBackQueue = new LinkedBlockingQueue<HandleCallbackParam>();

    //æŠŠå°è£…å›è°ƒä¿¡æ¯çš„HandleCallbackParamå¯¹è±¡æäº¤ç»™callBackQueueä»»åŠ¡é˜Ÿåˆ—
    public static void pushCallBack(HandleCallbackParam callback){
        getInstance().callBackQueue.add(callback);
        logger.debug(">>>>>>>>>>> xxl-job, push callback request, logId:{}", callback.getLogId());
    }
    
    //å›è°ƒçº¿ç¨‹ï¼Œå°±æ˜¯è¿™ä¸ªçº¿ç¨‹æŠŠå›è°ƒä¿¡æ¯é€šè¿‡httpå‘é€ç»™è°ƒåº¦ä¸­å¿ƒ
    private Thread triggerCallbackThread;
    //é‡è¯•çº¿ç¨‹
    private Thread triggerRetryCallbackThread;

    public void start() {
        //å¯¹è®¿é—®è°ƒåº¦ä¸­å¿ƒçš„å®¢æˆ·ç«¯åšä¸€ä¸‹åˆ¤ç©ºæ“ä½œ
        if (XxlJobExecutor.getAdminBizList() == null) {
            logger.warn(">>>>>>>>>>> xxl-job, executor callback config fail, adminAddresses is null.");
            return;
        }
        //å¯åŠ¨å›è°ƒçº¿ç¨‹
        triggerCallbackThread = new Thread(new Runnable() {
            @Override
            public void run() {
                while(!toStop){
                    try {
                        //ä»å›è°ƒä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå›è°ƒçš„ä¿¡æ¯å¯¹è±¡
                        HandleCallbackParam callback = getInstance().callBackQueue.take();
                        if (callback != null) {
                            List<HandleCallbackParam> callbackParamList = new ArrayList<HandleCallbackParam>();
                            //è¿™é‡Œçš„æ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœå›è°ƒçš„ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰å¾…å›è°ƒçš„æ•°æ®ï¼Œå°±æŠŠæ‰€æœ‰æ•°æ®è½¬ç§»åˆ°ä¸€ä¸ªé›†åˆä¸­
                            //å¹¶ä¸”è¿”å›æœ‰å¤šå°‘æ¡è¦å›è°ƒçš„æ•°æ®
                            //æ³¨æ„ï¼Œæ‰§è¡ŒdrainToæ–¹æ³•çš„æ—¶å€™ï¼Œå›è°ƒé˜Ÿåˆ—ä¸­çš„æ•°æ®ä¹Ÿéƒ½è¢«æ¸…æ¥šäº†
                            int drainToNum = getInstance().callBackQueue.drainTo(callbackParamList);
                            //æŠŠæœ€å¼€å§‹å–å‡ºæ¥çš„æ•°æ®å†æ”¾å›å»ï¼Œå¦åˆ™å°±ä¼šè½ä¸‹ä¸€ä¸ªæ•°æ®äº†
                            //è¿™é‡Œè¦å¼„æ¸…æ¥šï¼Œæ¯ä¸ªå®šæ—¶ä»»åŠ¡çš„å›è°ƒä¿¡æ¯éƒ½ä¼šé€šè¿‡triggerCallbackThreadè¿™ä¸ªç»„ä»¶è¿›è¡Œå›è°ƒ
                            //æ‰€ä»¥ä¼šæœ‰å¾ˆå¤šå›è°ƒä¿¡æ¯æäº¤ç»™å›è°ƒé˜Ÿåˆ—ï¼Œå›è°ƒçš„æ—¶å€™ï¼Œè‡ªç„¶ä¹Ÿæ˜¯æ‰¹é‡å›è°ƒ
                            callbackParamList.add(callback);
                            if (callbackParamList!=null && callbackParamList.size()>0) {
                                //åœ¨è¿™é‡Œæ‰§è¡Œå›è°ƒç»™è°ƒåº¦ä¸­å¿ƒçš„æ“ä½œ
                                doCallback(callbackParamList);
                            }
                        }
                    } catch (Exception e) {
                        if (!toStop) {
                            logger.error(e.getMessage(), e);
                        }
                    }
                }
                try {
                    //èµ°åˆ°è¿™é‡Œï¼Œå°±æ„å‘³ç€é€€å‡ºäº†å¾ªç¯ï¼Œå…¶å®ä¹Ÿå°±æ„å‘³ç€triggerCallbackThreadçº¿ç¨‹è¦åœæ­¢å·¥ä½œäº†
                    List<HandleCallbackParam> callbackParamList = new ArrayList<HandleCallbackParam>();
                    //è¿™é‡Œä¼šå†æ¬¡æŠŠå›è°ƒé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ”¾åˆ°æ–°çš„é›†åˆä¸­
                    int drainToNum = getInstance().callBackQueue.drainTo(callbackParamList);
                    if (callbackParamList!=null && callbackParamList.size()>0) {
                        //æœ€åå†å›è°ƒä¸€æ¬¡ä¿¡æ¯ç»™æ³¨å†Œä¸­å¿ƒ
                        doCallback(callbackParamList);
                    }
                } catch (Exception e) {
                    if (!toStop) {
                        logger.error(e.getMessage(), e);
                    }
                }
                logger.info(">>>>>>>>>>> xxl-job, executor callback thread destroy.");
            }
        });
        triggerCallbackThread.setDaemon(true);
        triggerCallbackThread.setName("xxl-job, executor TriggerCallbackThread");
        triggerCallbackThread.start();
    }

     /**
     * @author:Bç«™UPä¸»é™ˆæ¸…é£æ‰¬ï¼Œä»é›¶å¸¦ä½ å†™æ¡†æ¶ç³»åˆ—æ•™ç¨‹çš„ä½œè€…ï¼Œä¸ªäººå¾®ä¿¡å·ï¼šchenqingfengyangã€‚
     * @Description:ç³»åˆ—æ•™ç¨‹ç›®å‰åŒ…æ‹¬æ‰‹å†™Nettyï¼ŒXXL-JOBï¼ŒSpringï¼ŒRocketMqï¼ŒJavacï¼ŒJVMç­‰è¯¾ç¨‹ã€‚
     * @Date:2023/7/17
     * @Description:å›è°ƒå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œä¿¡æ¯ç»™è°ƒåº¦ä¸­å¿ƒçš„æ–¹æ³•
     */
    private void doCallback(List<HandleCallbackParam> callbackParamList){
        boolean callbackRet = false;
        //è·å¾—è®¿é—®è°ƒåº¦ä¸­å¿ƒçš„å®¢æˆ·ç«¯çš„é›†åˆï¼Œå¹¶ä¸”éå†å®ƒä»¬
        for (AdminBiz adminBiz: XxlJobExecutor.getAdminBizList()) {
            try {
                //åœ¨è¿™é‡Œè¿›è¡Œå›è°ƒ
                ReturnT<String> callbackResult = adminBiz.callback(callbackParamList);
                if (callbackResult!=null && ReturnT.SUCCESS_CODE == callbackResult.getCode()) {
                    //å›è°ƒæˆåŠŸäº†ï¼Œè®°å½•ä¸€ä¸‹æ—¥å¿—
                    callbackLog(callbackParamList, "<br>----------- xxl-job job callback finish.");
                    //å›è°ƒæ ‡å¿—ç½®ä¸ºtrueï¼Œè¯´æ˜å›è°ƒæˆåŠŸäº†
                    callbackRet = true;
                    break;
                } else {
                    //å›è°ƒå¤±è´¥äº†ï¼Œè®°å½•ä¸€ä¸‹æ—¥å¿—
                    callbackLog(callbackParamList, "<br>----------- xxl-job job callback fail, callbackResult:" + callbackResult);
                }
            } catch (Exception e) {
                //å›è°ƒå‡ºç°å¼‚å¸¸äº†ï¼Œè®°å½•ä¸€ä¸‹æ—¥å¿—
                callbackLog(callbackParamList, "<br>----------- xxl-job job callback error, errorMsg:" + e.getMessage());
            }
        }
        if (!callbackRet) {
            //è¿™é‡Œå°±æ˜¯å›è°ƒå¤±è´¥äº†çš„æ„æ€ï¼Œè¦æŠŠå›è°ƒå¤±è´¥çš„æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ä¸€ä¸ªä¸“é—¨çš„æ–‡ä»¶å½“ä¸­ï¼Œæ–¹ä¾¿é‡è¯•çº¿ç¨‹é‡æ–°å›è°ƒ
            appendFailCallbackFile(callbackParamList);
        }
    }

    
}
```

åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨TriggerCallbackThreadç»„ä»¶ä¸­ï¼Œå…¶å®ä¹Ÿæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯triggerCallbackThreadçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ä¸“é—¨ç”¨æ¥æŠŠå®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœå‘é€ç»™è°ƒåº¦ä¸­å¿ƒçš„ã€‚å…·ä½“é€»è¾‘éƒ½å†™åœ¨ä»£ç å—ä¸­äº†ï¼Œæœ€ç»ˆå°±æ˜¯é€šè¿‡adminBiz.callback(callbackParamList)è¿™è¡Œä»£ç ï¼Œé€šè¿‡httpåè®®å‘é€ç»™è°ƒåº¦ä¸­å¿ƒã€‚æ›´è¯¦ç»†çš„ä»£ç æˆ‘å°±ä¸å±•ç¤ºäº†ï¼Œå¤§å®¶ç›´æ¥çœ‹æºç å°±è¡Œã€‚æˆ‘ç›¸ä¿¡ç»è¿‡å‰é¢è¿™ä¹ˆå¤šçš„é“ºå«ï¼Œè¿™æ—¶å€™å­¦ä¹ æºç å¯¹å¤§å®¶æ¥è¯´ä¸€å®šæ˜¯å°èœä¸€ç¢Ÿã€‚å½“ç„¶ï¼Œåœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œå¤§å®¶è‚¯å®šè¿˜èƒ½çœ‹è§å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å°±æ˜¯triggerRetryCallbackThreadçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹çš„åŠŸèƒ½å°±æ˜¯åœ¨triggerCallbackThreadçº¿ç¨‹å›è°ƒå®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æœå¤±è´¥åï¼Œé‡æ–°å›è°ƒä¸€æ¬¡ï¼Œé‡æ–°å›è°ƒçš„è¿™ä¸€æ¬¡ï¼Œå°±äº¤ç»™triggerRetryCallbackThreadçº¿ç¨‹æ¥æ‰§è¡Œã€‚å½“ç„¶ï¼Œæœ€ç»ˆä»ç„¶æ˜¯é€šè¿‡httpåè®®æ¥å‘é€çš„ã€‚è¿™äº›åŠŸèƒ½æˆ‘ä¹Ÿå°±ä¸å†è¯¦ç»†å±•ç¤ºäº†ï¼Œç•™ç»™å¤§å®¶å»æºç ä¸­å­¦ä¹ å§ã€‚æ‰€è°“æºç å°±æ˜¯æˆ‘æä¾›çš„ç¬¬ä¸‰ç‰ˆæœ¬ä»£ç ï¼Œå› ä¸ºç¬¬ä¸‰ç‰ˆæœ¬ä»£ç å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å’Œæºç ä¸€è‡´äº†ã€‚å…¶å®æºç ä¸€ç‚¹ä¹Ÿä¸éš¾ï¼Œå­¦å®Œæˆ‘çš„ä»£ç ï¼Œæºç ä½ å°±å­¦ä¼šäº†ï¼Œè€Œä¸”æ˜¯æ¯ä¸€è¡Œæºç éƒ½å­¦ä¼šäº†ã€‚

å”‰ï¼Œæ²¡åŠæ³•ï¼Œå†™ç€å†™ç€å°±å†™å¤šäº†ï¼Œå…¶å®è¿™ç‚¹ä¸œè¥¿ç›´æ¥çœ‹æºç ï¼Œæœ€å¤šååˆ†é’Ÿå°±çœ‹å®Œäº†ï¼Œçœ‹æ–‡ç« æ—¶é—´å°±é•¿äº†ã€‚ä¸å€¼å½“ï¼ŒçœŸçš„ğŸ˜®â€ğŸ’¨ã€‚è¿™ä¸€ç« å°±è¿™æ ·å§ã€‚ä¸‹ä¸€ç« ä¸€å®šè¦çŸ­ï¼ï¼ï¼ä¸çŸ­ä¸æ˜¯ç¨‹åºå‘˜ï¼ï¼ï¼