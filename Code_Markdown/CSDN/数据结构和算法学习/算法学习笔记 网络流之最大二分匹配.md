@[toc]

> 参考算法导论26.3节 最大二分匹配

一些组合问题可以很容易地表述为最大流问题，之前讨论的多源点多汇点最大流问题就是一个例子。其他一些组合问题在表面上看，似乎与流网络没有多少关系，但实际上却能够归约 `reduced` 到最大流问题。这里讨论这样的一个问题：**在一个二分图中找出一个最大匹配** `finding a maximum matching in a bipartite graph` 。为了解决这个问题，将用到 *Ford-Fulkerson* 方法提供的**完整性性质** `integrality property` ，且将看到如何使用 *Ford-Fulkerson* 方法、在 $O(VE)$ 时间内解决图 $G = (V, E)$ 的最大二分匹配问题。

# 1. 最大二分匹配问题
给定一个无向图 $G = (V, E)$ ，一个**匹配**是边的子集 `a matching is a subset of edges` $M \subseteq E$ 、使得对于所有结点 $v \in V$ 、子集 $M$ 中最多有一条边与结点 $v$ 相连。如果子集 $M$ 中的某条边与结点 $v$ 相连，则称结点 $v$ 由 $M$ 所匹配；否则，结点 $v$ 就是**没有匹配的** `unmatched` 。**最大匹配** `maximum matching` 是最大基数的匹配，也就是说，对于任意匹配 $M'$ 有 $|M| \ge |M'|$ 的匹配 $M$ 。

这里的讨论中，我们将注意力集中在**寻找二分图的最大匹配上**。在一个二分图中，结点集合可以划分为 $V = L \cup R$ ，其中 $L, R$ 是不相交的，并且边集合 $E$ 中所有的边都横跨 $L$ 和 $R$ 。**进一步假定结点集合 $V$ 中的每个结点至少有一条边**。图26-8描述的是二分图中匹配的概念。
![在这里插入图片描述](https://img-blog.csdnimg.cn/803ebe49777146a3b9726270f61f4d22.png)
在二分图中寻找最大匹配问题，有着许多的实际应用。例如，把一个机器集合 $L$ 和要同时执行的任务集合 $R$ 相匹配。$E$ 中有边 $(u,v)$ 就说明：一台特定的机器 $u \in L$ 能够完成一项特定的任务 $v \in R$ 。**最大匹配能够让尽可能多的机器运行起来**。

# 2. 寻找最大二分匹配
使用 *Ford-Fulkerson* 方法，可以在关于 $|V|$ 和 $|E|$ 的多项式时间内，找出无向二分图 $G = (V, E)$ 的最大匹配。**解决这一问题的关键技巧是构建一个流网络，其中的流对应于匹配**，如图26-8 c)所示。我们将二分图 $G$ 所对应的流网络 $G'=(V', E')$ 定义如下：==设源点 $s$ 和汇点 $t$ 为不属于结点集 $V$ 的新结点，并设 $V' = V \cup \{ s, t\}$== 。如果图 $G$ 的结点集划分为 $V = L \cup R$ ，则 ==$E$ 中从 $L$ 指向 $R$ 的边都是流网络 $G'$ 的边。此外，$G'$ 中的边还包括如下的 $|V|$ 条新有向边==：
$$E' = \{ (s, u) \mid u \in L \} \cup \{ (u, v) \mid (u, v) \in E, u \in L, v \in R \} \cup \{ (v, t) \mid v \in R\}$$

要完成流网络的构建，需要**给 $E'$ 中的每条边赋予单位容量**。==由于（假定二分图）结点集 $V$ 中的每个结点至少有一条相连的边，$|E| \ge |V| / 2$（两个点至少有一条边），即 $|V| \le 2|E|$ 。因此 $|E| \le |E '| = |E| + |V| \le 3|E|$ ，所以 $|E '| = \Theta(E)$== 。

下面的引理证明了：**图 $G$ 中的一个匹配直接对应 $G$ 所对应的流网络 $G'$ 中的一个流**。此外一个定义是：==对于流网络 $G = (V, E)$ 中的一个流 $f$ 来说，如果对于所有的边 $(u, v) \in V \times V$ ，$f(u, v)$ 都是整数值，则称流 $f$ 是**整数值** `integer-valued` 的==（不仅仅是 $| f|$ 为整数值）。

**引理26.9** 设 $G = (V, E)$ 为一个二分图，其结点划分为 $V = L \cup R$ ，设 $G' = (V', E')$ 是图 $G$ 所对应的流网络。如果 $M$ 是 $G$ 中的一个匹配，则流网络 $G'$ 中存在一个整数值的流 $f$ ，使得 $|f| = |M|$ 。相反，如果 $f$ 是 $G'$ 中的一个整数值的流，则 $G$ 中存在一个匹配 $M$ ，使得 $|M| = |f|$ 。
**证明**：首先证明**图 $G$ 中的一个匹配 $M$ 对应流网络 $G'$ 中一个整数值的流 $f$** 。定义流 $f$ 如下：==如果边 $(u, v) \in M$ ，则 $f(s, u) = f(u, v) = f(v, t) = 1$ 。对于所有其他属于 $E'$ 的边 $(u, v)$ ，定义 $f(u, v) = 0$== 。可以很容易地验证，这样所定义的流 $f$ 满足容量限制和流量守恒性质。

 从直观上看，每条边 $(u, v) \in M$ 对应「流网络 $G'$ 中流经路径 $s \to u \to v \to t$ 的一个单位的流」。而且，除了源点 $s$ 和汇点 $t$ 之外，由于子集 $M$ 中的边所导出的路径都是结点不相交的 `vertex-disjoint` 。**横跨切割 $( L \cup \{ s \} ,\ R \cup \{ t\} )$ 的净流量等于 $|M|$ 。因此，根据引理 $26.4$ ，流 $f$ 的值为 $| f| = | M|$** 。
 
要证明反向的论断，设 **$f$ 为 $G'$ 中的一个整数值的流**，并设
$$M =\{ (u, v) \mid u \in L, v\in R, 并且 f(u, v) > 0\}$$

每个结点 $u \in L$ 只有一条进入的边，即 $(s, u)$ ，其容量为 $1$ 。因此，每个结点 $u \in L$ 至多有 $1$ 个单位的流进入，而如果有 $1$ 个单位的流进入，根据流量守恒性质，离开该结点的流也必须有 $1$ 个单位。此外，==由于 $f$ 是整数值的流（结合容量为 $1$ ，要么不流入、要么流入一个单位），对于每个结点 $u \in L$ ，流入的这一个单位的流只能最多从一条边进入，也只能最多从一条边流出==。因此，$1$ 个单位的流进入结点 $u$ 、当且仅当恰好存在一个结点 $v \in R$ 使得 $f(u, v) = 1$ ，并且**在离开「每个结点 $u\ (u \in L)$ 」的边中，至多有一条出边会带有正值的流**（即对于所有结点 $u \in L$ ，集合 $M$ 中最多有一条边与结点 $u$ 相连）。对每个结点 $v \in R$ 也有一个对称的结论（即对于所有结点 $v \in R$ ，集合 $M$ 中最多有一条边与结点 $v$ 相连）。因此，集合 $M$ 是一个匹配。

要证明 $|M| = |f|$ ，只要注意到对于每个匹配的结点 $u \in L$ ，有 $f(s,u ) = 1 = f(u, v)\ (v \in R)$ ，并且对于每条边 $(u, v) \in E - M$ ，有 $f(u, v) = 0$ 。因此，**横跨切割 $(L \cup \{ s\}, R\cup \{ t\})$ 的净流量 $f(L\cup \{ s\}, R\cup \{ t\})$ 等于 $|M|$ 。因此，根据引理26.4，流的值为 $|f| = |M|$** 。 
<b></b>

基于引理26.9，我们希望得出结论，「二分图 $G$ 中的一个最大匹配（的基数）」对应于「流网络 $G'$ 中的一个最大流（的值）」，并且，因此可以通过「在对应流网络 $G'$ 上运行一个最大流算法来计算图 $G$ 中的最大匹配」。这一推理过程中存在的唯一障碍是，最大流算法可能会返回一个 $G'$ 中的流，其中一些 $f(u,v)$ 不是整数，即使**流的值 $| f |$ 必须是整数（这样才能使用引理26.9）**`The only hitch in this reasoning is that the maximum-flow algorithm might return a flow in G' for which some f(u,v) is not an integer, even though the flow value |f| must be an integer`。不过下面的定理将说明，如果使用 *Ford-Fulkerson* 方法，则这个问题不会发生。

**定理26.10**（**完整性定理**）如果容量函数 $c$ 只能取整数值，则 *Ford-Fulkerson* 方法所生成的最大流 $f$ 满足 $|f|$ 是整数值的性质。而且，对于所有的结点 $u, v$ ，$f(u, v)$ 的值都是整数。
**证明**： 通过对迭代次数进行归纳来进行证明，具体证明为算导练习26.3-2。

下面来证明引理26.9的一个推论。

**推论26.11** 二分图 $G$ 中的一个最大匹配 $M$ 的基数，等于其对应的流网络 $G'$ 中某一最大流 $f$ 的值。
**证明**：下面的证明使用引理26.9中的术语。假定 $M$ 是图 $G$ 中的一个最大匹配，且其相应的流网络 $G'$ 中的流 $f$ 不是最大流。那么 $G'$ 中存在一个最大流 $f'$ ，满足 $| f' | > | f |$ 。由于 $G'$ 的容量都是整数值（设定都为单位容量，于是 $f(u, v) = 0\ \textrm{or}\ 1$ ），因此根据定理26.10，可以假设 $f'$ 的值是整数值。因此根据引理26.9，$f'$ 对应 $G$ 中的一个匹配 $M'$ ，且其基数为 $|M ' | = | f' | > | f| = | M|$ ，这与 $M$ 是最大匹配这一假设相矛盾。用类似的方法可以证明：**如果 $f$ 是图 $G'$ 中的一个最大流，则其对应的匹配是 $G$ 的一个最大匹配**。$\blacksquare$ 


---

因此，给定一个二分无向图 $G$ ，可以通过创建流网络 $G'$ ，在其上运行 *Ford-Fulkerson* 方法来找到一个最大匹配。**这个最大匹配 $M$ 可以直接从找到的整数最大流 $f$ 获得**。==由于二分图中的任何匹配的基数的最大值为 $\min(L, R)= O(V)$ ，$G'$ 中的最大流的值为 $O(V)$ 。因此，可以在 $O(| f| \times E') = O(VE') = O(VE)$ 时间内找到一个二分图的最大匹配，因为 $|E ' | = \Theta (E)$== 。



