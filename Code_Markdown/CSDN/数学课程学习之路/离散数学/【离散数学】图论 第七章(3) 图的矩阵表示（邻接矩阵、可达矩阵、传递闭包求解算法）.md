> 本文属于「离散数学」系列文章之一。这一系列着重于离散数学的学习和应用。由于内容随时可能发生更新变动，欢迎关注和收藏[离散数学系列文章汇总目录](https://memcpy0.blog.csdn.net/article/details/119997004)一文以作备忘。此外，在本系列学习文章中，为了透彻理解数学知识，本人参考了诸多博客、教程、文档、书籍等资料。以下是本文的不完全参考目录，在后续学习中还会逐渐补充：
> - （**国外经典教材**）离散数学及其应用 第八版 `Discrete Mathematics and Its Applications Eighth Edition` ，作者是 `Kenneth H.Rosen` ，袁崇义译，机械工业出版社
> - 离散数学 第二版，武波等编著，西安电子科技大学出版社，2006年
> - 离散数学 第三版，方世昌等编著，西安电子科技大学出版社，2013年
> - （经典参考书及其题解）离散数学/离散数学——理论•分析•题解，左孝凌、李为鉴、刘永才编著，上海科学技术文献出版社
> - 离散数学习题集：数理逻辑与集合论分册，耿素云；图论分册，耿素云；抽象代数分册， 张立昂。北京大学出版社

@[toc]

---
# 7.3 图的矩阵表示
采用矩阵表示图，便于计算机存储和处理图的信息（只对小图、稠密图有点用），也便于运用代数的方法研究图的性质（这才是重点！），例如，我们可以通过矩阵计算结果，判定图的连通性/可达性等问题。
## 7.3.1 邻接矩阵
**定义7.3.1** 设 $G= \langle V, E\rangle$ 是一个**线图**，结点集合 $V = \{ v_1, v_2, \dots, v_n\}$ ，令 $A(G) = [a_{ij}]_{n\times n}$ ，其中：
$$a_{ij} = \begin{cases}
1 \quad &若[v_i,\ v_j] \in E\\
0\quad &若[v_i,\ v_j] \notin E
\end{cases}
$$ 则称 $A(G)$ 为 $G$ 的**邻接矩阵** `adjacency matrix` 。

【例1】设 $G_1$ 是有向图、$G_2$ 是无向图，分别如图7.3.1(a)和(b)所示，写出 $G_1, G_2$ 的邻接矩阵。
<img src="https://img-blog.csdnimg.cn/0973d9bf72544d14ab1f28398e12ad9e.png" width="45%">
解：
$$
A(G_1)= \begin{bmatrix}
1 & 1 & 0 & 0 \\
0 & 0 & 1 & 0\\ 
1 & 1 & 0 & 0 \\
0 & 0 & 1 & 1
\end{bmatrix} \ 
A(G_2)= \begin{bmatrix}
1 & 1 & 1 & 1 \\
1 & 0 & 1 & 0\\ 
1 & 1 & 0 & 1 \\
1 & 0 & 1 & 1
\end{bmatrix}
$$

**当结点编号次序不同时，同一个图所得的邻接矩阵可能不同**，但可以通过有限次的行、列变换而得到相同的邻接矩阵（同构的图？）。

通过图的邻接矩阵运算，可以判断图的一些性质。设 $G = \langle V, E\rangle$ 是**有向线图**，$|V| = n$ ，$A$ 是 $G$ 的邻接矩阵。
### 1. $AA^T$ 的元素的意义
<img src="https://img-blog.csdnimg.cn/db7a21f14006431abdfa7d043fe614e4.png" width="65%">

可知，$b_{ij} = \displaystyle \sum^n_{k = 1} a_{ik} \cdot a_{jk}$ ，如图7.3.2所示，则在 $G$ 中恰好有 $b_{ij}$ 个结点，从 $v_i$ 和 $v_j$ **均有边**引出到这些结点 $v_{k_1}, v_{k_2}, \dots, v_{k_n}$ 。特别地，**当 $i = j$ 时 $b_{ij}$ 表示 $v_i$ 的出度**。
 <img src="https://img-blog.csdnimg.cn/7f3b1341b34942cbaeb4d2822f4fbb7f.png#pic_center" width="30%">
 
### 2. $A^TA$ 的元素的意义
<img src="https://img-blog.csdnimg.cn/56d6bc317bf84e3fb054a645ba801921.png" width="65%">

可知，$b_{ij} = \displaystyle \sum^n_{k = 1} a_{ki} \cdot a_{kj}$ ，如图7.3.3所示，则在 $G$ 中恰好有 $b_{ij}$ 个结点，以这些结点为始点，**既有边**引入到 $v_i$ 、**又有边**引入到 $v_j$ 。特别地，**当 $i = j$ 时 $b_{ij}$ 表示 $v_i$ 的入度**。
<img src="https://img-blog.csdnimg.cn/f932da2f30cd4fe5ba54fcfa1ac8202b.png#pic_center" width="30%">

### 3. $A^{2} = A\times A$ 的元素的意义
<img src="https://img-blog.csdnimg.cn/ef01d7282ce440cf94815ee68c310c43.png" width="65%">

若有 $b_{ij} = \displaystyle \sum^n_{k = 1} a_{ik} \cdot a_{kj}$ ，如图7.3.4所示，则从 $v_i$ 到 $v_j$ 长度为 $2$ 的路有 $b_{ij}$ 条。特别地，当 $i = j$ 时 $v_i$ 到自身长度为 $2$ 的回路有 $b_{ij}$ 条。
<img src="https://img-blog.csdnimg.cn/32211c07997144e880d73192fbf2cc9a.png#pic_center" width="30%">

对于 $A^m =\underbrace{ A\times A\times \dots \times A}_{m个A},\ m \ge 1$ ，有如下结论。
**定理7.3.1** 设 $G = \langle V, E\rangle$ 为**有向线图**，结点集 $V = \{ v_1, v_2, \dots, v_n\}$ ，$A = [a_{ij}]_{n\times n}$ 为 $G$ 的邻接矩阵，$A^m = [a_{ij}^{(m)}]_{n\times n}$ ，则 $G$ 中从 $v_i$ 到 $v_j$ 有 $a_{ij}^{(m)}$ 条长度为 $m$ 的路。
**证明** 对 $m$ 进行归纳。
- 当 $m = 1, m = 2$ 时，由定义和上面的分析可知，显然成立；
- 设当 $m = t\ (t \ge 2)$ 时，命题成立；
- 当 $m = t + 1$ 时，由
$$A^{t + 1} = A \cdot A^t = [a_{ij}^{(t + 1)}]_{n\times n} =\bigg [\ \sum^n_{k = 1} a_{ik} \cdot a_{kj}^{(t)}\ \bigg]$$ 故 $\displaystyle a_{ij}^{(t + 1)} = \sum^n_{k = 1} a_{ik} \cdot a_{kj}^{(t)}$ 。根据邻接矩阵的定义可知，**$a_{ik}$ 表示结点 $v_i$ 与 $v_k$ 的长度为 $1$ 的路的条数**。根据归纳假设知，$a_{kj}^{(t)}$ 是连接 $v_k$ 与 $v_j$ 的长度为 $t$ 的路的条数。因此，$a_{ik} \cdot a_{kj}^{(t)}$ 表示从结点 $v_i$ 出发、经过 $v_k$ 、到达结点 $v_j$ 的长度为 $t+1$ 的路的条数。
对所有的 $k \in \{ 1, 2, \dots, n\}$ 求和得 $a_{ij}^{(t + 1)} = \displaystyle \sum_{k = 1}^n a_{ik} \cdot a_{kj}^{(t)}$ ，$a_{ij}^{(t + 1)}$ 就是从结点 $v_i$ 到结点 $v_j$ 的、所有长度为 $t + 1$ 的路的条数。故当 $k = t + 1$ 时命题也成立。

以上仅给出**有向线图**的一些基本结论，对于**无向线图**也有类似结论。

【例2】有向图 $G = \langle V, E\rangle$ 如图7.3.5所示，用 $G$ 的邻接矩阵计算从顶点 $v_3$ 到 $v_1$ 的所有**有向通路** `path` 。
<img src="https://img-blog.csdnimg.cn/47512ea576694ad781ca83422ec0ed09.png#pic_center" width="25%">
解：图 $G$ 的邻接矩阵为：
$$A =\begin{bmatrix}
0 & 1 & 0 & 0\\
0 & 0 & 1 & 1 \\
0 & 1 & 0 & 1 \\
1 & 1 & 0 & 0 
\end{bmatrix}
$$ 由 $A[3][1] = 0$ 知（下标从1开始），从顶点 $v_3$ 到 $v_1$ 没有长度为 $1$ 的通路。再计算 $A^2$ ：
$$A^2 =\begin{bmatrix}
0 & 0 & 1 & 1\\
1 & 2 & 0 & 1 \\
1 & 1 & 1 & 1 \\
0 & 1 & 1 & 1 
\end{bmatrix}$$ 由 $A^2 [3][1] = 1$ 可知，从顶点 $v_3$ 到 $v_1$ 的、长度为 $2$ 的路有 $1$ 条。根据计算过程：
$$\begin{aligned}
A^2[3][1] &= A[3][1] \times A[1][1] + A[3][2] \times A[2][1] \\ 
&+ A[3][3] \times A[3][1] + A[3][4] \times A[4][1] \\
&= 0 \times 0 + 1 \times 0 + 0\times 0 + 1 \times 1 = 1
\end{aligned}$$ 得到从顶点 $v_3$ 到 $v_1$ 的、长度为 $2$ 的有向路为 $(v_3,\ v_4,\ v_1)$ 。显然，它也是一条通路。再计算 $A^3$ ：
$$A^3 =\begin{bmatrix}
1 & 2 & 0 & 1\\
1 & 2 & 2 & 2 \\
1 & 3 & 1 & 2 \\
1 & 2 & 1 & 2 
\end{bmatrix}$$ 由 $A^3[3][1] = 1$ 知，从顶点 $v_3$ 到 $v_1$ 的、长度为 $3$ 的路有 $1$ 条。根据计算过程：
$$\begin{aligned}
A^3[3][1] &= A^2[3][1] \times A[1][1] + A^2[3][2] \times A[2][1] \\ 
&+ A^2[3][3] \times A[3][1] + A^2[3][4] \times A[4][1] \\
&= 1 \times 0 + 1 \times 0 + 1\times 0 + 1 \times 1 = 1
\end{aligned}$$ 得到从顶点 $v_3$ 到 $v_1$ 的、长度为 $3$ 的有向路为：从顶点 $v_3$ 到 $v_4$ 的一条长度为 $2$ 的路接上 $(v_4,\ v_1)$ 。再根据计算过程：
$$\begin{aligned}
A^2[3][4] &= A[3][1] \times A[1][4] + A[3][2] \times A[2][4] \\ 
&+ A[3][3] \times A[3][4] + A[3][4] \times A[4][4] \\
&= 0 \times 0 + 1 \times 1 + 0\times 1 + 1 \times 0 = 1
\end{aligned}$$   得到从顶点 $v_3$ 到 $v_4$ 的一条长度为 $2$ 的有向路是 $(v_3,\ v_2,\ v_4)$ 。所以，从顶点 $v_3$ 到 $v_1$ 的、长度为 $3$ 的有向路是 $(v_3,\ v_2,\ v_4, \ v_1)$ 。显然，它也是一条通路。

因为**对于 $4$ 个结点的有向图，当路的长度超过 $3$ 时，必定不是通路**，所以从顶点 $v_3$ 到 $v_1$ 的通路共有两条：$(v_3,\ v_4,\ v_1)$ 和 $(v_3,\ v_2,\ v_4,\ v_1)$ 。

---
## 7.3.2 可达矩阵
### 1. 可达矩阵定义
**定义7.3.2** 设 $G= \langle V, E\rangle$ 是一个**线图**，结点集合 $V = \{ v_1, v_2, \dots, v_n\}$ ，令 $P(G) = [p_{ij}]_{n\times n}$ ，其中：
$$p_{ij} = \begin{cases}
1 \quad &若从\ v_i\ 可达\ v_j\ \\
0\quad &若从\ v_i\ 不可达\ v_j
\end{cases}
$$ 则称 $P(G)$ 为 $G$ 的**可达矩阵**。

可达矩阵用于描述一个线图中、从任一结点到另一结点之间是否存在路。由于在图中「**两个结点之间有路**」，则「**必存在长度小于等于 $n - 1$ 的通路**」。另外，一般认为「**同一个结点到自身可达**」。因此，可用以下公式计算 $P(G)$ ：
$$P(G) = [p_{ij} ]_{n\times n} = A^0 \lor A^1 \lor \cdots \lor A^{n - 1}$$ 其中，$A^0$ 是 $n\times n$ 的单位矩阵，$\lor$ 是析取（或逻辑加/并）运算。即「顶点 $v_i$ 到达 $v_j$ 有长度为零的路、或有长度为 $1$ 的路、……、或有长度为 $n - 1$ 的路」，**这些路可能是通路、可能不是，但其中至少存在一条通路**。 

### 2. 可达矩阵求解连通性和强分图
为什么要在【图的连通性】后介绍【图的矩阵表示（邻接矩阵、可达矩阵）】，是因为**利用邻接矩阵 $A$ 和可达矩阵 $P$ ，可判断图的连通性**：
- **无向线图** $G$ 是连通图，当且仅当它的可达矩阵 $P$ 为全 $1$ 矩阵；
- **有向线图**  $G$ 是强连通图，当且仅当它的可达矩阵 $P$ 为全 $1$ 矩阵；
- **有向线图** $G$ 是单向连通图，当且仅当 $P \lor P^T$ 为全 $1$ 矩阵；
- **有向线图** $G$ 是弱连通图（忽略方向的底图为连通图），当且仅当以 $P\lor A^T$ 作为邻接矩阵，求得的可达矩阵 $P'$ 为全 $1$ 矩阵

**利用可达矩阵 $P$ ，还可求得有向图的强分图**。设 $G = \langle V, E\rangle$ ，$P$ 为图 $G$ 的可达矩阵。考察 $P \land P^T$ ，对于任何 $i\in \{ 1, 2, \dots, n\}$ ，设第 $i$ 行的**非零元素**所在的列分别是 $i_1, i_2, \dots, i_k$ 列（**第 $i$ 行必有第 $i$ 列非零**），则结点集 $V_i = \{ v_{i_1}, v_{i_2}, \dots, v_{i_k}\}$ 导出的子图 $G(V_i)$ 是图 $G$ 的一个强分图（一个**全 $1$ 子矩阵**；另知**强连通是等价关系**）。
【例3】 设有向线图 $G = \langle V, E\rangle$ 如图7.3.6所示，求 $G$ 的强分图。
<img src="https://img-blog.csdnimg.cn/fd44792742e24a9d982f69853b199d71.png#pic_center" width="35%">
解：首先求邻接矩阵 $A$ 的幂次：
$$A^0 = \begin{bmatrix}
1 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1
\end{bmatrix},
A^1 = \begin{bmatrix}
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 & 0\\
0 & 0 & 1 & 0 & 1\\
0 & 0 & 0 & 1 & 0
\end{bmatrix}, \\ {} \\
A^2 = \begin{bmatrix}
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 1 & 0 & 1 \\
0 & 0 & 1 & 0 & 1\\
0 & 0 & 0 & 1 & 0\\
0 & 0 & 1 & 0 & 1
\end{bmatrix},
A^3 = \begin{bmatrix}
0 & 0 & 1 & 0 & 1\\
0 & 0 & 0 & 1 & 0\\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 1 & 0 & 1\\
0 & 0 & 0 & 1 & 0
\end{bmatrix}, \\ {} \\
A^4 = A^2 = \begin{bmatrix}
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 1 & 0 & 1 \\
0 & 0 & 1 & 0 & 1\\
0 & 0 & 0 & 1 & 0\\
0 & 0 & 1 & 0 & 1
\end{bmatrix}
$$  可求得图 $G$ 的可达矩阵：
$$
P = A^0 \lor A^1 \lor A^2 \lor A^3 = \begin{bmatrix}
1 & 0 & 1 & 1 & 1\\
0 & 1 & 1 & 1 & 1\\
0 & 0 & 1 & 1 & 1\\
0 & 0 & 1 & 1 & 1\\
0 & 0 & 1 & 1 & 1
\end{bmatrix},\\ {} \\
P^T = \begin{bmatrix}
1 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0\\
1 & 1 & 1 & 1 & 1 \\
1 & 1 & 1 & 1 & 1 \\
1 & 1 & 1 & 1 & 1
\end{bmatrix},
P\land P^T = \begin{bmatrix}
1 & 0 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0\\
0 & 0 & 1 & 1 & 1 \\
0 & 0 & 1 & 1 & 1 \\
0 & 0 & 1 & 1 & 1
\end{bmatrix}
$$  由此可知，$G$ 的强分图有 $3$ 个：$\{ v_1 \},\ \{ v_2 \}, \ \{ v_3, v_4, v_5\}$ 。

【例4】设有向图 $D = \langle V, E\rangle$ 如图7.3.7所示，请回答下列问题。
<img src="https://img-blog.csdnimg.cn/f254ae90139a43fd94a864a052183739.png#pic_center" width="30%">
（1）图 $D$ 中 $v_1$ 到 $v_3$ 长度为 $3$ 的通路有多少条？
（2）图 $D$ 是哪种类型的连通图？
解：
（1）$D$ 的邻接矩阵及其幂次为：
$$A^0 = \begin{bmatrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1 
\end{bmatrix},
A^1 = \begin{bmatrix}
0 & 1 & 1 & 1\\
1 & 0 & 1 & 0\\
0 & 0 & 0 & 1\\
0 & 0 & 0 & 0
\end{bmatrix}, \\ {} \\
A^2 = \begin{bmatrix}
1 & 0 & 1 & 1 \\
0 & 1 & 1 & 2 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 
\end{bmatrix},
A^3 = \begin{bmatrix}
0 & 1 & 1 & 2\\
1 & 0 & 1 & 1\\
0 & 0 & 0 & 0\\
0 & 0 & 0 & 0
\end{bmatrix}
$$  由 $A^3[1][4] = 2$ 知，$v_1$ 到 $v_4$ 共有两条长度为 $3$ 的路，计算过程如下：
$$\begin{aligned}
A^3[1][4] &= A^2[1][1] \times A[1][4] + A^2[1][2] \times A[2][4] \\ 
&+ A^2[1][3] \times A[3][4] + A^2[1][4] \times A[4][4] \\
&= 1 \times 1 + 0 \times 0 + 1 \times 1 + 1 \times 0 = 2
\end{aligned} \\
\begin{aligned}
A^2[1][1] &= A[1][1] \times A[1][1] + A[1][2] \times A[2][1] \\ 
&+ A[1][3] \times A[3][1] + A[1][4] \times A[4][1] \\
&= 0 \times 0 + 1 \times 1 + 1 \times 0 + 1 \times 0 = 1
\end{aligned} \\
\begin{aligned}
A^2[1][3] &= A[1][1] \times A[1][3] + A[1][2] \times A[2][3] \\ 
&+ A[1][3] \times A[3][3] + A[1][4] \times A[4][3] \\
&= 0 \times 1 + 1 \times 1 + 1 \times 0 + 1 \times 0 = 1
\end{aligned}$$ 即这两条长度为 $3$ 的路为 $(v_1,\ v_2,\ v_1,\ v_4)$ 和 $(v_1,\ v_2,\ v_3,\ v_4)$ 。其中，$(v_1,\ v_2,\ v_3,\ v_4)$ 是一条通路，所以 $D$ 中 $v_1$ 到 $v_4$ 长度为 $3$ 的通路有一条。
（2）计算 $D$ 的可达矩阵。显然，$D$ 不是强连通的，因为 $v_3$ 到 $v_1$ 是不可达的；$D$ 是单侧连通的（即**对于任意顶点偶对，至少一个结点到另一个结点是可达的**），因为 $P \lor P^T$ 是全 $1$ 矩阵：
$$
P = A^0 \lor A^1 \lor A^2 \lor A^3 = \begin{bmatrix}
1 & 1 & 1 & 1 \\
1 & 1 & 1 & 1 \\
0 & 0 & 1 & 1 \\
0 & 0 & 0 & 1
\end{bmatrix},\\ {}\\ 
P^T = \begin{bmatrix}
1 & 1 & 0 & 0 \\
1 & 1 & 0 & 0 \\
1 & 1 & 1 & 0 \\
1 & 1 & 1 & 1 
\end{bmatrix},
P\lor P^T = \begin{bmatrix}
1 & 1 & 1 & 1  \\
1 & 1 & 1 & 1 \\
1 & 1 & 1 & 1 \\
1 & 1 & 1 & 1
\end{bmatrix}
$$  

---
## 7.3.3 求解传递闭包的快速算法
在第3章中，曾使用关系图表示二元关系，而关系图就是有向图。本节将利用**图的矩阵表示及其运算**，讨论求解有限集合上「二元关系的传递闭包」的快速算法。

**定理7.3.2** 设 $R$ 是集合 $V$ 上的二元关系，$n \in \Z^+$ ，对于任意 $a, b\in V,\ \langle a, b \rangle \in R^n$ 当且仅当 $R$ 的关系图 $G = \langle V, E\rangle$ 中，存在从 $a$ 到 $b$ 的长度为 $n$ 的有向路。
**证明** 对 $n$ 进行归纳：
（1）（归纳基础）根据关系图的定义，从 $a$ 到 $b$ 存在一条长度为 $1$ 的路，当且仅当 $\langle a, b \rangle \in R$ 。故当 $n = 1$ 时命题成立。
（2）（归纳假设）假设当 $n = k\ (k \ge 1)$ 时，命题成立。
（3）（归纳推理）当 $n = k + 1$ 时，**从 $a$ 到 $b$ 存在一条长度为 $k + 1$ 的路**，当且仅当**存在元素 $c \in V$ ，使得从 $a$ 到 $c$ 存在一条长度为 $k$ 的路、从 $c$ 到 $b$ 存在一条长度为 $1$ 的路**，当且仅当**存在元素 $c \in V$ 且满足 $\langle a, c\rangle \in R^k,\ \langle c, b \rangle \in R$** ，当且仅当 $\langle a, b \rangle \in R^k \circ R = R^{k + 1}$ 。
因此，从 $a$ 到 $b$ 存在一条长度为 $k + 1$ 的路，当且仅当 $\langle a, b \rangle \in R^{k + 1}$ 。

由邻接矩阵的定义可知，**集合 $V$ 上的二元关系 $R$ 的关系矩阵，就是其关系图的邻接矩阵。**
 
设 $M_R$ 是 $n$ 元素集合 $V$ 上的二元关系 $R$ 的关系矩阵（即对应关系图的邻接矩阵），$R$ 的传递闭包 $t(R) = R\cup R^2\cup \cdots \cup R^n$ ：
- $t(R)$ 的关系矩阵 $M_{t(R)} = M_R \lor M_{R^2} \lor \cdots \lor M_{R^n}$ 
- $t(R)$ 的关系图是—— $R$ 关系图中任意结点 $a, b$ 间「有长度为 $1$ 的路可达（即 $\langle a, b \rangle \in R$）、或有长度为 $2$ 的路可达（即 $\langle a, b \rangle \in R^2$）、……、或有长度为 $n$ 的路可达（即 $\langle a, b \rangle \in R^n$）」这一二元关系的关系图。

【例5】已知集合 $V = \{ a, b, c\}$ ，集合 $V$ 上二元关系 $R$ 的关系图如图7.3.8(a)所示，求关系 $R$ 的传递闭包 $t(R)$ 的关系矩阵和关系图：
<img src="https://img-blog.csdnimg.cn/d8b0325f10264bc590737768db8de455.png#pic_center" width="45%">
解：$R$ 的关系矩阵 $M_R = 
\begin{bmatrix} 
1 & 0 & 1\\
0 & 1 & 0 \\
1 & 1 & 0
\end{bmatrix}$ ，而 $$M_{t(R)} = M_R \lor M_{R^2} \lor M_{R^3} = \begin{bmatrix} 
1 & 0 & 1\\
0 & 1 & 0 \\
1 & 1 & 0
\end{bmatrix} \lor \begin{bmatrix}
1 & 1 & 1 \\
0 & 1 & 0 \\
1 & 1 & 1 
\end{bmatrix} \lor \begin{bmatrix}
1 & 1 & 1 \\
0 & 1 & 0 \\
1 & 1 & 1 
\end{bmatrix}
= \begin{bmatrix}
1 & 1 & 1 \\
0 & 1 & 0 \\
1 & 1 & 1
\end{bmatrix}$$ ，$t(R)$ 的关系图如图7.3.8(b)所示，它其实是图7.3.8(a)中结点间「**有长度大于 $0$ 的路可达**」关系的关系图。

虽然可用计算机编程，自动实现有限集合上「二元关系传递闭包」的计算，但是仍需要进行大量的位运算。下面介绍一个高效的求解传递闭包的算法，它是由[英]史蒂芬·沃舍尔 `Stephen Warshall` 于1960年提出的。

沃舍尔算法的实现，用到了**内点**的概念。给定有向图 $G = \langle V, E\rangle$ ，$V = \{ v_1, v_2, \dots, v_n\}$ ，$x, y \in V$ ，若 $x,\ v_{i1},\ v_{i2},\ \dots,\ v_{is},\ y$ 是 $G$ 中一条从 $x$ 到 $y$ 的有向路，则称 $v_{i1},\ v_{i2},\ \dots,\ v_{is}$ 为**从 $x$ 到 $y$ 的有向路的内点**。 

**定理7.3.3** 设有向图 $G= \langle V, E\rangle$ ，$V = \{ v_1, v_2, \dots, v_n\}$ ，$1 \le k \le n$ ，$v_i, v_j \in V$ 。若**从 $v_i$ 到 $v_j$ 存在所有内点属于 $\{ v_1, v_2, \dots, v_k\}$ 的路**，当且仅当**存在从 $v_i$ 到 $v_j$ 的路、并且所有内点属于 $\{ v_1, v_2, \dots, v_{k - 1} \}$** ，或者**存在从 $v_i$ 到 $v_k$ 的路和从 $v_k$ 到 $v_j$ 的路、并且两者所有内点均属于 $\{ v_1, v_2, \dots, v_{k - 1}\}$** 。
证明留作练习。
在定理7.3.3中，从 $v_i$ 到 $v_j$ 并且内点属于 $\{ v_1, v_2, \dots, v_{k - 1}\}$ 的路如图7.3.9(a)所示，从 $v_i$ 到 $v_k$ 和从 $v_k$ 到 $v_j$ 、并且两者所有内点均属于 $\{v_1, v_2, \dots, v_{k - 1}\}$ 的路如图7.3.9(b)所示：
<img src="https://img-blog.csdnimg.cn/35190326209a4bc1843074a1ac9bebcf.png#pic_center" width="65%">

给定 $M_R$ 是 $n$ 元素集合 $V$ 上的二元关系 $R$ 的关系矩阵，$V = \{ v_1, v_2, \dots, v_n\}$ ，其关系图是有向图 $G = \langle V, E\rangle$ 。设 $1 \le k \le n$ ，构造矩阵 $W^k = [W_{ij}^k]_{n \times n}$ ，其中 $W_{ij}^k= 1$ 表示**存在从 $v_i$ 到 $v_j$ 的路、并且内点属于 $V = \{v_1, v_2, \dots, v_k\}$** ，则 $M_{t(R)} = W^n$ 。

根据以上知识我们知道，$W_{ij}^k = 1$ 当且仅当**存在从 $v_i$ 到 $v_j$ 的路、并且所有内点属于 $\{ v_1, v_2, \dots, v_{k - 1} \}$**，或者**存在从 $v_i$ 到 $v_k$ 的路和从 $v_k$ 到 $v_j$ 的路、并且两者所有内点均属于 $\{ v_1, v_2, \dots, v_{k - 1}\}$** 。所以有：$$W_{ij}^k = W_{ij}^{k - 1} \lor (W_{ik}^{k - 1} \land W_{kj}^{k - 1})$$      显然：
- $W^0 = M_R$ ，此时 $W^0_{ij} = 1$ 表示**存在从 $v_i$ 到 $v_j$ 的路、并且内点属于 $\varnothing$** ，即 **$v_i$ 和 $v_j$ 直连、其间不经过任何其他点**； 
- 当 $k = 1$ 时，$W_{ij}^1 = W_{ij}^0 \lor (W_{i1}^0 \land W_{1j}^0)$ ；
- 当 $k = 2$ 时，$W_{ij}^2 = W_{ij}^1 \lor (W_{i2}^1 \land W_{2j}^1)$ ；
- ……
- 如此下去，当 $k = n$ 时，$W_{ij}^n = W_{ij}^{n - 1} \lor (W_{in}^{n - 1} \land W_{nj}^{n - 1})$ ，就得到传递闭包的关系矩阵 $M_{t(R)} = W^n$ 。

算法的过程描述如下：
（1）置新矩阵 $W = (M_R)_{n \times n}$ 。。
（2）置 $k = 1$ ;
（3）对 $i = 1, 2, \dots, n$ ，如果 $W[i][k] = 1$（即存在从 $v_i$ 到 $v_k$ 的路、并且内点属于 $\varnothing$ ），则有：$$W[i][j] = W[i][j] \lor W[k][j]$$ 即**是否存在从 $v_i$ 到 $v_j$ 的路、内点属于 $\{v_1\}$** ，取决于是否存在从 $v_k$ 到 $v_j$ 的路、并且内点属于 $\varnothing$ ；
（4）$k = k + 1$ ；
（5）如果 $k \le n$ ，则转步骤(3)，否则停止。

以上沃舍尔算法，可以简述为：按列号顺序，对 $R$ 的关系矩阵 $W$ 的每一列中的元素、从上至下依次扫描每行，如果当前扫描的是第 $i$ 行第 $k$ 列、且遇到 $1$ 时，将 $1$ 所对应的第 $i$ 行析取第 $k$ 行、作为该行的新值。

【例6】设二元关系 $R$ 的关系矩阵 $M_R = \begin{bmatrix} 0 & 0 & 0 & 1\\
1 & 0 & 1 & 0 \\
1 & 0 & 0 & 1\\
0 & 0 & 1 & 0 \end{bmatrix}$ ，求 $R$ 的传递闭包。
解：
$$W^0 = M_R =  \begin{bmatrix} 0 & 0 & 0 & 1\\
1 & 0 & 1 & 0 \\
1 & 0 & 0 & 1\\
0 & 0 & 1 & 0 \end{bmatrix} \\ {} \\
W^1 =  \begin{bmatrix} 0 & 0 & 0 & 1\\
1 & 0 & 1 & 1 \\
1 & 0 & 0 & 1\\
0 & 0 & 1 & 0 \end{bmatrix} \\ {} \\
W^2 =  \begin{bmatrix} 0 & 0 & 0 & 1\\
1 & 0 & 1 & 1 \\
1 & 0 & 0 & 1\\
0 & 0 & 1 & 0 \end{bmatrix} \\ {} \\
W^3 =  \begin{bmatrix} 0 & 0 & 0 & 1\\
1 & 0 & 1 & 1 \\
1 & 0 & 0 & 1\\
1 & 0 & 1 & 1 \end{bmatrix} \\ {} \\
W^4 = M_{t(R)} =  \begin{bmatrix} 1 & 0 & 1 & 1\\
1 & 0 & 1 & 1 \\
1 & 0 & 1 & 1\\
1 & 0 & 1 & 1 \end{bmatrix}
$$
