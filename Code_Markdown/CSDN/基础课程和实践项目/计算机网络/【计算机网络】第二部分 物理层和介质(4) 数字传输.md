@[toc]


计算机网络用于在网络节点之间传送信息。**信息需要转换为数字信号或模拟信号，再传输出去**。在[【计算机网络】第二部分 物理层和介质(3) 数据和信号](https://memcpy0.blog.csdn.net/article/details/122119955)中，讨论了（模拟或数字）数据和（模拟或数字）信号——==数据可以是数字的、也可以是模拟的，表示数据的信号可以是数字的、或者模拟的，以及**数字传输相对于模拟传输的优点和缺点**==。[【计算机网络】第二部分 物理层和介质(5) 模拟传输](https://memcpy0.blog.csdn.net/article/details/123059004)讨论到模拟信号的转换 `conversion to analog signals` 。

本篇讨论到数字信号的转换 `conversion to digital signals` ：首先讨论**数字到数字转换** `digital-to-digital conversion` 技术，这种技术将数字数据转换为数字信号 `convert digital data to digital signals` 。再讨论**模拟到数字转换** `analog-to-digital conversion` ，这种技术将模拟信号转换为数字信号 `change an analog signal to a digital signal`（实际上是将模拟信号转为数字数据，再通过数字到数字转换转为数字信号）。最后讨论**传输模式** `transmission mode` 。

---
# 4.1 数字到数字转换
本节中说明「**以数字（信号）方式传输数据所用的机制和技术**」，我们会看到如何**使用数字信号表示数字数据**，或者说将数字数据**转换**为数字信号。这种转换涉及三种技术：**线路编码** `line coding` 、**块编码或分组编码** `block coding` 和**扰动** `scrambling` 。

## 4.1.1 线路编码
假定以文本、数字、图形图像、音频或视频为形式的数据，在计算机内存中都是以位序列形式保存的。**线路编码将位序列（数字数据）转换为数字信号的过程**——==在发送方，数字数据被编码成数字信号；在接收方，解码数字信号，重新生成数字数据==。图4.1说明了这个过程。
![在这里插入图片描述](https://img-blog.csdnimg.cn/571646938a934dc1a87146eaa96750ce.png)
在讨论不同的线路编码方案之前，先说明它们的共同特性。
### 1. 数据元素、信号元素、比率
首先要区分**数据元素** `data element` 和**信号元素** `signal element`——==在数据通信中，我们的目标是发送数据元素==，数据元素是**表示一块信息的最小实体**，即位 `bit` 。信号元素则是**数字信号的最小单元**（都具有最小性），在数字数据通信中，信号元素承载数据单元。总而言之，==数据元素是我们需要发送的，信号元素是我们能发送的==；数据元素被承载，信号元素是载体。

接着，定义**比率** $r$ 为**每个信号元素承载的数据元素的数量**，对于后面讨论的每个线路编码，我们都会给出它的 $r$ 值。一个比喻是，假设每个数据元素是需要从一个地方到另一个地方的人，信号元素则是送人的车辆——如果 $r =1$ ，意味着每个人驾驶一辆车；如果 $r > 1$ ，意味着多个人乘坐一辆车；还可以有一个人驾驶一辆车和一辆拖车（$r = \dfrac{1}{2}$）。图4.2说明了几种不同 $r$ 值的情况：
- 图4.2a中，一个信号元素承载一个数据元素（$r = 1$）；
- 图4.2b中，两个信号元素（两个转换）承载一个数据元素（$r = \dfrac{1}{2}$），我们会在后面看到，**需要额外的信号元素来保证同步的情况**；
- 图4.2c中，一个信号元素承载两个数据元素（$r = 2$）;
- 图4.2d中，三个一组的信号元素承载四个一组的数据元素（$r = \dfrac{4}{3}$）
![在这里插入图片描述](https://img-blog.csdnimg.cn/a5c3137fb3d140dd8c2ac0ab0c1736fc.png)
### 2. 数据速率与信号速率
**数据速率** `data rate` 定义了**一秒钟发送的数据元素（位）的数量**，单位是*每秒位* `bits per second, bps, b/s` ，有时也称**比特率** `bit rate` ；**信号速率** `signal rate` 定义了**一秒钟发送的信号元素的数量**，单位是*波特* `baud` ，有时也叫**脉冲速率** `pulse rate` 、**调制速率** `modulation rate` 或**波特率** `baud rate` 。

==数据通信中的一个目标，就是增加数据速率而降低信号速率==。增加前者会增加传输速度，降低后者会降低带宽需求。在人车的类比中，我们需要更少的车辆运送更多的人，以防止交通阻塞。在我们的运输系统中有一个限定**带宽**。

现在需要考虑数据速率和信号速率两者（比特率和波特率）的关系。当然，**这个关系取决于 $r$ 值，还取决于数据模式**——如果数据模式是全 $1$ 或全 $0$ ，与数据模式是交替 $0$ 和 $1$ 信号速率，是不同的。为了得到它们的关系公式，需要定义三种情形：最坏、最好和一般——**最坏情形是，当我们需要最大信号速率时；最好情形是，当我们需要最小信号速率时**。在数据通信中，我们通常对一般情形感兴趣，于是数据速率和信号速率的关系公式化如下：
$$S = c \times N \times \dfrac{1}{r}\ \textrm{baud}$$ 这里的 $N$ 是数据速率 `bps` ，$c$ 是会根据每种情形改变的**情形因子** `case factor` ，$S$ 是信号元素数量，$r$ 是前面定义的比率。

【例4.1】一个信号携带数据，一个数据元素编码成一个信号元素（$r = 1$）。如果比特率是 $100kbps$ ，$c$ 在 $0$ 和 $1$ 之间，那么波特率的平均值是多少？
解：假定 $c$ 的平均值是 $\dfrac{1}{2}$ ，那么波特率是：
$$S = c \times N \times \dfrac{1}{r} = \dfrac{1}{2} \times 100 000 \times \dfrac{1}{1} = 50000 = 50k\ \textrm{baud}$$

### 3. 带宽
在第3章中，已经讲过**携带信息的数字信号是非周期性的**，还说明了**非周期性信号的带宽是无限连续的**。但是我们在实际中碰到的大多数数字信号的带宽是有限的。换言之，**虽然数字信号的真实带宽理论上是无限的**，但是许多成分的振幅很小、可以忽略不计，**有效的带宽是有限的**。==从现在开始，说到数字信号的带宽时，要记住讲的是这个有效带宽==。

可以说，==是波特率而不是比特率决定了数字信号的带宽==。如果使用运输类比，是车辆数量影响了交通，而不是运输的人数。信号中更多的变化，意味着在信号中插入了更多的频率。==带宽影响了我们所需的频率范围==。波特率（信号速率）和带宽之间是有关系的。

带宽是一个复杂的概念，说到带宽，通常定义为频率范围，需要知道这个范围位于哪里、最低频率和最高频率的值。另外，每个成分的振幅（如果不是振幅就是相位）是个重要问题。换言之，我们需要有关带宽的更多信息，而不仅仅是它的值，需要带宽的图表！本章中会说明讨论的大多数方案的带宽。这里说**带宽（频率范围）与信号速率（波特率）成正比**，**最小带宽**可以如下给出：
$$B_{\min} = c \times N \times \dfrac{1}{r}$$

如果给出**通道带宽**，可以得出**最大数据速率**如下：
$$N_{\max} = \dfrac{1}{c} \times B \times r$$

【例4.2】通道的最大数据速率是 $N_{\max} = 2 × B × \log_2 L$（由奈奎斯特公式定义），这与本节定义的 $N_{\max}$ 公式一致吗？
解：有 $L$ 个电平信号，每个电平可以携带 $\log_2L$ 个比特。如果每个电平与一个信号元素对应，即 $r = \log_2 L$ 。假定一般情形 $(c = 1/2)$ ，则 $$N_{\max} = \dfrac{1}{c} \times B \times r = 2 \times B \times \log_2 L$$![在这里插入图片描述](https://img-blog.csdnimg.cn/aee786ee123942ea89d770ce54669bee.png)
### 4. 基线偏移
在解码数字信号时，接收方计算**收到信号功率的运行平均值**，这一平均值称为**基线** `baseline` 。输入信号的功率会与基线比较，来确定数据元素的值。一个 $0$ 或 $1$ 的长字符串会引起**基线偏移** `baseline wandering` ，使接收方不能正确地进行解码。一个好的线路编码方案，需要防止线路偏移。

### 5. 直流成分
当数字信号中的电平保持一段时间的恒定时，频谱会产生很低的频率（傅里叶分析的结果），**这些接近于零的频率称为直流分量** `DC component` ，会给不允许通过低频率的系统或使用电子耦合的系统（如变压器）带来问题。例如，电话线不能通过低于 $200Hz$ 的频率；长距离的链路可能使用一个或多个变压器，以隔离线路的不同部分，对于这些系统，我们使用**无直流成分的方案**。

### 6. 自同步
==为了正确地解释从发送方接收到的信号，接收方的位间隔必须与发送方的位间隔严格对应==。如果接收方的时钟快了或慢了，位间隔就不会匹配，接收方可能会错误地解释信号。图4.3说明了接收方位间隔较短的一种情况，发送方发送 $1011 0001$ ，而接收方收到的是 $1101 1100 0011$ 。
![在这里插入图片描述](https://img-blog.csdnimg.cn/b1c587045775474e8ce6618a432a449b.png)所谓的**自同步** `self-synchronizing` 就是指，**数字信号在传输的数据中包含有定时信息**，通常是信号中包含有「提示接收方起始、中间和结束位置的脉冲的跳变」 `transition` ，就可以完成自同步。如果接收方的时钟不同步，这些提示跳变就会将接收方的时钟复位。

【例4.3】在数字传输中，接收方时钟比发送方时钟快 $0.1\%$ ，如果数据速率是 $1 kbps$ ，则接收方每秒钟可以接收到多少额外的位？如果数据速率是 $1 Mbps$ 呢？
 解：在 $1 kbps$ 时，接收方接收的速率是 $1001 bps$ 而不是 $1000 bps$ 。
![在这里插入图片描述](https://img-blog.csdnimg.cn/257a56a907cf4ba9ad51f880e9bbe8ed.png)
在 $1Mbps$ 时，接收方接收的速率是 $1,001,000bps$ 而不是 $1,000,000 bps$ 。
![在这里插入图片描述](https://img-blog.csdnimg.cn/2b14f8b39c624ec88e00b33f85b5a63e.png)
### 7. 内置差错检测
在产生的代码中，拥有内置差错检测能力来检测传输过程中发生的一些差错，是十分需要的。将讨论的一些编码方案中有一定程度的这种能力。

### 8. 抗噪声和抗干扰的能力
另一个需要的编码特性是，编码应具有抗噪声和抗干扰能力。将讨论的一些编码方案有这种能力。

### 9. 复杂性
复杂的方案比简单的方案实现起来成本更高。例如，使用 $4$ 个信号电平的方案，比只使用 $2$ 个电平的方案更难。

---
## 4.1.2 线路编码方案
线路编码机制大致可分为五大类，如图4.4所示：
![在这里插入图片描述](https://img-blog.csdnimg.cn/eab91b2a730143a39852259028697ad8.png)
每一大类中又有很多方案。需要熟悉本节讨论的所有方案，以便于理解后面的内容。这一节作为后面所碰到方案的参考。
### 1. 单极编码方案 `Unipolar`
==在单极编码方案中，所有的信号电平都在时间轴的一边，或在上面或在下面==。
#### 不归零编码 `NRZ`（不用）
一般的，单极编码方案设计成**不归零** `non-return-to-zero, NRZ` 方案，**在此方案中正电平定义成位 $1$ 、零电平定义为位 $0$** 。之所以称为 `NRZ` ，是因为**在位中间信号不会回到零** ` the signal does not return to zero at the middle of the bit` 。图4.5说明了单极NRZ方案：
![在这里插入图片描述](https://img-blog.csdnimg.cn/0729cab0b3d1475a8d0136e6b1c3d6cc.png)
与下节中它的极性对应方案对比，这一方案成本很高，其标准功率 `power needed to send 1 bit per unit line resistance` 是极性NRZ方案的两倍。基于这个原因，这一方案不用于数据通信中。
### 2. 极性编码方案 `Polar`
==在极性编码方案中，电平在时间轴的两边== `the voltages are on the both sides of the time axis` 。例如，$0$ 的电平可能是正的，而 $1$ 的电平可能是负的。
#### (1) 不归零编码 `NRZ`
在**极性NRZ** `polar NRZ` 编码中，信号的振幅使用两个电平 `we use two levels of voltage amplitude` 。极性NRZ有两种常见的形式：**NRZ电平编码** `NRZ-Level, NRZ-L` 和**NRZ反相编码** `NRZ-Invert, NRZ-I` ，如图4.6所示。

图中也说明了 $r$ 值、平均波特率和带宽。**第一种形式 `NRZ-L` 中，信号电平决定了位的值** `the level of the voltage determines the value of the bit` 。而**第二种形式 `NRZ-I` 中，信号电平是否反相或跳变，决定了位的值** `the change or lack of change in the level of the voltage determines the value of the bit` ——如果（位开始？）没有跳变，位是 $0$ ；如果有跳变，位是 $1$ 。当然，一般来说，我们是根据位值生成数字信号（电平序列）。
![在这里插入图片描述](https://img-blog.csdnimg.cn/dbc752b18ade44dfb3c8db3fef77d0cf.png)
基于前面规定的标准，比较这两个方案：
- **基线偏移对这两个方案都是问题，但 `NRZ-L` 比 `NRZ-I` 更严重**。如果在 `NRZ-L` 中有一个全 `0` 或全 `1` 的长序列（对应的电平一直是 $1$ 或 $-1$），平均信号功率就会变斜，接收方辨认位值就比较困难。**而在 `NRZ-I` 中，这个问题只发生在全 `0` 的序列中**（此时电平一直没有跳变或反相；如果是全 $1$ 序列，则反复跳变）。**如果我们能消除全 `0` 的长序列，就可以避免基线偏移**，很快我们就会看到如何做到这一点（与 `4B/5B` 或 `8B/10B` 块编码配合）。
- **同步问题**（发送方和接收方的时钟不同步）**也都存在于这两个方案中**。同样，**这个问题在 `NRZ-L` 中比 `NRZ-I` 中更严重**。在这两个方案中，全 `0` 的长序列都会引发问题（`NRZ-L` 中电平一直是 $1$ ；`NRZ-I` 中电平一直没有跳变），而全 `1` 的长序列只在 `NRZ-L` 中引起问题（`NRZ-L` 中电平一直是 $-1$ ；`NRZ-I` 中电平一直跳变以供同步）。
- 当系统中的极性意外改变时，`NRZ-L` 会发生另一个问题。例如，如果介质是双绞线，该双绞线极性的意外改变，会导致将所有 `0` 解释为所有的 `1`（或者反过来）。`NRZ-I` 不会有这个问题。

`NRZ-L` 和 `NRZ-I` 都有  $\dfrac{N}{2} \textrm{Baud}$ 的平均信号速率。接着讨论带宽。图4.6中还表示了两个方案的标准带宽。垂直轴表示功率密度 `power density`（每 $1\textrm{Hz}$ 带宽的功率），水平轴表示频率。对这种类型编码，带宽隐藏了一个很严重的问题——**在频率接近于零时，功率密度值会很高**。这意味着：有携带了高电平能量的DC成分，即 **`NRZ-L` 和 `NRZ-I` 都有DC问题**。实际上，大多数能量集中于 $0$ 到 $\displaystyle \dfrac{N}{2}$ 之间的频率，这意味着虽然平均信号速率是 $\dfrac{N}{2}$ ，但是能量并不是均匀分布在这两半部分中 `although the average of the signal rate is N/2,
the energy is not distributed evenly between the two halves` 。

【例4.4】系统使用 `NRZ-I` 传输 $10\textrm{Mbps}$ 的数据。试问平均信号速率和最小带宽是多少？
解：平均信号速率是 $S = N / 2 = 5 \textrm{Mbaud}$ ，这个平均波特率的最小带宽是 $B_{\min} = S = 5\textrm{MHz}$ 。


#### (2) 归零编码 `RZ`（不用）
==当发送方与接收方时钟不同步时，`NRZ` 编码的主要问题就发生了==——**接收方不知道一个位何时结束，下一个位何时开始**。一种解决方法是**归零编码** `return-to-zero, RZ` 方案，它的信号使用三个值：正值、负值和零。==在 `RZ` 中，信号不在两个位之间变化，而在位中变化==——在图4.7中，我们看到在每个位中间信号变成 $0$ 。它保持到下一个位开始。

`RZ` 编码的主要缺点是：**它需要两个信号变化来编码一个位，因此占用更大的带宽**。我们前面提到的问题——==极性意外改变会导致所有的 $0$ 被解释成所有的 $1$ ，而所有的 $1$ 被解释成所有的 $0$ 的问题同样存在，但是没有DC成分问题==。另一个问题是复杂性：**`RZ` 使用三个电平，这样生成和辨别更加困难**。这些缺陷使得**今天不再使用这个方案**，它被性能更好的曼彻斯特编码和差分曼彻斯特编码方案替代。
![在这里插入图片描述](https://img-blog.csdnimg.cn/8069ccf53dee4bc3a99655044d197041.png)
#### (3) 双相编码 `Biphase`
`RZ` 的思想（位中间跳变）和 `NRZ-L` 的思想（位 $0$ 是电平 $1$ ，位 $1$ 是电平 $-1$）共同组成了**曼彻斯特 `Manchester` 编码**方案。在曼彻斯特编码中：
- 位的持续时间被二等分。在前半部分电平保持一个水平，后半部分变成另一个水平—— ==$0$ 是由高到低，$1$ 是由低到高，即**位值在位中间**==；
- 位中间的跳变提供了同步。

另一方面，**差分曼彻斯特 `Differential Manchester`** 组合了 `RZ` 和 `NRZ-I` 的思想（位 $0$ 是（位开始？）没有跳变，位 $1$ 是有跳变）：
- 在位中间总是有一个跳变，用于提供同步；
- **位值在位开始时确定**；
- ==如果下一位是 $0$ ，就（在位开始）有一个跳变；如果下一位是 $1$ ，则没有跳变==。

图4.8显示了这两种编码，==曼彻斯特编码和差分曼彻斯特编码的最小带宽是 `NRZ` 的两倍==：
![在这里插入图片描述](https://img-blog.csdnimg.cn/01b4a5739c8d4a5ead39d050b205e428.png)
曼彻斯特编码方案克服了 `NRZ-L` 编码的一些问题，差分曼彻斯特编码方案克服了 `NRZ-I` 编码的一些问题 `The Manchester scheme overcomes several problems associated with NRZ-L, and differential Manchester overcomes several problems associated with NRZ-I` 。
- 首先，**没有基线偏移**，因为每个位是正负电平值，所以**没有DC成分**。
- 位中间的跳变提供了自同步。
- **唯一的缺点是信号速率**，曼彻斯特编码和差分曼彻斯特编码的信号速率是 `NRZ` 的两倍，原因是每个位中间都有一个跳变，而在每个位结束*可能*有一个跳变。注意，曼彻斯特编码和差分曼彻斯特编码方案也称为**双相** `biphase` 方案。

### 3. 双极性 `Bipolar` /多电平二进制 `Multilevel binary` 编码方案
在**双极编码** `bipolar`（也称为**多电平二进制** `multilevel binary`）中，有三个电平：正值、负值、零。==一个数据元素的电平是 $0$ ，而另一个数据元素的电平在正值、负值间交替== `The voltage level for one data element is at zero, while the voltage level for the other element alternates between positive and negative` 。

图4.9显示了双极编码的两种编码：**交替传号反转码** `alternate mark inversion, AMI` 和**伪三元编码** `pseudoternary` 。一个常用的双极编码方案称为**双极交替传号反转**即 `AMI` ，==其中**传号** `mark` 这个名词来自电报，它指的是 $1$== 。因此AMI表示的含义是交替的 $1$ 的翻转替换。**中值 $0$ 电平表示二进制 $0$ ，交替正负电平表示二进制 $1$** 。AMI编码的一个变体是**伪三元编码** ，==位 $1$ 编码成 $0$ 电平，而位 $0$ 编码成交替正负电平==。
![在这里插入图片描述](https://img-blog.csdnimg.cn/01b507cc72a54ea1b70ea5c02835719e.png)
双极型方案是 `NRZ` 的替代方案。**双极型方案的信号速率和 `NRZ` 一样，但是没有 `DC` 成分**。`NRZ` 方案中很大部分能量集中于频率 $0$ 附近，如果通道的这个频率附近性能较差，这类编码是不适合的。在双极编码中能量集中于频率 $\dfrac{N}{2}$ 处。图4.9说明了双极方案的典型能量集中。

有人可能会问，为什么在双极编码中没有 `DC` 成分？理论上，可以通过使用傅里叶变换来回答这个问题，但也可以直观地说明。==如果有一串 $1$ 的长序列，电平在正值和负值间交替，它不是常数，所以没有 `DC` 成分==。对于一串 $0$ 的长序列，电平保持常数，但是它的振幅是 $0$ ，同样也没有 `DC` 成分。换言之，产生恒定 $0$ 电平的序列不会有 `DC` 成分 `a sequence that creates a constant zero voltage does not have a DC component` 。

`AMI` 通常用于长距离通信，但是**当数据中存在 $0$ 的长序列时就会有同步问题**（位 $1$ 一直编码为 $0$ 电平；伪三元中位 $1$ 一直标记为 $1$ 电平）。在后面会看到，可以用扰动技术解决这个问题。

### 4. 多电平编码方案 `Multilevel Schemes`
增加数据速率或者降低所需带宽的需求 `The desire to increase the data speed or decrease the required bandwidth` ，导致了很多方案的产生。目标是通==过把 $m$ 个数据元素的模式编码成 $n$ 个信号元素的模式，增加每波特的位数==（提高比特率，降低波特率，即增加比率 $r$ ）。

我们只有两种数据元素（$0$ 和 $1$ ），这意味着 $m$ 个数据元素组可以产生 $2^m$ 个数据模式的组合。通过允许不同的信号电平，我们可以有不同类型的信号元素 `We can have different types of signal elements by allowing different signal levels` 。如果有 $L$ 个不同的电平，就能产生 $L^n$ 个信号模式组合。
- 如果 $2^m = L^n$ ，那么每个数据模式编码成一个信号模式 `We can have different types of signal elements by allowing different signal levels` 。
- 如果 $2^m<L^n$ ， 那么数据模式只能占据一个信号模式的子集 `data patterns occupy only a subset of signal patterns` 。应仔细设计这个子集来避免基线偏移、提供同步、并检测数据传输中出现的差错。
- 如果 $2^m>L^n$ ， 数据编码就不可能，因为有一些数据模式不能被编码。

编码设计者以 `mBnL` 区分这些编码类型，这里 $m$ 是**二进制模式**的长度，$B$ 表示二进制数据，$n$ 是**信号模式**的长度，$L$ 是**信号中的电平数**。一般用一个字母替换 $L$ ：$L=2$ 是用 $B$ 表示 `binary` 、$L=3$ 时用 $T$ `ternary` 、$L=4$ 时用 $Q$ `quaternary` 。注意：**前两个字母定义了数据模式，后两个字母定义了信号模式** `the first two letters define the data pattern, and the second two define the signal pattern` 。

#### (1) `2B1Q`
我们讨论的第一个 `mBnL` 方案**两个二元一个四元** `two binary, one quaternary, 2B1Q` ，它使用长度为 $2$ 的数据模式，并将这 $2$ 位数据模式编码成一个「属于 $4$ 电平信号」的信号元素 `uses data patterns of size 2 and encodes the 2-bit patterns as one signal element belonging to a four-level signal`（四个电平分别是 $-3, -1, +1, +3$）。在这个编码类型中，$m=2, n=1, L=4$ 。图4.10显示了 `2B1Q` 的一个例子。

**`2B1Q` 的平均信号速率是 $S=\dfrac{N}{4}$** 。这意味着是用 `2B1Q` 发送数据可以比 `NRZ-L` 快 $2$ 倍。但是，`2B1Q` 使用 $4$ 个不同的信号电平，意味着接收方需要辨别 $4$ 个不同的阈值。降低的带宽带来了成本的提高。因为 $2^2 = 4^1$ ，所以这个方案中没有多余的信号模式。

正如在第 $9$ 章中看到，`2B1Q` 用于 `DSL`（数字用户线路）技术，通过使用用户电话线提供高速因特网连接。
![图4.10](https://img-blog.csdnimg.cn/999961a416f546f491870fb387e1970f.png)

#### (2) `8B6T`
一个很有趣的方案是**八个二元六个三元** `eight binary, six ternary, 8B6T` 。这个编码用于 `100BASE-4T` 电缆，我们会在[【计算机网络】第三部分 数据链路层(13) 有线局域网：以太网](https://memcpy0.blog.csdn.net/article/details/123059031)看到。这个方案是**把 $8$ 位数据模式编码成 $6$ 个信号元素模式，每个信号有 $3$ 个电平（三元的）** `encode a pattern of 8 bits as a pattern of 6 signal elements, where the signal has three levels (ternary)` 。

我们可以有 $2^8 = 256$ 个不同的数据模式和 $3^6 = 478$ 个不同的信号模式。有 $478-256=222$ 个冗余的信号元素用来提供同步和差错检测。其中一部分还用来提供 `DC balance` 。每个信号模式的权值为 $0$ 或 $+1$ `DC` 值。这意味着，没有权值为 $-1$ 的模式。为了让整个流实现 `DC` 平衡，发送方必须关注权值 `weight` 。如果两个权值为 $+1$ 的组紧接着，则第一个组保持原状发送，而接着的第二个组全部取反、使得权值为 $-1$ 。

图 4.11给出了 $3$ 个数据模式编码成 $3$ 个信号模式的例子。$3$ 个可能的信号电平表示为 $-, 0, +$ 。第一个 $8$ 位模式 $00010001$ 编码成权值为 $0$ 的信号模式 $-0-0++$ ；第二个 $8$ 位数据模式 $0101 0011$ 编码成权值为 $+1$ 的信号模式 $-+-++0$ ；第三个 $8$ 位数据模式编码成权值为 $+1$ 的信号模式 $+--+0+$  ，为了建立 `DC` 平衡，发送方反相实际的信号。接收方能轻易地辨认出这是反相过的模式，因为平衡量为 $-1$ 。模式在解码前反相 `The pattern is inverted before decoding` 。
![图4.11 多电平：8B6T方案](https://img-blog.csdnimg.cn/d7b5ea57d9d14ff88814b2502fa2a86f.png)
这个方案的平均信号速率理论上是 $S_{ave} = \dfrac{1}{2} \times N \times  \dfrac{6}{8}$ ，实际上最小带宽十分接近 $\dfrac{6N}{8}$ 。

#### (3) `4D-PAM5`
在这个类别中讨论的最后一个信号方案，称为 **$4$ 维 $5$级脉冲振幅调制** `four­ dimensional five-Ievel pulse amplitude modulation, 4D-PAM5` 。`4D` 表示数据同时通过 $4$ 条线路发送。它使用 $5$ 个电平：$-2,- 1 , 0 , 1, 2$ 。但是电平 $0$ 只用于发送差错检测（在[第10章](https://memcpy0.blog.csdn.net/article/details/122995028)讨论）。如果假定编码是一维的，$4$ 个电平产生类似于 `8B4Q` 方案的编码。换言之，一个 $8$ 位码字转换成一个 $4$ 电平的信号元素。这个假想一维版本的最差信号速率是 $\dfrac{4N}{8}$ 或 $\dfrac{N}{2}$ 。

设计 `4D-PAM5` 技术用来通过 $4$ 个通道（$4$ 条线路）发送数据。这意味着信号速率可以降低到 $\dfrac{N}{8}$ ，这是一个大幅度的改进。所有 $8$ 个位可同时进入一条线路，并使用 $1$ 个信号元素发送。关键点在于 $4$ 个信号元素组成 $1$ 个信号组，并通过四维环境同时发送。图4.12给出了假想的一维和实际的四维实现。

Gigabit LAN（见[第13章](https://memcpy0.blog.csdn.net/article/details/123059031)）是用这个技术来通过 $4$ 条铜线电缆（能处理 $125\textrm{Mbaud}$ ）发送 $1\textrm{Gbps}$ 数据。这个方案的信号模式有很大的冗余，因为 $2^8$ 个数据模式匹配 $4^4= 256$ 个信号模式，额外的信号模式可以用于诸如差错检测等其他目的 `This scheme has a lot of redundancy in the signal pattern because 2^8 data patterns are matched to 4^4 = 256 signal patterns. The extra signal patterns can be used for other purposes such as error detection.` 。
![图4.12 多电平：4D-PAM5方案](https://img-blog.csdnimg.cn/c0945f8860af4817a145a35b22dc3738.png)

### 5. 多线路传输: `MLT-3`
`NRZ-I` 和差分曼彻斯特编码是差分编码，但使用两个跳变规则 `two transition rules` 来编码二进制数据（没有反相、有反相）。**如果信号的电平多于两个，可以设计一种多于两个跳变规则** `two transition rules` **的差分编码方案**。`MLT-3` 就是其中之一。**三电平多线路传输** `multiline transmission, three level, MLT-3` 方案使用三个电平 $(+V, 0, -V)$ 和三个跳变规则 `three transition rules` 在电平间变动。
1. 如果下一个位是 $0$ ，没有跳变。
2. 如果下一个位是 $1$ 而且当前电平不是 $0$ ，下一个电平是 $0$ 。
3. 如果下一个位是 $1$ 而且当前电平是 $0$ ，下一个电平是最后一个非零电平的相反值。

图4.13所示的状态图很好地描述了 `MLT-3` 。三个状态（用椭圆）表示三个电平 $(+V, 0, -V)$ 。连接线表示一个状态（电平）到另一个状态（电平）的跳变。图4.13还给出了 `MLT-3` 信号的两个例子。

有人可能想知道，为什么需要使用 `MLT-3` 这种将一个位映射成一个信号元素的方案。（它的）信号速率和 `NRZ-I` 一样，但是更复杂（三个电平和复杂的跳变规则）。**事实证明，该方案中的信号形状有助于减少所需的带宽** ` It turns out that the shape of the signal in this scheme helps to reduce the required bandwidth` 。

让我们看一看最坏的情形，全 $1$ 的序列。每 $4$ 个位就重复信号元素模式 $+V\ 0\ -V\ 0$ 。非周期信号已经变成周期信号，周期等于 $4$ 倍位持续时间。这个最坏情形可以模拟成频率为 $\dfrac{1}{4}$ 比特率的模拟信号。
![图4.13 多传输: MLT-3方案](https://img-blog.csdnimg.cn/343a4a84a754412c8536ca848c8fff20.png)
当我们需要在铜线电缆（不能支持高于 $32\textrm{MHz}$ ，高于这个电平的频率会产生电磁辐射 `electromagnetic emissions` ）上发送 $100\textrm{Mbps}$ 时，`MLT-3` 是个合适的选择。`MLT-3` 和LAN会在[第13章](https://memcpy0.blog.csdn.net/article/details/123059031)中讨论。

### 6. 线路编码方案小结
注意，图片中有错误：AMI没有DC！
![在这里插入图片描述](https://img-blog.csdnimg.cn/21e40275f0524d7687f1cd68a214e8bd.png)
## 4.1.3 块编码（适用于NRZ线路编码）
我们需要某种冗余以确保同步，并提供一些内在的差错检测 `We need redundancy to ensure synchronization and to provide some kind of inherent error detecting` 。**块编码可以给出这种冗余，并提高线路编码的性能**。一般来说，块编码 `block coding` 把 $m$ 位的比特块变成 $n$ 位的比特块 `a block of n bits` ，这里 $n$ 大于 $m$ 。块编码称为  $mBnB$ 编码技术。==块编码中的斜线（比如 $4B/5B$ ）用来区别于多电平编码（比如 $8B6T$），多电平编码中没有斜线==。

块编码一般涉及三个步骤：**分组、置换和组合** `division, substitution, and combination` 。在分组步骤中，位序列划分成许多个 $m$ 位组。例如，在 $4B/5B$ 编码中，原始的位序列划分成 $4$ 位组。**块编码的核心是置换步骤**。在这个步骤，用 $n$ 位组置换 $m$ 位组。例如在 $4B/5B$ 编码中，用 $5$ 位组置换 $4$ 位组。最后，这些 $5$ 位组组合形成流，新的流比原始的流有更多的位。图4.14说明了这个过程。
![图4.14 块编码概念](https://img-blog.csdnimg.cn/d40be2e577764cd3ba9b95766b41ff4c.png)

### 1. `4B/5B` 
**$4$ 个二元/ $5$ 个二元** `four binary/five binary, 4B/5B` 编码方案设计出来和 `NRZ-I` 组合使用。

回忆一下，`NRZ-I` 有很好的信号速率（决定带宽），它是双相编码的一半，但是它有同步问题和 `DC` ，连续的 $0$ 的长序列会让接收方失去同步 `A long sequence of 0s can make the receiver clock lose synchronization` 。一种解决方法是：**在使用 `NRZ-I` 编码前改变位流，使其没有长的 $0$ 流** `change the bit stream, prior to encoding with NRZ-I, so that it does not have a long stream of 0s` ，而 `4B/5B` 方案实现了这个目的。我们后面会看到，**经过块编码的流不会有多于三个连续的 $0$** 。

在接收方，**`NRZ-I` 编码后的数字信号**先解码成位流，然后去掉冗余。图4.15说明了这个思想。![图4.15 使用块编码4B/5B和线路编码NRZ-I的组合方案](https://img-blog.csdnimg.cn/f37275f8c2024e1a9356799ff5111631.png)
在 `4B/5B` 编码中，==「替代 $4$ 位输入的 $5$ 位输出」仅包含不超过一个前导 $0$（左边的位）和不超过两个后缀 $0$（右边的位）。因此，当不同的组 `different groups` 组合形成新的序列时，最多只会有三个连续的 $0$==（注意：**`NRZ-I` 中 $1$ 的长序列没有问题**）。表4.2给出了用于 `4B/5B` 编码的相应对。注意前两列是 $4$ 位组和 $5$ 位组。
![表4.2 4B/5B映射码](https://img-blog.csdnimg.cn/3d0e7472a4c0477e823cb57c79f1e8b6.png)
$4$ 位组只有 $16$ 个不同的组合，而 $5$ 位组有 $32$ 个不同的组合。这意味着有 $16$ 个组没有用于 `4B/5B` 编码。==这些不用的组当中，一些用于控制，另一些仍然没有使用，可以提供一些差错检测：如果收到的 $5$ 位组属于表中没有使用的部分，接收方知道传输中出现了差错==。 

图4.16给出了用 `4B/5B` 编码方案置换的一个例子。`4B/5B` 编码方案解决了同步问题，克服了 `NRZ-I` 的缺陷。但是，我们需要记住：**它增加了 `NRZ-I` 的信号速率，（那些）冗余位增加了 $20\%$ 的波特**。尽管如此，结果仍然小于「信号速率是 `NRZ-I` 的两倍」的两相方案。但是，**`4B/5B` 编码方案没有解决 `NRZ-I` 的 `DC` 成分问题。如果 `DC` 成分是不可接受的，就需要使用双相或双极编码方案**。

【例4.5】我们需要以 $1\textrm{Mbps}$ 速率发送数据。使用 `4B/5B` 和 `NRZ-I` 组合、或曼彻斯特编码 `using a combination of 4B/5B and NRZ-I or Manchester coding` ，最小的带宽是多少？
解：首先 `4B/5B` 块编码增加比特率到 $1. 25\textrm{Mbps}$ 。使用 `NRZ-I` 的最小带宽是 $N/2$ 或 $625\textrm{kHz}$ 。曼彻斯特方案需要最小带宽  $1\textrm{MHz}$ 。第一个选择需要更低的带宽，但有 `DC` 成分问题。第二个选择需要更高的带宽，但没有 `DC` 成分问题。
![图4.16 使用4B/5B编码方案进行置换](https://img-blog.csdnimg.cn/1227ac3a64c24dd78db9adf1422b73bf.png)
### 2. `8B/10B`
**$8$ 个二元/ $10$ 个二元** `eight binary/ten binary, 8B/10B` 编码方案类似于 `4B/5B` 编码方案，除了它是 $8$ 位数据组被置换成 $10$ 位编码。**比起 `4B/5B` ，它提供了更强的差错检测能力**。

**`8B/10B` 块编码实际上是 `5B/6B` 编码和 `3B/4B` 编码的组合**，如图4.17所示。$8$ 位块的高 $5$ 位送入 `5B/6B` 编码器，低 $3$ 位送入 `3B/4B` 编码器。这样做是为了简化映射表。为了防止连续 $0$ 或 $1$ 的长串，编码使用不均等性控制器 `disparity controller` 观察 $0$ 比 $1$ 多（或 $1$ 比 $0$ 多）的情况：如果当前块中的位产生了不均等性，而该不均等性对上一块的不均性有影响（任一方向），那么当前块的所有位取反（$0$ 变成 $1$ 而 $1$ 变成 $0$ ）`If the bits in the current block create a disparity that contributes to the previous disparity (either direction), then each bit in the code is complemented (a 0 is changed to a 1 and a 1 is changed to a 0)` 。
![图 4.1788/108 编码](https://img-blog.csdnimg.cn/eba99fce7bc44426bdbd2bf7175d6349.png)
这种编码有 $2^{10} - 2^8 = 768$ 个冗余组，可以用于不均等性校验和差错检测。一般来说，由于有更好的内置差错检查能力和同步能力，这种技术优于 `4B/5B` 。

## 4.1.4 扰动（适用于双极型方案）
**双相编码方案适用于LAN中站点间的专用链路** `dedicated links between stations in a LAN` ，并不适用于长距离通信（**由于宽带宽需求**）。==块编码（如 `4B/5B` 和 `8B/10B` ）和 `NRZ` 线路编码的组合，由于（没有消除）`DC` 成分，也不适用于长距离编码==。

**双极 `AMI` 编码有窄带宽 $\dfrac{N}{2}$ 、而且不会产生 `DC` 成分，但对于连续 $0$ 的长序列会不同步**（因为位 $0$ 始终编码为 $0$ 电平）。如果能找到避免初始流中连续 $0$ 的长序列的方法，那么双极 `AMI` 可以用于长距离通信。我们正寻找一种不会增长位数、并提供同步的技术 `does not increase the number of bits and does provide synchronization` ，以及一种「把长的 $0$ 电平脉冲置换成其他电平组合」来提供同步的解决方法。

一种解决方法称为**扰动** `scrambling` 。我们修改了部分 `AMI` 规则，引入了扰动，如图4.18所示。注意：**相对于块编码，扰动与编码同时完成**。系统需要根据定义的扰动规则，插入所需的脉冲。两种通用的扰动技术是 `B8ZS` 和 `HDB3` 。
![图4.18 使用扰动的AMI](https://img-blog.csdnimg.cn/e0cfdeb0a194490d84644cec7a595624.png)
### 1. `B8ZS` 
**8零置换的双极编码方案** `bipolar with 8-zero substitution, B8ZS` 通常用于北美地区。在这个技术中，$8$ 个连续 $0$ 电平会被替换成 $000VB0VB$ 。这里的 $V$ 表示违反 `violation` ，这是一个违反了「AMI编码规则（与前一个极性相反）`breaks an AMI rule of encoding (opposite polarity from the previous)` 」的**非零电平**；这里的 $B$ 表示双极 `bipolm` ，表示一个与AMI规则相一致的**非零电平**。有两种情形，如图4.19所示。
![图4.19 B8ZS扰动技术的两种情形](https://img-blog.csdnimg.cn/852f6b29fafa4e609f1960cf51764d12.png)
注意：这里的扰动不会改变比特率。而且这个技术平衡了正电平和负电平（两个正电平和两个负电平），这意味着**维持了 `DC` 平衡**。注意：替换可能会改变 1 的极性，因为置换后AMI需要遵守它的规则。

还要提到一点。这里的字母 `V`（违反）或 `B`（双极）是相对的，**`V` 表示与前一个非零脉冲极性相同的极性** `The V means the same polarity as the polarity of the previous nonzero pulse` ，**`B` 表示与前一个非零脉冲极性相反的极性** `B means the polarity opposite to the polarity of the previous nonzero pulse` 。
### 2. `HDB3`
**高密度双极 $3$ 零方案** `high-density bipolar 3-zero, HDB3` 通常用于北美以外地区。这种技术比 `B8ZS` 技术更加保守，它根据最后一次置换后非零脉冲数，把四个连续零电平置换成 $000V$ 或 $B00V$ 。两个不同置换的原因是，**为了维持每次置换后非零脉冲为偶数** `The reason for two different substitutions is to maintain the even number of nonzero pulses after each substitution` 。这两个规则可以定义如下:
1. 如果最后一次置换后的非零脉冲数是奇数，置换模式是 $000V$ ，这样使得非零脉冲总数为偶数。
2. 如果最后一次置换后的非零脉冲数是偶数，置换模式是 $B00V$ ，这样使得非零脉冲总数为偶数。

图4.20给出了一个实例。这里还需要提到几点。第一，在第一次置换前，非零脉冲数是偶数，所以第一次置换是 $B00V$ 。这次置换后，位 $1$ 的极性改变，因为**每次置换后AMI方案必须遵循自己的规则** `After this substitution, the polarity of the 1 bit is changed because the AMI scheme, after each substitution, must follow its own rule` 。在这个位后，我们需要另一次置换，这次置换是 $000V$ ，因为在最后一次置换后我们只有一个非零脉冲（奇数）。第三次置换是 $B00V$ ，因为在第二次置换（偶数）后没有非零脉冲。
![图4.20 HDB3扰动技术中的不同情况](https://img-blog.csdnimg.cn/afca12c9c0ff494fa8338484bb770597.png)


---
# 4.2 模拟到数字转换
4.1节描述的技术用于**把数字数据转换成数字信号**。然而，有时我们只有模拟信号（诸如麦克风或照相机产生的信号）。在[【计算机网络】第二部分 物理层和介质(3) 数据和信号](https://memcpy0.blog.csdn.net/article/details/122119955)，我们已经看到**数字信号优于模拟信号** `a digital signal is superior to an analog signal` 。今天的趋势是**把模拟信号转换成数字数据** `The
tendency today is to change an analog signal to digital data` 。本节将描述两种技术：脉冲码调制和 `delta` 调制。==在数字数据产生（数字化）后，我们使用 4.1 节描述的技术之一，把数字数据转换成数字信号==。

## 4.2.1 脉冲码调制 `PCM`
把模拟信号转换成数字数据（数字化）`change an analog signal to digital data (digitization)` 的最通用技术称为**脉冲码调制** `pulse code modulation, PCM` 。一个PCM编码器有三个过程，如图4.21所示。
1. 对模拟信号进行采样；
2. 对采样后信号进行量化；
3. 量化后的值编码成位流。
![图4.21 PCM编码器组成](https://img-blog.csdnimg.cn/a59fcbe010624ee281125ad36e856a36.png)

### 1. 采样
PCM的第一步是**采样** `sampling` 。每隔 $T_s$ 秒对模拟信号进行采样，这里 $T_s$ 是**样本间隔或周期** `sample interval or period` 。采样间隔的倒数称为**采样率** `sampling rate` 或**采样频率** `sampling frequency` ，定义成 $f_s$ ，这里 $f_s= \dfrac{1}{T_s}$。有三种采样方法：**理想采样、自然采样和方顶采样** `ideal, natural, and flat-top` ，如图4.22所示。
- 在理想采样中，对来自模拟信号的脉冲进行采样。这是一种理想的采样方法，不容易实现。
- 在自然采样中，高速开关仅在采样发生时打开一小段时间， 当采样发生时高速开关开启很短的时间。结果是样本序列保留了模拟信号的形状。
- 最常用的采样方法称为**采样和保持技术** `sample and hold` ，它通过使用电路产生方顶样本 `creates flat-top samples by using a circuit` 。
![图4.22 PCM的三种不同采样方法](https://img-blog.csdnimg.cn/5c453114e3dc4787a0bd6ebd75153b80.png)

采样过程有时称为**脉冲振幅调制** `pulse amplitude modulation, PAM` 。但是我们需要记住，结果仍然是**非完整的模拟信号**。
#### 采样速率
一个重要考虑是采样速率或采样频率。对 $T_s$ 的限制是什么？这个问题由奈奎斯特给出了完善的解决。根据奈奎斯特定理 `Nyquist theorem` ，**为了再生原始模拟信号，一个必要条件是：采样速率 `sampling rate` 至少是原始信号中最高频率的两倍**。
 
我们需要在这里详细描述这个理论。首先，**只有当信号带宽是有限的时候，我们才能对它进行采样** `we can sample a signal only if the signal is band-limited` 。换言之，我们无法对无限带宽的信号进行采样。其次，采样率必须至少是最高频率、而不是带宽的两倍 `the sampling rate must be at least 2 times the highest frequency, not the bandwidth` ——==如果模拟信号是低通的 `low-pass` ，带宽和最高频率有相同的值。如果模拟信号是带通的 `bandpass` ，带宽值小于最大频率值==。图4.23说明了两种类型信号的采样率值。
![图4.23 低通和带通信号的奈奎斯特采样速率](https://img-blog.csdnimg.cn/3565e6c4f4094388b2c6a2b777d60c89.png)
【例4.6】对于奈奎斯特定理的一个直观实例，让我们以三种采样率对简单正弦波进行采样：$f_s=4f$（$2$ 倍奈奎斯特速率），$f_s = 2f$（奈奎斯特速率）和 $f_s =f$（一半奈奎斯特速率）。图4.24给出了采样和后续的信号恢复。
![图4.24 不同采样率下采样正弦波的恢复](https://img-blog.csdnimg.cn/a3e3579c606842b5944c66ccb228b2cc.png)
可以看到，以奈奎斯特速率进行采样，可以得到与原始正弦波较好近似的信号（图4.24a部分），图4.24b部分==过采样得到相同的近似，但它是冗余的、不必要的==。低于奈奎斯特率的采样（图4.24c部分）不能产生与原始正弦波相似的信号。

【例4.7】一个有趣的例子，如果我们对诸如「时钟指针旋转的周期性事件」进行采样，我们会看到什么？时钟的分针周期为 $60s$ `The second hand of a clock has a period of 60s` 。
- 根据奈奎斯特定理，我们需要每隔 $30s$（$T_s = \dfrac{1}{2}T$ 或 $f_s = 2f$）对分针进行采样（拍照并发送）。在图4.25a中，样本点依次为 $12, 6,12,6, 12, 6$ ，样本的接收方无法知道时钟是向前走还是向后走。
- 在图4.24b部分，我们以两倍奈奎斯特率（每隔 $15s$）进行采样。样本点依次是 $12, 3, 6, 9, 12$ 。时钟在向前走。
- 在图4.24c部分，我们以低于奎斯特率的采样率进行采样。样本点依次是 $12, 9, 6, 3, 12$ 。虽然时钟在向前走，但接收方认为时钟在向后走。
![图4.25 对时钟分针进行采样](https://img-blog.csdnimg.cn/87c2c11d0a0f410a88e08650166e9264.png)

【例4.8】与【例4.7】相似的一个例子是，电影中向前移动的汽车看起来车轮在向后旋转。这可以用欠采样解释。电影以每秒 $24$ 帧的速度拍摄。如果车轮以高于每秒 $12$ 次的速度旋转，欠采样就会产生向后旋转的印象。

【例4.9】电话公司假定语音最高频率为 $4000\textrm{Hz}$ 对语音进行采样。因此采样率是每秒 $8000$ 个样本。

【例4.10】一个复杂的低通信号带宽为 $200\textrm{kHz}$ 。那么这个信号的最小采样速率是多少？
解：==低通信号的带宽在 $0$ 和 $f$ 之间，这里的 $f$ 是信号的最大频率==。因此，我们以两倍这个最高频率 $200 \textrm{kHz}$ 对这个信号进行采样。采样速率是每秒 $400000$ 个样本。

【例4.11】一个复杂的带通信号带宽为 $200\textrm{kHz}$ 。那么这个信号的最小采样率是多少？
解：因为我们不知道带宽从何开始和到何结束，所以我们无法找到这个例子中的最小采样率。我们不知道这个信号中的最大频率。

### 2. 量化
采样后的结果是一系列「振幅值介于信号最大振幅和最小振幅间的脉冲」`a series of pulses with amplitude values between the maximum and minimum amplitudes of the signal` 。振幅集可能是无限个介于两个限制值间的非整数值 `The set of amplitudes can be infinite with nonintegral values between the two limits` 。这些值无法用于编码过程。以下是量化步骤：
1. 我们假定原始模拟信号有介于 $V_{\min}$ 和 $V_{\max}$ 的瞬时振幅。
2. 我们把范围分成 $L$ 个区间，每个区间高度为 $\Delta$ ：$$\Delta = \dfrac{V_{\max} - V_{\min} } {L}$$
3. 我们分配 **$0$ 到 $L- 1$ 的量化值**给每个区间的中点 `the midpoint of each zone` 。
4. 样本振幅值近似为量化值。

一个简单的例子，假定我们有一个被采样的信号 `sampled signal` ，并且样本振幅在 $-20V$ 到  $20V$ 范围内。我们决定有 $8$ 个电平（$L=8$）。这意味着 $\Delta = 5V$ 。图4.26说明了这个例子。
![图4.26 采样信号的量化和编码](https://img-blog.csdnimg.cn/1f9ecae8b0a043c19b47710aad306124.png)
这里使用理想采样（为了简单），只给出了 $9$ 个样本。图中每个样本顶端的值给出了实际振幅。在表中，第一行是每个样本标准化后的值（实际振幅 $/\Delta$ ，以 $\Delta$ 为单位）。而量化过程从每个区间的中间选择量化值 `quantization value` ，这意味着**标准化量化值** `normalized quantized values`（第二行）不同于**标准化振幅** `normalized amplitudes` 。两者之差称为**标准化误差** `normalized error`（第三行）。第四行是基于图左侧**量化电平** `quantization levels` 的每个样本的**量化码** `quantization code` 。编码码字（第五行）是转换的最后结果。

#### (1) 量化等级
在前面例子中，我们给出了八个量化等级。==$L$（等级数）的选择取决于「模拟信号振幅范围」、以及「我们需要准确恢复信号的程度」==：如果一个信号的振幅只在两个值之间变动，我们只需要两个电平；如果信号（像语音）有许多振幅值，我们需要更多的量化等级。

在音频数字化中，$L$ 通常为 $256$ ，在视频中，$L$ 一般是几千。==如果信号的幅度变化很大，则选择较低的 $L$ 值（量化等级数）会增加量化误差== `Choosing lower values of L increases the quantization error if there is a lot of fluctuation in the signal` 。

#### (2) 量化误差
一个重要的问题是量化过程产生的误差（后面会看到这个问题如何影响高速调制解调器）。**量化是一个近似过程**：量化器的输入值是实际值，输出值是近似值。==输出值被选为区域中的中间值，如果输入值也在区间中间，就没有量化误差，否则就会有误差==。在前面的例子中，第三个例子的标准化振幅是 $3.24$ ，但标准化量化值是 $3.50$ 。这表示误差是 $+0. 26$ 。任一样本的误差值都小于 $\dfrac{\Delta} {2}$ ，换言之，$- \dfrac{\Delta}{2} \le \textrm{error} \le \dfrac{\Delta}{2}$ 。

**量化误差**改变了信号的信噪比 `signal-to-noise ratio` ，根据香农理论，这反过来**减小了上限容量**。可以证明：==量化误差对信号 $SNR_{dB}$ 的影响取决于量化级别 $L$ 或每个样本的位数 `the bits per sample` $n_b$== ，如下面公式所示：$$SNR_{dB} = 6.02n_b + 1.76 {dB}$$

【例4.12】图4.26例子中的 $SNR_{dB}$ 是多少？
解：我们可以使用公式来得出这个量化值。有 $8$ 个级别，每个样本有 $3$ 个位，所以 $SNR_{dB} = 6.02 \times 3 + 1.76 = 19.82 dB$ 。增加级别数就会增加 $SNR$ 。

【例4.13】电话用户线路必须有高于 $40$ 的 $SNR_{dB}$ 。那么每个样本的最小位数是多少？
解：我们可以计算位数如下：$$SNR_{dB} = 6.02\times n_b + 1.76 = 40\quad n = 6.35$$ 电话公司一般给每个样本分配 $7$ 或 $8$ 个位。

#### (3) 均匀量化与非均匀量化
对于许多应用，模拟信号中瞬时振幅的分布是不均匀的。振幅的变化一般在较低振幅中比较高振幅中发生得更频繁 `Changes in amplitude often occur more frequently in the lower amplitudes than in the higher ones` 。对于这类应用使用**非均匀量化** `Nonuniform Quantization` 更好。换言之，==$\Delta$ 的高度不是固定的，在较低振幅附近较大、而在较高振幅时较小==。

非均匀量化还可以使用称为**压缩** `companding` 和**扩展** `expanding` 的过程实现。在发送方，信号在转换前先压缩；在接收方，在转换前先扩展。压缩表示减小较大瞬时电平振幅值 `reducing the instantaneous voltage amplitude for large values` ，扩展是相反的过程。压缩赋予强信号更大的权重，而赋予弱信号更少的权重。已经证明，非均匀量化有效地减小了量化 $SNR_{dB}$ 。

### 3. 编码
**PCM的最后一个步骤是编码**。在每个样本量化、并且每个样本的位数确定后，每个样本可以转换成一个 $n_b$ 位的码字。在图4.26中，编码后的码字显示在最后一行。$2$ 的量化码编码成 $010$ ，$5$ 编码成 $101$ 等。注意：==**每个样本的位数取决于量化等级数**。如果量化等级数是 $L$ ，位数是 $n_b=\log_2L$== 。在我们的例子中，$L$ 是 $8$ ，所以 $n_b$ 是 $3$ 。比特率可以通过如下公式获得:
$$比特率=采样速率 \times 每个样本位数=f_s \times n_b$$

【例4.14】要数字化人的语音。假定每个样本有 $8$ 个位，那么比特率是多少？
解：人的语音通常包含 $0$ 到 $4000\textrm{Hz}$ 的频率。因此采样率和比特率可以计算如下：
$$采样率=4000\times 2=8000\textrm{samples/s} \\
比特率=8 000 \times 8 = 64 000 \textrm{bps} = 64\textrm{kbps}$$
### 4. 原来信号恢复
原来信号的恢复需要PCM解码器。==解码器首先使用电路将码字转换为一个脉冲，该脉冲保持幅度直到下一个脉冲==。当阶梯信号 `staircase signal` 完成后，==它经过一个低通过滤器 `low-pass filter` 把阶梯信号平滑成模拟信号==。过滤器的截断频率 `cutoff frequency` 与发送端的原始信号相同。如果信号是以（或大于）奈奎斯特采样速率采样的，并且有足够的量化等级，那么就可以重新生成原来信号。注意：可以通过放大 `amplification` 来获得原始信号的最大值和最小值。图4.27显示了简化的过程。
![图4.27 PCM解码器的组成](https://img-blog.csdnimg.cn/a64d5791acc749b99cedadcd6b8ba061.png)
### 5. PCM带宽
假设给定**低通模拟信号**的带宽。如果要数字化这个信号，那么通过这个数字化信号的**通道的最小带宽**是多少？已经说过，线路编码的信号的最小带宽是 $B_{\min} = c \times N \times (\dfrac{1}{r})$ 。在下面公式中置换 $N$ 值:
 $$B_{\min} = c \times N \times (\dfrac{1}{r}) = c\times n_b \times f_s \times \dfrac{1}{r} = c\times n_b \times 2 \times B_{analog} \times \dfrac{1}{r}$$ 注意：由于是低通模拟信号，这里的 $B_{analog}$ 等同于其最大频率 $f$ 。 当 $\dfrac{1}{r}=1$（对于 `NRZ` 或双极信号）和 $c = \dfrac{1}{2}$（平均情况）时，最小带宽是$$B_{\min} = n_b \times B_{analog}$$  这表示，**数字信号的最小带宽是模拟信号的带宽的 $n_b$ 倍** `the minimum bandwidth of the digital signal is nb times greater than the bandwidth of the analog signal` 。**这就是我们为数字化付出的代价** `This is the price we pay for digitization` 。

【例4.15】有一个 $4\textrm{kHz}$ 的低通信号。如果我们发送这个模拟信号，我们需要最小带宽是 $4\textrm{kHz}$ 的通道。如果数字化这个信号、并且每个样本发送 $8$ 个位，需要最小带宽是 $8\times 4\textrm{kHz}=32\textrm{kHz}$ 的通道。

### 6. 通道的最大数据率
前面讨论了**奈奎斯特定理** `Nyquist theorem` ，它给出了通道的数据速率为 $N_{\max} =2 \times B \times \log_2L$ 。使用下面的参数，我们可以从**奈奎斯特采样定理** `Nyquist sampling theorem` 推导得出这个速率 `We can deduce this rate from the Nyquist sampling theorem by using the following arguments.` ：
1. 我们假定 `assume` 可用通道是**带宽为 $B$ 的低通通道**。
2. 假定要发送的**数字信号有 $L$ 个电平，每个电平是一个信号元素**。这表示 $r=\log_2L$ 。
3. 我们首先将数字信号通过一个低通过滤器，以截断 $B\textrm{Hz}$ 以上的频率。
4. 我们将得到的结果信号视为模拟信号 ，并且以每秒 $2\times B$ 个样本对它进行采样，使用 $L$ 个电平进行量化。因为信号初始有 $L$ 个电平，所以额外的量化电平是无用的。
5. 结果比特率 $N= f_s \times n_b=2 \times B \times \log_2L$ 。这是最大带宽，如果情形因子 $C$ 变大，数据速率就减小。
$$N_{\max} = 2 \times B \times \log_2L\ \textrm{bps}$$

### 7. 最小所需带宽
如果**数据速率和信号电平数都是固定的**，前面的论据就给出了**最小带宽**。如下：
$$B_{\min} = \dfrac{N}{2\times \log_2 L} \textrm{Hz}$$
 
## 4.2.2 Delta调制 `DM`
PCM是十分复杂的技术，我们已经开发出其他技术来减少PCM的复杂性。最简单的一种是 **`delta` 调制**。PCM得到每个样本的信号振幅值，DM从前一个样本中得到变化 `PCM finds the value of the signal amplitude for each sample; DM finds the change from the previous sample` 。图4.28显示了这个过程。注意：**这里没有任何码字，位一个接一个被发送**。
![图4.28 delta调制过程](https://img-blog.csdnimg.cn/9ee2c485227c479b97888aa556d68f7c.png)
### 1. 调制器
调制器用在发送方站点，用来从模拟信号中产生位流。这个处理记录了小的正/负改变，称为 `delta` $\delta$ 。如果 `delta` 是正的 ， 就记录成 $1$ 。如果是负的，就记录成 $0$ 。

但是，**需要一个基准供模拟信号比较** `the process needs a base against which the analog signal is compared` 。调制器生成一个像梯形的第二信号 `the process needs a base against which the analog signal is compared` 。然后，我们就可以将「寻找变化」简化为「将输入信号与逐渐形成的阶梯信号」进行比较 `Finding the change is then reduced to comparing the input signal with the gradually made staircase signal` 。图4.29给出了处理图。
![图4.29 delta调制组成](https://img-blog.csdnimg.cn/b8e1366e6fe343958493edbd710f483d.png)
在每个采样区间，调制器将模拟信号的值与梯形信号的最后一个值相比较。如果模拟信号的振幅大，数字数据中的下一个位就是 $1$ ，否则就是 $0$ 。但是，比较器的输出也构成了梯形信号本身 `The output of the comparator, however, also makes the staircase itself`（~~比较器的输出能自己生成梯形信号~~）。如果下一个位是 $1$ ，梯形信号生成器就会把梯形信号的最后一个点向上移 $\delta$ ；如果下一个位是 $0$ ，就向下移 $δ$ 。注意：我们需要一个延迟单元，用来在两次比较之间的一段时间内保持梯形函数。
### 2. 解调器
**解调器获取数字数据，并使用梯形生成器和延迟单元产生模拟信号**。但是，产生的模拟信号需要经过一个低通过滤器来平滑处理。图4.30给出了示意图。
 
![图4.30 delta解调器组成](https://img-blog.csdnimg.cn/3d2940d966b94813ac4db8ad5a9643a5.png)

### 3. 适配DM
如果 $\delta$ 值不固定就可以得到更好的性能。在**适配 `delta` 调制** `adaptive delta modulation` 中，$\delta$ 根据模拟信号的振幅而改变。
### 4. 量化误差 
显然，DM不是完美的。在处理中总是出现量化差错，但是DM的量化误差比PCM的小得多。

---
# 4.3 传输模式
考虑数据在设备之间传输时，最关心的是线路，而在考虑线路时，最关心的就是数据流——一次发送一位，还是多位成组发送，如果成组发送，那么如何成组？结果会如何？事实上，**通过链路传输二进制数据，可以采用并行模式或串行模式**——==在并行模式中，每个时钟脉冲发送多位；在串行模式中，每个时钟脉冲发送一位==。并行传输只有一种方式，**串行传输则分为三类：异步、同步与等时**（见图4.31）：
![在这里插入图片描述](https://img-blog.csdnimg.cn/769bb08084804f03a934aaf0e141e423.png)

## 4.3.1 并行传输
由 $1$ 和 $0$ 构成的二进制数据，可以组成每组为 $n$ 位的位组。计算机使用和生成以**位组**为单位的数据，这像在英语会话时用单词而非一个一个字母来交流一样。通过位组，一次可以发送 $n$ 位数据而不是 $1$ 位。这种方式称为**并行传输** `parallel transmission` 。

并行传输机制原理上很简单：**每次使用 $n$ 条线路传送 $n$ 位**。==这种方式中每位有自己的线路，一个位组中的所有 $n$ 位能够在一个时钟脉冲，从一个设备传输到另一个设备==。图4.32说明了 $n = 8$ 时并行传输的工作情况。通常将 $8$ 条电线捆成一根电缆，两端各有一个连接头。

**并行传输的优点是速度**，当其他因素相同时，并行传输比串行传输可以提高 $n$ 倍传输速度。但是也有**一个严重缺点，那就是成本高**，并行传输需要 $n$ 条线路（本例中是电线）传输数据流。**因为比较昂贵，并行传输通常只用于短距离通信**。
## 4.3.2 串行传输
在**串行传输** `serial transmission` 中，位是一个一个依次传输的，因此在两个通信设备之间传输数据，只需要一条而非 $n$ 条传输通道（见图4.33）。串行传输与并行传输相比，其**优点是只需要一条通信通道，串行传输的成本大约只是并行传输的 $1/n$** 。

因为在设备内部是并行的，所以在发送方与线路之间（并行/串行转换）以及接收方与线路之间（串行/并行转换）的接口，都需要**转换设备**。串行传输可以使用三种方式之一：异步、同步与等时。
### 1. 异步传输
==如果在传输中信号的时序并不重要，将这种传输称为**异步传输** `asynchronous transmission` ，信息的接收和转换通过约定的模式进行==。**只要遵循约定模式，接收设备就可以不管信息发送的节奏、而正确地获得信息**。约定模式是基于「将位流组成字节的方式」建立的，**每一组（通常是 $8$ 位）作为一个单位沿着链路传送**。发送系统独立处理每个分组，每处理完一个组，就将它转发到链路上，而不理会时钟信号。

没有同步时钟，接收方就不能通过计时方式预测下一个新组何时到达。所以，为了通知接收方有一个新的组到达，在每个字节的开始处增加一个位，这一位（通常是 $0$）称为**起始位** `start bit` 。为了让接收方知道字节已经结束，在每个字节的结束处增加一个位或多个位，这些位（通常是 $1$）称为**停止位** `stop bit` 。通过这种方法，每个字节至少要增加到 $10$ 位，其中 $8$ 位是信息，$2$ 位或更多位是给接收方的提示信号。此外，每发送完一个字节，可能还要跟上一段「**可变长的时间间隔**」。这段间隔或者通过**空闲状态**表示，或者通过**附加的停止位流**表示。

==起始位、停止位、时间间隔用于提示接收方**每个字节的开始和结束**，使接收方可以**根据数据流进行同步**==。因为在字节这一级，发送方和接收方不需要进行同步（**字节级上的异步**）。但是在每一个字节内部，接收方仍要与输入的位流进行同步，这种机制称为**异步**。也就是说，==一定程度上的同步还是存在的，但是只局限在单个字节内，即每位仍然要同步，它们的持续时间是相同的==。每个新字节开始时，接收设备会重新进行同步——当接收方检测到起始位后，它会启动计时器，随着位的到来开始计数。在接收完 $n$ 个位后，接收方就等待停止位到达，一旦检测到停止位，接收方在下一个起始位到达前，会忽视接受到的所有信号。

图4.34是异步传输的示意图。在这个例子中，起始位是 $0$ ，停止位是 $1$ ，间隙用线路的空闲状态表示，而不是附加的停止位流来表示。
![在这里插入图片描述](https://img-blog.csdnimg.cn/43bdba3fa8a843709bc476889220089c.png)
附加了停止位和起始位，以及在位流中插入间隙，使得异步传输要比「没有附加控制信息的传输方式」运行得慢一些，但是这种方式**既便宜又有效**，对于某些情况（如**低速通信**），它的两种优点使得其显得很有吸引力。例如，==键盘到计算机的连接自然是异步传输的一种应用，用户一次只会输入一个字符，从数据处理方面来说，输入是非常慢的，并且每个字符之间留有不可预计的时间间隙==。

### 2. 同步传输
==在**同步传输** `synchronous transmission` 中，位流被组合成为更长的“帧”，一帧包含了多个字节==。**引入帧内的各字节之间没有间隙，也不含起始位和停止位**。接收方必须在解码时将位流分解为字节。换句话说，数据以一种**不间断的 $1$ 和 $0$ 位串**进行传输，接收方将位流分割成重构信息所需的一个个字节。

图4.35给出了同步传输的示意图。在字节之间画出了分隔线。实际上，这些分隔线是不存在的，发送方将数据作为一个长的串发送到线路上。==如果发送方希望单独地一段段地发送数据，则每段数据之间的间隙，必须由意味着**空闲状态**的 $0$ 和 $1$ 序列填充==。接收方将在位到达时计数，并将它们重组为字节形式。着重说明的一点是，==虽然在以同步串行传输的字符间没有间隙，但是帧间可能有不等的间隙==。
![在这里插入图片描述](https://img-blog.csdnimg.cn/9bc1fca3ed3b474698822043bc46db56.png)
因为没有时隙、起始位和停止位，就没有「位流内部的同步机制」来帮助接收设备在处理位流时调整位同步。由于「接收到的信息的准确性」完全取决于「接收设备对接收到的位的准确计数能力」，所以计时变得非常重要。

**同步传输的优点是速度快**，因为发送方没有引入额外的位或间隙，并且接收方也不需要将它们去掉，即通过链路传送的位更少，所以同步传输比异步传输要快。由于这个原因，**它在高速应用当中更加有用**，例如计算机之间的数据传输。字节同步在数据链路层完成。

### 3. 等时
**在实时音频和视频中，帧间的不等延迟是不可接受的**。例如，TV图像以每秒 $30$ 个图像的速率广播，它们必须看成一样的速率。如果一个图像是用一个或多个帧发送，帧间应该没有延迟。对于这种应用，字符间的同步是不够的，整个流必须同步。==**等时传输** `isochronous transmission` 保证了数据以固定速率到达==。

