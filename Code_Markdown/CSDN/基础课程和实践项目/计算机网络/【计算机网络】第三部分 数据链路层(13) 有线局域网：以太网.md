@[toc]

我们知道，局域网`LAN`用于有限的地理范围，如一幢建筑物或一个学校的计算机网络。虽然为了共享资源这一目的，**可以将`LAN`作为孤立的网络、用来连接一个组织内的计算机**，但是，当今很多的`LAN`也连接到广域网`WAN`或因特网上。

**局域网市场有多种技术**，例如以太网、令牌环、令牌总线、`FDDI`和`ATMLAN`。其中的某些技术只生存了一段时间，而**如今最普遍应用的技术是以太网**。在本章中，**先简要地介绍IEEE标准项目802**，它被设计来规范制造`LAN`以及不同`LAN`之间的互连。然后**主要介绍以太局域网**，以太网是使用最广泛的局域网协议。

虽然在过去的几十年，以太网经历了四代的发展，但主要理念还是相同的，且已经对以太网进行了改进以满足市场的需求，并对新技术加以应用。

从图1-4中可以看出，在TCP/IP协议族中，链路层主要有三个目的：==（1）为IP模块发送和接收IP数据报；（2）为ARP模块发送ARP请求和接收ARP应答；（3）为RARP发送RARP请求和接收RARP应答==。TCP/IP支持多种不同的链路层协议，这取决于网络所使用的硬件，如以太网、令牌环网、FDDI（光纤分布式数据接口）及RS-232串行线路等。

详细讨论**以太网链路层协议**，两个串行接口链路层协议（SLIP和PPP），以及大多数实现都包含的**环回（loopback）驱动程序**。以太网和SLIP是本书中大多数例子使用的链路层。对MTU（最大传输单元）进行了介绍，这个概念在后面章节中将多次遇到。还讨论了==如何为串行线路选择MTU==。

---
# 13.1 IEEE标准
1985年，电气与电子工程师学会`IEEE`开始了一个项目，称为 `Project802` ，以设定标准使得不同制造商生产的设备之间能相互通信。项目802并不旨在代替OSI或因特网模型。相反，**它说明了大多数局域网协议的物理层和数据链路层的功能**。这一标准被美国国家标准协会`ANSI`所采用。1987年，国际标准化组织`OSI`也批准它成为一个国际标准，命名为ISO8802。

图13.1显示了802标准和传统的OSI模型之间的关系。IEEE将**数据链路层**分为两个子层：**逻辑链路控制层** `logical link control, LLC` 和**介质访问控制层** `media access control, MAC` 。**IEEE也为不同的局域网协议制定了一些物理层标准**。
![图13.1局域网的IEEE标准](https://img-blog.csdnimg.cn/d6e40efb763749de86d123da2da66406.png)
以太网这个术语一般是指数字设备公司（Digital Equipment Corp.）、英特尔公司（Intel Corp.）和Xerox公司在1982年联合公布的一个标准。它是==当今TCP/IP采用的主要的局域网技术。它采用一种称作CSMA/CD的媒体接入方法==，其意思是带冲突检测的载波侦听多路接入（Carrier Sense, Multiple Access with Collision Detection）。它的速率为10Mb/s，地址为48bit。

几年后，IEEE（电子电气工程师协会）802委员会公布了一个稍有不同的标准集，其中802.3针对整个CSMA/CD网络，802.4针对令牌总线网络，802.5针对令牌环网络。这三者的共同特性由802.2标准来定义，那就是==802网络共有的逻辑链路控制（LLC）==。不幸的是，802.2和802.3定义了一个与以太网不同的帧格式。文献[Stallings1987]对所有的IEEE802标准进行了
详细的介绍。

在TCP/IP世界中，**以太网**IP数据报的封装是在RFC 894 [Hornig 1984]中定义的，**IEEE 802网络**的IP数据报封装是在RFC 1042[Postel and Reynolds 1988]中定义的。主机需求RFC（？）要求每台Internet主机都与一个10Mb/s的以太网电缆相连接：
1) **必须能发送和接收**采用RFC 894（以太网）封装格式的分组。
2) 应该能接收与RFC894混合的RFC 1042（IEEE802）封装格式的分组。
3) 也许能够发送采用RFC1042格式封装的分组。==如果主机能同时发送两种类型的分组数据，那么发送的分组必须是可以设置的，而且默认条件下必须是RFC894分组。

**最常使用的封装格式是RFC894定义的格式**。图2-1显示了两种不同形式的封装格式。图中每个方框下面的数字是它们的字节长度。
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307231116076.png)
两种帧格式都采用**48bit（6字节）的目的地址和源地址**（802.3允许使用16bit的地址，但一般是48bit地址）。这就是我们在本书中所称的硬件地址。ARP和RARP协议对32bit的IP地址和48bit的硬件地址进行映射。

接下来的2个字节在两种帧格式中**互不相同**。
- 在802标准定义的帧格式中，长度字段是指它后续数据的字节长度，但不包括CRC检验码。
- 以太网的类型字段定义了后续数据的类型。在802标准定义的帧格式中，类型字段则由后续的子网接入协议（Sub-networkAccess Protocol，SNAP）的首部给出。==幸运的是，802定义的有效长度值与以太网的有效类型值无一相同，这样，就可以对两种帧格式进行区分==。

在以太网帧格式中，类型字段之后就是数据；而在802帧格式中，跟随在后面的是3字节的802.2 LLC和5字节的802.2 SNAP。**目的服务访问点**（Destination Service Access Point,
DSAP）和**源服务访问点**（Source Service Access Point, SSAP）的值都设为0xaa。Ctrl字段的值设为3。随后的3个字节org code都置为0。==再接下来的2个字节类型字段和以太网帧格式一样==（其他类型字段值可以参见RFC1340[Reynolds and Postel 1992]）。

CRC字段用于帧内后续字节差错的**循环冗余码检验**（检验和）（它也被称为FCS或帧检验序列）。802.3标准定义的帧和以太网的帧都有最小长度要求。802.3规定数据部分必须至少为38字
节，而==对于以太网，则要求最少要有46字节。为了保证这一点，必须在不足的空间插入填充（pad）字节==。在开始观察线路上的分组时将遇到这种最小长度的情况。

在本书中，在需要时将给出以太网的封装格式，因为这是最为常见的封装格式。
## 2.3 尾部封装
RFC 893[Leffler and Karels 1984]描述了==另一种用于以太网的封装格式==，称作尾部封装（trailer encapsulation）。这是一个早期BSD系统在DECVAX机上运行时的试验格式，它通过调整IP数据报中字段的次序来提高性能。==在以太网数据帧中，开始的那部分是变长的字段（IP首部和TCP首部）。把它们移到尾部（在CRC之前），这样当把数据复制到内核时，就可以把数据帧中的数据部分映射到一个硬件页面，节省内存到内存的复制过程==。？TCP数据报的长度是512字节的整数倍，正好**可以用内核中的页表来处理**。两台主机通过协商使用ARP扩展协议对数据帧进行尾部封装。这些数据帧需定义不同的以太网帧类型值。

现在，尾部封装已遭到反对，因此我们不对它举任何例子。有兴趣的读者请参阅RFC 893以及文献[Leffler et al.1989]的11.8节。
## 2.4 SLIP：串行线路IP
SLIP的全称是Serial Line IP。它是一种==在串行线路上对IP数据报进行封装的简单形式==，在RFC 1055[Romkey1988]中有详细描述。SLIP适用于家庭中每台计算机几乎都有的RS-232串行端口和高速调制解调器接入Internet。

下面的规则描述了SLIP协议定义的帧格式：
1) **IP数据报以一个称作END（0xc0）的特殊字符结束**。同时，为了防止数据报到来之前的线路噪声被当成数据报内容，大多数实现在数据报的开始处也传一个END字符（如果有线路噪声，那么END字符将结束这份错误的报文。这样当前的报文得以正确地传输，而前一个错误报文交给上层后，会发现其内容毫无意义而被丢弃）。
2) *如果IP报文中某个字符为END，那么就要连续传输两个字节0xdb和0xdc来取代它*。0xdb这个特殊字符被称作SLIP的ESC字符，但是它的值与ASCII码的ESC字符（0x1b）不同。
3) *如果IP报文中某个字符为SLIP的ESC字符*，那么就要连续传输两个字节0xdb和0xdd来取代它。
    0xc0 -> 0xdb 0xdc
    0xdb -> 0xdb 0xdd 

图2-2中的例子就是含有一个END字符和一个ESC字符的IP报文。在这个例子中，**在串行线路上传输的总字节数是原IP报文长度再加4个字节**。
图2-2 SLIP报文的封装
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307231128132.png)
SLIP是一种简单的帧封装方法，还有一些值得一提的缺陷：
1) **每一端必须知道对方的IP地址。没有办法把本端的IP地址通知给另一端**。
2) 数据帧中没有类型字段（类似于以太网中的类型字段）。如果一条串行线路用于SLIP，那么==它不能同时使用其他协议==。
3) SLIP没有在数据帧中加上检验和（类似于以太网中的CRC字段）。如果SLIP传输的报文被线路噪声影响而发生错误，只能通过上层协议来发现（另一种方法是，新型的调制解调器可以检测并纠正错误报文）。这样，上层协议提供某种形式的CRC就显得很重要。在第3章和第17章中，我们将看到IP首部和TCP首部及其数据始终都有检验和。在第11章中，将看到UDP首部及其数据的检验和却是可选的。

尽管存在这些缺点，SLIP仍然是一种广泛使用的协议。
> SLIP的历史要追溯到1984年，RickAdams第一次在4.2BSD系统中实现。尽管它本身的描述是一种非标准的协议，但是随着调制解调器的速率和可靠性的提高，SLIP越来越流行。现在，它的许多产品可以公开获得，而且很多厂家都支持这种协议。
## 2.5 压缩的SLIP
由于串行线路的速率通常较低（19200b/s或更低），而且通信经常是交互式的（如Telnet和Rlogin，二者都使用TCP），因此在SLIP线路上有许多小的TCP分组进行交换。==为了传送1个字节的数据需要20个字节的IP首部和20个字节的TCP首部，总数超过40个字节==（19.2节描述了Rlogin会话过程中，当敲入一个简单命令时这些小报文传输的详细情况）。

既然承认这些性能上的缺陷，于是人们提出一个被称作CSLIP（即压缩SLIP）的新协议，它在RFC1144[Jacobson 1990a]中被详细描述。CSLIP一般能把上面的40个字节压缩到3或5个字节。==它能在CSLIP的每一端维持多达16个TCP连接，并且知道其中每个连接的首部中的某些字段一般不会发生变化==。对于那些发生变化的字段，大多数只是一些小的数字和的改变。这
些被压缩的首部大大地缩短了交互响应时间。
> 现在大多数的SLIP产品都支持CSLIP。作者所在的子网（参见封面内页）中有两条SLIP链路，它们均是CSLIP链路。
## 2.6PPP：点对点协议
PPP，点对点协议修改了SLIP协议中的所有缺陷。PPP包括以下三个部分：
1) 在串行链路上封装IP数据报的方法。PPP既支持数据为8位和无奇偶检验的**异步模式**（如大多数计算机上都普遍存在的串行接口），还支持**面向比特的同步链接**。
2) 建立、配置及测试数据链路的链路控制协议（LCP：Link Control Protocol）。它允许通信双方进行协商，以确定不同的选项。
3) 针对不同网络层协议的网络控制协议（NCP：Network Control Protocol）体系。当前RFC定义的网络层有IP、OSI网络层、DECnet以及AppleTalk。例如，IPNCP允许双方商定是否对报文首部进行压缩，类似于CSLIP（缩写词NCP也可用在TCP的前面）。

RFC 1548[Simpson 1993]描述了报文封装的方法和链路控制协议。RFC1332[Mc Gregor 1992]描述了针对IP的网络控制协议。

PPP数据帧的格式看上去很像ISO的HDLC（高层数据链路控制）标准。图2-3是PPP数据帧的格式。每一帧都以标志字符0x7e开始和结束。紧接着是一个地址字节，值始终是0xff，然后是一个值为0x03的控制字节。
图3 PPP数据帧的格式
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307232202987.png)
接下来是协议字段，类似于以太网中类型字段的功能。当它的值为0x0021时，表示信息字段是一个IP数据报；值为0xc021时，表示信息字段是链路控制数据；值为0x8021时，表示信息字段是网络控制数据。

CRC字段（或FCS，帧检验序列）是一个**循环冗余检验码**，以检测数据帧中的错误。

由于标志字符的值是0x7e，因此当该字符出现在信息字段中时，PPP需要对它进行转义。
- 在**同步链路**中，该过程是通过一种称作比特填充(bitstuffing)的硬件技术来完成的[Tanenbaum 1989]。
- 在**异步链路**中，==特殊字符0x7d用作转义字符。当它出现在PPP数据帧中时，那么紧接着的字符的第6个比特要取其补码==，具体实现过程如下：
    1) 当遇到字符0x7e时，需连续传送两个字符：0x7d和0x5e，以实现标志字符的转义。
    2) 当遇到转义字符0x7d时，需连续传送两个字符：0x7d和0x5d，以实现转义字符的转义。
    3) 默认情况下，如果字符的值小于0x20（比如，一个ASCII控制字符），一般都要进行转义。例如，遇到字符0x01时需连续传送0x7d和0x21两个字符（这时，第6个比特取补码后变为1，而前面两种情况均把它变为0）。

这样做的原因是**防止它们出现在双方主机的串行接口驱动程序或调制解调器中**，因为有时它们会把这些控制字符解释成特殊的含义。另一种可能是**用链路控制协议来指定是否需要对这32个字符中的某一些值进行转义**。默认情况下是对所有的32个字符都进行转义。

与SLIP类似，由于PPP经常用于低速的串行链路，因此减少每一帧的字节数可以降低应用程序的交互时延。==利用链路控制协议，大多数的产品通过协商可以省略标志符和地址字段，并且把协议字段由2个字节减少到1个字节==。如果我们把PPP的帧格式与前面的SLIP的帧格式（图2-2）进行比较会发现，PPP只增加了3个额外的字节：1个字节留给协议字段，另2个给CRC字段使用。另外，使用IP网络控制协议，大多数的产品可以通过协商采用Van Jacobson报文首部压缩方法（对应于CSLIP压缩），减小IP和TCP首部长度。

总的来说，PPP比SLIP具有下面这些优点：
(1) PPP支持在单根串行线路上运行多种协议，不只是IP协议；(2) 每一帧都有循环冗余检验；
(3) 通信双方可以进行IP地址的动态协商(使用IP网络控制协议)；
(4) 与CSLIP类似，对TCP和IP报文首部进行压缩；
(5) ==链路控制协议可以对多个数据链路选项进行设置。为这些优点付出的代价是在每一帧的首部增加3个字节==，当建立链路时要发送几帧协商数据，以及更为复杂的实现。

尽管PPP比SLIP有更多的优点，但是现在的SLIP用户仍然比PPP用户多。随着产品越来越多，产家也开始逐渐支持PPP，因此最终PPP应该取代SLIP。

## 2.7 环回接口
**大多数的产品都支持环回接口（Loopback Interface），以允许运行在同一台主机上的客户程序和服务器程序通过TCP/IP进行通信**。==A类网络号127就是为环回接口预留的==。根据惯例，**大多数系统把IP地址127.0.0.1分配给这个接口，并命名为localhost**。==一个传给环回接口的IP数据报不能在任何网络上出现==。

我们想象，**一旦传输层检测到目的端地址是环回地址时，应该可以省略部分传输层和所有网络层的逻辑操作**。但大多数的产品还是照样完成传输层和网络层的所有过程，**只是当IP数据报离开网络层时把它返回给自己**。图4是环回接口处理IP数据报的简单过程。
图4 环回接口处理IP数据报的过程
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307232212401.png)
图中需要指出的关键点是：
1) 传给环回地址（一般是127.0.0.1）的任何数据**均作为IP输入**。
2) 传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是因为**广播传送和多播传送的定义（第12章）包含主机本身**。
3) **任何传给该主机IP地址的数据均送到环回接口**。

看上去用传输层和IP层的方法来处理环回数据似乎效率不高，但它简化了设计，因为==环回接口可以被看作是网络层下面的另一个链路层==。网络层把一份数据报传送给环回接口，**就像传给其他链路层一样，只不过环回接口把它返回到IP的输入队列中**。

在图2-4中，另一个隐含的意思是**送给主机本身IP地址的IP数据报一般不出现在相应的网络上**。例如，在一个以太网上，分组一般不被传出去然后读回来。某些BSD以太网的设备驱动程序的注释说明，**许多以太网接口卡不能读回它们自己发送出去的数据**。由于一台主机必须处理发送给自己的IP数据报，因此图2-4所示的过程是最为简单的处理办法。
> 4.4BSD系统定义了变量useloopback，并初始化为1。但是，如果这个变量置为0，以太网驱动程序就会把本地分组送到网络，而不是送到环回接口上。它也许不能工作，这取决于所使用的以太网接口卡和设备驱动程序。

## 2.8 最大传输单元MTU
正如在图2-1看到的那样，以太网和802.3对数据帧的长度都有一个限制，其最大值分别是1500和1492字节。链路层的这个特性称作MTU，最大传输单元。不同类型的网络大多数都有一个上限。

如果IP层有一个数据报要传，而且数据的长度比链路层的MTU还大，那么IP层就需要进行分片（fragmentation），把数据报分成若干片，这样每一片都小于MTU。在11.5节讨论IP分片的过程。

图2-5列出了一些典型的MTU值，它们摘自RFC 1191[Mogul and Deering1990]。点到点的链路层（如SLIP和PPP）的MTU并非指的是网络媒体的物理特性。相反，**它是一个逻辑限制，目的是为交互使用提供足够快的响应时间**。在2.10节中，我们将看到这个限制值是如何计算出来的。

在3.9节中，我们将用netstat命令打印出网络接口的MTU。
## 2.9 路径MTU
当在同一个网络上的两台主机互相进行通信时，**该网络的MTU是非常重要的**。但如果两台主机之间的通信要通过多个网络，那么每个网络的链路层就可能有不同的MTU。==重要的不是两台主机所在网络的MTU的值，重要的是两台通信主机路径中的最小MTU。它被称作路径MTU==。

两台主机之间的路径MTU不一定是个常数。它取决于当时所选择的路由。而选路不一定是对称的（从A到B的路由可能与从B到A的路由不同），因此**路径MTU在两个方向上不一定是一致的**。

RFC 1191[Mogul and Deering 1990]描述了路径MTU的发现机制，即在任何时候确定路径MTU的方法。我们在介绍了ICMP和IP分片方法以后再来看它是如何操作的。
- 在11.6节中，我们将看到ICMP的不可到达错误就采用这种发现方法。
- 在11.7节中，还会看到，traceroute程序也是用这个方法来==确定到达目的节点的路径MTU==。
- 在11.8节和24.2节，将介绍当产品支持路径MTU的发现方法时，UDP和TCP是如何进行操作的。

## 2.10 串行线路吞吐量计算
如果线路速率是9600b/s，而一个字节有8bit，加上一个起始比特和一个停止比特，那么线路的速率就是960B/s（字节/秒）。这个速率传输一个1024字节的分组需要1066ms。如果用SLIP链接运行一个交互式应用程序，同时还运行另一个应用程序如FTP发送或接收1024字节的数据，那么一般来说就必须等待一半的时间（533ms）才能把交互式应用程序的分组数据发送出去。

假定交互分组数据可以在其他“大块”分组数据发送之前被发送出去。**大多数的SLIP实现确实提供这类服务排队方法，把交互数据放在大块的数据前面**。交互通信一般有Telnet、Rlogin以及FTP的控制部分（用户的命令，而不是数据）。

这种服务排队方法是不完善的。它不能影响已经进入下游（如串行驱动程序）队列的非交互数据。同时，新型的调制解调器具有很大的缓冲区，因此非交互数据可能已经进入该缓冲区了。

对于交互应用来说，等待533ms是不能接受的。关于人的有关研究表明，交互响应时间超过100～200ms就被认为是不好的[Jacobson 1990a]。这是发送一份交互报文出去后，直到接收到响应信息（通常是出现一个回显字符）为止的往返时间。

把SLIP的MTU缩短到256就意味着链路传输一帧最长需要266ms，它的一半是133ms（这是一般需要等待的时间）。这样情况会好一些，但仍然不完美。我们选择它的原因（与64
或128相比）是因为**大块数据提供良好的线路利用率**（如大文件传输）。假设CSLIP的报文首部是5个字节，数据帧总长为261个字节，256个字节的数据使线路的利用率为98.1%，帧头占了1.9%，这样的利用率是很不错的。如果把MTU降到256以下，那么将降低传输大块数据的最大吞吐量。

在图2-5列出的MTU值中，点对点链路的MTU是296个字节。假设数据为256字节，TCP和IP首部占40个字节。==由于MTU是IP向链路层查询的结果，因此该值必须包括通常的TCP和IP首部==。这样就会导致IP如何进行分片的决策。IP对于CSLIP的压缩情况一无所知。

我们对平均等待时间的计算（传输最大数据帧所需时间的一半）只适用于SLIP链路（或PPP链路）在交互通信和大块数据传输这两种情况下。
- 当只有交互通信时，如果线路速率是9600b/s，那么任何方向上的1字节数据（假设有5个字节的压缩帧头）往返一次都大约需要12.5ms。它比前面提到的100~200ms要小得多。需要注意的是，由于帧头从40个字节压缩到5个字节，使得1字节数据往返时间从85ms减到12.5ms。

不幸的是，当使用新型的纠错和压缩调制解调器时，这样的计算就更难了。这些调制解调器所采用的压缩方法使得在线路上传输的字节数大大减少，但纠错机制又会增加传输的时间。不过，这些计算是我们进行合理决策的入口点。

在后面的章节中，我们将用这些串行线路吞吐量的计算来验证数据从串行线路上通过的时间。
## 2.11 小结
本章讨论了Internet协议族中的最底层协议，链路层协议。我们比较了以太网和IEEE802.2/802.3的封装格式，以及SLIP和PPP的封装格式。由于SLIP和PPP经常用于低速的链路，二者都提供了压缩不常变化的公共字段的方法。这使交互性能得到提高。

**大多数的实现都提供环回接口。访问这个接口可以通过特殊的环回地址，一般为127.0.0.1**。也可以通过发送IP数据报给主机所拥有的任一IP地址。当环回数据回到上层的协议栈中时，它已经过传输层和IP层完整的处理过程。

描述了很多链路都具有的一个重要特性，MTU，相关的一个概念是路径MTU。根据典型的串行线路MTU，对SLIP和CSLIP链路的传输时延进行了计算。

本章内容只覆盖了当今TCP/IP所采用的部分数据链路公共技术。TCP/IP成功的原因之一是它几乎能在任何数据链路技术上运行。
习题
2.1如果你的系统支持netstat(1)命令（参见3.9节），那么请用它确定系统上的接口及其MTU。
## 13.1.1 数据链躇层
正如之前提到的那样，在IEEE标准中，数据链路层被分成两个子层：`LLC` 和 `MAC` 。
### 1.逻辑链路控制层LLC
在[【计算机网络】第三部分数据链路层(11)]()中介绍了数据链路控制。**数据链路层是用来处理封装成帧、流量控制和差错控制的**。==在IEEE项目802中，流量控制、差错控制和部分成帧的职能，都被集中到称为逻辑链路控制层的子层中==。LLC和MAC两者都进行成帧处理。

**LLC为所有的IEEE局域网提供一个单一的数据链路控制协议**。在这方面，LLC不同于介质访问控制子层，**后者为不同的局域网提供不同的协议**。==一个单一的LLC协议，能使不同的局域网之间进行相互交换，因为它使MAC子层变得透明==。图13.1显示了「为多个MAC协议服务的一个单一LLC协议」。

#### (1)成帧
LLC定义了一个**协议数据单元**`PDU`，它在一定程度上与HDLC相似。头部包含一个控制字段（就像HDLC中的一样），这个字段用以流量控制和差错控制。另两个头部字段界定了**使用LLC的源和目的地的上层协议**，这些字段称为**目的业务接入点**`destinationserviceaccesspoint,DSAP`和**源业务接入点**`sourceserviceaccesspoint,SSAP`。

==在典型的数据链路控制协议中定义的其他协议（如HDLC），被移入到了MAC子层中==。换言之，HDLC中定义的帧被分为「LLC子层的PDU」和「MAC子层的一个帧」`aframedefinedinHDLCisdividedintoaPDUattheLLCsublayerandaframeattheMACsublayer`，如图13.2所示。（？）
![图13.2HDLC帧与LLC及MAC帧的比较](https://img-blog.csdnimg.cn/a2856d3d3f9f41feb026dc1835727baf.png)
#### (2)LLC的需求
LLC的目的是**为需要流量控制和差错控制的上层协议提供这些服务**`provideflowanderrorcontrolfortheupper-layerprotocolsthatactuallydemandtheseservices`。例如，==如果一个或几个局域网被应用于一个孤立的系统中，就需要LLC为应用层协议提供流量控制和差错控制==。然而，**多数上层协议诸如IP并不需要LLC的服务**。因此，就此结束对LLC的介绍。
### 2.介质访问控制层MAC
在[【计算机网络】第三部分数据链路层(12)]()中，介绍了包括随机访问、受控访问和通道化等的多种访问方法。IEEE项目802创造了一个称为**介质访问控制层**的子层，来**为每个局域网定义特定的访问方法**。例如，它定义==CSMA/CD作为以太网的介质访问方法，**令牌传递方法**`token-
passingmethod`为令牌环和令牌总线局域网`TokenRingandTokenBusLANs`的介质访问方法==。

正如之前讨论的那样，MAC子层同样也有部分成帧的功能。与LLC子层相比较，==MAC子层包含了一些独特的模块，每个模块都为相应的局域网协议定义了**访问方法**和**成帧的格式**==。

## 13.1.2物理层
物理层取决于**网络的实现**和**使用的物理介质**。IEEE为每个局域网的实现定义了详细的规范。例如，**在标准以太网中虽然只有一个MAC子层**，但是每种以太网的实现都有不同的物理层规范，稍后会作介绍。

---
#13.2标准以太网
最初的以太网是由施乐公司的PaloAlto研究中心（PARC）于1976年创建的。自此之后，它经历了四代发展：**标准以太网**`StandardEthernet`（$10\textrm{Mbps}$），**快速以太网**`FastEthernet`（$100\textrm{Mbps}$），**干兆以太网**`GigabitEthernet`（$1\textrm{Gbps}$）和**$10$干兆以太网**`Ten-GigabitEthernet`（$10\textrm{Gbps}$)，如图13.3所示。==以太网定义了一些$1\textrm{Mbps}$协议，但它们没有发展起来==。
![图13.3以太网的四代发展](https://img-blog.csdnimg.cn/675b3f50b9fc4790830ebc1f20a44ace.png)
下面简要地介绍这四代以太网，先介绍标准（或传统）以太网。
## 13.2.1MAC子层
在标准以太网中，**MAC子层控制访问方法**，还**负责将来自上层的数据封装成帧**并传输给物理层。

### 1.帧的格式
以太网的帧包括$7$个字段：前导符、SFD、DA、SA、协议数据单元`PDU`的长度/类型、上层数据和CRC。MAC的帧格式如图13.4所示。==对接收到的帧，**以太网不提供确认的任何机制**，所以将它称做不可靠的介质，确认必须在其高层完成==。
![图13.4802.3MAC帧](https://img-blog.csdnimg.cn/9b1223c7c7a54f4b840338d3ce11a56c.png)
-**前导符**`preamble`。`802.3`帧的第一个字段包含$7$个字节，其中的$1$和$0$交替出现，以此**通知接收系统有帧的到来**、并且**使其与输入的时钟同步**。该模式仅提供一个通知和时钟脉冲。位模式容许站点在帧的开始可以丢弃一些位。实际上，**前导符是在物理层上加进去的，并不是帧的一个部分**。
-**起始帧分界符**`SFD`。第二个字段占$1$个字节：$10101011$**说明帧的开始**。`SFD`通知站点「这是最后一个同步的机会」。最后的两位是$11$，并且**通知接收方下一个字段是目的地址**。
-**目的地址**`DA`。这一字段为$6$个字节，包含目的站点或接收该分组的站点的物理地址。后面会简要地介绍目的地址。
-**源地址**`SA`。这一字段也是6个字节，包含分组的发送方的物理地址。后面会简要地介绍源地址。
-**长度/类型**。这一字段定义为长度或类型字段。==最初的以太网使用这个字段作为类型字段，定义使用MAC帧的上层协议。IEEE标准则使用它作为长度字段，定义数据字段的字节数==。在今天两者都被普遍使用。
-**数据**。这一字段的内容是由上一层协议封装的数据。它最少是$46$字节，最大是$1500$字节。如后面所述。
-CRC。最后字段为$4$字节的差错检测信息，在此情况下为CRC-32（第10章）。

### 2.帧的长度
**以太网对帧长度的最小值和最大值都有严格的规定**。如图13.5所示。==长度最小值的限定，是为了满足CMSA/CD正确运行的需要==——以太网的帧必须有一个长度最小值：$512$位或$64$字节。长度的一部分是头部和尾部，如果将头部和尾部算为$18$字节（源地址$6$字节，目的地址$6$字节，长度或类型$2$字节及CRC$4$字节），那么**来自上层的数据的最小长度是$64-18=46$字节**。==如果上层分组小于$46$字节，相差部分将会被填充满==。
![图13.5最小长度和最大长度](https://img-blog.csdnimg.cn/ccf9359046a440e9b2627ef97b295c62.png)
该标准定义帧长度的最大值（不包括前导符和`SFD`字段）为$1518$字节。如果减去头部和尾部的$18$字节，**有效载荷的最大长度是$1500$字节**。长度最大值的限定有两个历史原因。
-第一，当以太网被设计出来时，存储器很贵：**最大长度的限制有助于减小缓冲器的大小**。
-第二，**长度最大值的限定防止了一个站点独占共享介质、而阻碍其他要发送数据的站点**。
![在这里插入图片描述](https://img-blog.csdnimg.cn/b1fa4835a11f492583b25971a4aac580.png)


###3.寻址
以太网中的每个站点（例如一台电脑、工作站或一台打印机）都有自己的**网络接口卡**`networkinterfacecard,NIC`，简称为网卡。网卡安在站点内部、并给该站点提供一个$6$字节的物理地址。如图13.6所示，==以太网地址是$6$字节的，通常用十六进制表示法`hexadecimalnotation`来表示，字节间以冒号断开==。
![图13.6用十六进制表示能表示的以太网地址的一个示例](https://img-blog.csdnimg.cn/78b5f94e99144e239a2c06eafd5574aa.png)

###4.单播地址、多播地址和广播地址
**源地址永远是一个单播地址**`unicastaddress`一一帧只来自一个站点。然而**目的地址既可以是单播地址，也可以是多播地址，还可以是广播地址**`unicast,multicast,orbroadcast`。图13.7说明了如何区分单播地址和多播地址。==如果目的地址字段第一个字节的最低位是$0$，那么这个地址是单播地址，否则便是多播地址==。
![图13.7单播地址和多播地址](https://img-blog.csdnimg.cn/89be6c04c4f04818a5be772a219c67eb.png)
单播目的地址限定了只有一个接收方，发送方和接收方之间的关系是一对一的。多播目的地址定义了一组地址，发送方和接收方之间的关系是一对多的。**广播地址是多播地址的一个特例：接收方是整个局域网中的所有站点**。一个广播目的地址是$48$位$1$（还有任播）。

【例3.1】定义下列目的地址的类型：
a.`4A:30:10:21:10:1A`
b.`47:20:1B:2E:08:EE`
c.`FF:FF:FF:FF:FF:FF`
解：==为了知道地址的类型，我们必须看左边第二个十六进制数字==。**如果是偶数，那么地址是单播地址。如果是奇数，那么地址是多播地址。如果所有的数字都是`F`，那么地址是广播地址**（偶单奇多F广）。因此，得到以下答案：
a.这是一个单播地址，因为`A`在二进制中是$1010$（偶数）。
b.这是一个多播地址，因为`7`在二进制中是$0111$（奇数）。
c.这是一个广播地址，因为所有的数字都是`F`。

**在线发送地址的方法**与将地址用十六进制表示能表示的方法不同。**传输是从左到右的**`left-to-right,bytebybyte`，然而==对每个字节而言，最低位被最先发送、而最高位被最后发送==。这就意味着界定地址是单播地址还是多播地址的那一位最先到达接收方。

【例13.2】请说明地址`47:20:1B:2E:08:EE`是如何在线发送的。
解：==地址被一个字节一个字节地从左向右发送，每个字节是一位一位地从右向左发送的==，如下所示：
```cpp
=>111000100000010011011000011101000001000001110111
```
###5.访问方法：CSMA/CD
IEEE802.3标准定义了，第一代$10$兆以太网即**标准以太网**使用**1-持续的CSMA/CD方法**（见第12章）。==在一个以太网络中，一个帧从最大长度网络的一个端到另一端之间往返所需的时间、加上发送干扰序列所需的时间称为**时隙**==`slottime`。时隙=往返时间+发送干扰序列所需时间。

==以太网的时隙以位来定义，它是一个站点发送$512$位（$64$字节）所需的时间。这就意味着，**实际的时隙取决于数据速率**==。对于传统的$10\textrm{Mbps}$以太网来说是$51.2\textrm{μs}$。

###6.时隙和冲突
==选择**$512$位的时隙**并非偶然，这个选择使得CSMA/CD能发挥正确的功能==。为了理解这点，看两种情况。
-在第一种情况中，发送方发送一个$512$位的最小分组。==**在发送方能将整个分组发出之前**，信号穿过网络并到达网络的终端。如果在网络的终端有另一个信号（最坏的情况），冲突就发生了==。发送方有机会放弃发送帧，并发送一个干扰序列以提醒其他的站点。**信号往返时间（取决于网络的长度）加上发送干扰序列所需的时间**必须小于**发送方发送最小的$512$位帧所需的时间**（看网络的传输速率）。发送方必须在它发送整个帧之前意识到冲突的存在，否则，就太迟了。
-在第二种情况中，发送方发送一个大于最小长度的帧（在$512$位和$1518$位之间）。这种情况下，==如果发送方已经发送了第一个$512$位并没有听到冲突，它便能保证在这个帧的传输过程中不会发生冲突==。原因是：
	-信号会在小于$1/2$时隙的时间内到达网络的终端。此后，如果所有的站点都遵循CSMA/CD协议，它们都已经检测到在线上这个信号的存在、并制止了自身的发送；
	-==如果它们在$1/2$时隙的时间期满之前发送了信号，冲突便发生了，而发送方会检测到冲突==。换言之，**冲突只可能在时隙的前半段`thefirsthalfoftheslottime`发生**，如果冲突真的发生了，发送方在时隙期间能检测到。
	<b></b>
	<b></b>
	
	这就是说发送方发送第一个$512$位之后，它便能保证在这个帧的传输过程中不会有冲突发生。**介质属于该发送方，而其他的站点不能使用介质**。换言之，==发送方只需要在发送第一个$512$位的时间内，"听"是否有冲突发生就可以了==。

当然，如果有一个站点不遵循CSMA/CD协议的话，所有这些假设都是不成立的。在这种情况下，不是发生了冲突，而是一个站点被损坏了。
###7.时隙和最大网络长度
**时隙和最大网络长度（冲突域）之间有关联**（信号往返时间与最大网络长度有关）。这取决于**在一个特定的介质中信号的传播速度**。在大多数传输介质中，信号以$2\times10^8m/s$传播（是在空气中传播速度的$2/3$）。==对传统以太网（传输速率为$10\textrm{Mbps}$）而言，（由于规定了时隙为发送$512$位的时间）计算如下==：
$$最大长度=传播速度\times(时隙/2)\\
=(2\times10^8)\times(51.2\times10^{-6}/2)=5120m$$

当然，我们需要考虑**中继器和接口的延迟**、以及**发送干扰序列所需的时间**。这些将传统以太网的最大长度减少为$2500$米，仅仅是理论上的$48\%$。

## 13.2.2物理层
**标准以太网定义了几种物理层的实现**；如图13.8显示了其中最通用的四种。
![图13.8标准以太网的分类](https://img-blog.csdnimg.cn/204c7cdb54e4448a8c1733654cec0b8c.png)
### 1.编码和解码
==所有标准的实现都使用$10\textrm{Mbps}$的数字信号（基带）。在发送方，使用**曼彻斯特方案**将数据转换成数字信号，在接收方，信号又被转译成曼彻斯特码并被解码成数据==。如在[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)中看到的，**曼彻斯特编码是自我同步的，在每一位的间隙提供一次转换**。图13.9显示了标准以太网的编码图解。
![图13.9标准以太网实现中的编码](https://img-blog.csdnimg.cn/8d50c73eff3a4aafa2cc1db3c8077337.png)

### 2.10Base5：粗缆以太网
第一个实现被称为`10Base5`，**粗缆以太网**`thickEthernet`或**粗缆网**`Thicknet`。这个别称是因电缆的粗细发展而来的，实际上粗略地说是橡胶软管的尺寸，并且非常坚硬不能用手弯曲。

10Base5是第一个以太网规范，它使用一个有**外部收发器**`transceiver`（发送器/接收器）的总线拓扑，并通过一个外接口与粗轴电缆相连接。图13.10显示了一个10Base5实现的示意图。
![图13.1010Base5的实现](https://img-blog.csdnimg.cn/e12509658919410691edf40fe544302b.png)
收发器负责传输、接收和检测冲突。收发器通过收发器电缆与站点连接，**收发器电缆能为发送和接收提供独立的路径**。这就意味着，冲突只会发生在粗轴电缆中。

**粗轴电缆的长度最大不能超过$500$米**，否则，便会出现信号的过分衰减。**如果长度必须超过$500$米，最多分五个分段**，每个分段的最大长度是$500$米，可以使用中继器连接。中继器在[【计算机网络】第三部分数据链路层(15)连接局域网、主干网和虚拟局域网](https://memcpy0.blog.csdn.net/article/details/122975047)中介绍。

###3.10Base2：细缆以太网
第二个实现是`10Base2`，**细缆以太网**`thinEthernet`，或**便宜网络**`Cheapernet`。10Base2使用总线拓扑，电缆细多了但很有弹性。电缆可以被弯曲、以离站点很近。这种情况下，**收发器通常是网卡`NIC`的一部分，被安装在站点内部**。图13.11显示了一个10Base2实现的理论流程图。
![图13.1110Base2的实现](https://img-blog.csdnimg.cn/91a97491549e4218b37c090741fbd023.png)

注意：**这种情况下冲突发生在细轴电缆中**。这个实现比10Base5的成本效益高，因为细轴电缆比粗轴电缆便直多了，且T型接口比分接头便宜。安装也因为细轴电缆的弹性变得简单多了。但是，因为细轴电缆中信号的高度衰减，**每个分段的长度不能超过$185$米**（接近$200$米）。
###4.10Base-T：双绞线以太网
第三个实现是`10Base-T`或者叫做双绞线以太网`twisted-pairEthernet`。==10Base-T使用**物理星型拓扑结构**，站点通过**双绞线**连接到一个网络集线器上==，如图13.12所示。
![图13.12](https://img-blog.csdnimg.cn/c67b6f8f4b024196b7c1d15e8731ce26.png)
注意：双绞线在站点和网络集线器之间形成了两条路径（一条发送一条接收）。**在这种情况下冲突发生在网络集线器中**。与10Base5或10Base2相比较，可以看到就冲突而言，**网络集线器实际上替代了同轴电缆的位置**。双绞线的最大长度是$100$米，以使得双绞电缆的信号衰减最小。
###5.10Base-F：光纤以太网
虽然$10$兆光纤以太网有很多种类型，但其中最普遍的还是`10Base-F`。==10Base-F使用一种**星型拓扑**，将站点与**网络集线器**相连接==。如图13.13所示，站点使用**两条光纤**与网络集线器相连接。
![图13.1310Base-F的实现](https://img-blog.csdnimg.cn/7dc6e772a26c4b75bb828d7386d38797.png)
###6.总结
表13.1将标准以太网的实现做了一个总结。
![表13.1标准以太网实现的总结](https://img-blog.csdnimg.cn/37890bf8cbe549098ed18bde39274f42.png)

---
#13.3标准的变化
$10\textrm{Mbps}$标准以太网在升级为更高的传输速率之前，已经经历了一些变化。这些变化事实上为以太网的发展开辟了一条新路，使得与其他高传输速率的局域网相比，以太网变得更有竞争性。在这部分，介绍其中的一些变化。
## 13.3.1桥接以太网
以太网发展的第一步是**将局域网用网桥`bridge`分割**。在以太局域网中，网桥有两个作用：**提高带宽**和**分割冲突域**。在[【计算机网络】第三部分数据链路层(15)连接局域网、主干网和虚拟局域网](https://memcpy0.blog.csdn.net/article/details/122975047)介绍网桥。
### 1.提高带宽
==在**非桥接以太局域网**中，总能力$10\textrm{Mbps}$被所有要发送帧的站点共享，这些站点共享网络的带宽==。如果只有一个站点要发送帧，它受益于总能力$10\textrm{Mbps}$。但是如果一个以上的站点要使用网络，能力就被共享了。例如，如果有两个站点要发送大量的帧，它们可能会轮流使用。当一个站点发送时，另一个站点停止发送。在这种情况下，可以认为平均每个站点发送的速度是$5\textrm{Mbps}$。图13.14说明了这种情况。
![图13.14带宽共享](https://img-blog.csdnimg.cn/064053c647384c758d1ff980b1e133bd.png)
在[【计算机网络】第三部分数据链路层(15)连接局域网、主干网和虚拟局域网](https://memcpy0.blog.csdn.net/article/details/122975047)中学到的网桥（类似两层交换机，可以过滤+转发帧）能在这里起作用，**一个网桥将网络分成两个或更多的网络**。

**基于带宽，每个网络都是独立的**。例如，图13.15中，一个有$12$个站点的网络被分成两个网络，每个网络有$6$个站点。每个网络的能力都是$10\textrm{Mbps}$。$10\textrm{Mbps}$的能力在每个网络中被$6$个站点（实际上是$7$个，因为网桥在每个网络也算一个站点）所共享，而并非$12$个。在一个重负荷的网络中，假定流量并不经过网桥，每个站点理论上能达到$10/6\textrm{Mbps}$而不是$10/12\textrm{Mbps}$。

显而易见，==如果进一步分割网络，能为每个部分得到更多的带宽==。例如，如果使用一个四端口的网桥，每个站点能使用$10/3\textrm{Mbps}$，这是非桥接网络的$4$倍。

![图13.15一个带有网桥的网络和不带网桥的网络](https://img-blog.csdnimg.cn/7cc218c62bb8482fae683dc4525c9f18.png)

### 2.分割冲突域
网桥的另一个优势就是**分割冲突域**`collisiondomain`。图13.16表示对于一个桥接网络和一个非桥接网络的冲突域的情况。从图中可以看到，==在有桥接的情况下，冲突域会变得更小、而且冲突的概率大幅度减少==。如果没有桥接，则有$12$个站点竞争访问介质，有了桥接之后，就只有$3$个站点竞争访问。
![图13.16一个带有网桥和不带有网桥网络的冲突域](https://img-blog.csdnimg.cn/dcf97abb5457430b8690680f1d5ce897.png)

## 13.3.2交换式以太网
**桥接`LAN`的概念进一步扩展为交换`LAN`**。与其将一个网络分割为$2$个到$4$个网络，**为什么不将其分割成$N$个网络呢**？这里的$N$是`LAN`上站点的个数。换句话说，如果有多个端口的网桥，为什么不能有$N$个端口的交换机呢？按这种说法，==带宽仅由站点和交换机共享（每个$5\textrm{Mbps}$）。另外，冲突域也就分为$N$个==。某种程度上，**交换机使得「以太网局域网中的每个站点」都可以让自己获得整个网络的传输能力**。

一个两层交换机`switch`就是一个$N$个端口的网桥，该网桥带有**允许快速处理分组的附加功能**。从桥接以太网到交换式以太网`switchedEthernet`的发展，对于开发更快的以太网是一个大的进步，正如将会看到的那样。图13.17表示一个交换`LAN`。
![图13.17交换式以太网](https://img-blog.csdnimg.cn/4fa63bd3281848ee8177d44aa11665ad.png)

## 13.3.3全双工以太网
==10Base5和10Base2的一个局限，就是**它们的通信是半双工的**，10Base-T（和10Base-F）始终是全双工的==。一个站点要么发送数据要么接收数据，但是不能同时进行。下一步就是从交换式以太网向**全双工交换式以太网**`full-duplexswitchedEthernet`发展。

**全双工模式**将每一个域的能力从$10\textrm{Mbps}$增加到$20\textrm{Mbps}$，**将每个域的传输能力翻倍，并取消了对CSMA/CD访问方法的需求**。图13.18表示了在全双工模式下的交换式以太网。注意，==在全双工模式的交换以太网中，在站点与交换机之间不是使用一条链路，而是使用两条链路：一个用于传送，另一个则用于接收==。
![图13.18全双工交换式以太网](https://img-blog.csdnimg.cn/75f81744deb34c1fb2a83ffa6468d0a9.png)

### 1.不需要CSMA/CD
**在全双工交换式以太网中，不需要CSMA/CD方法**。在一个全双工交换式以太网中，每个站点都是通过两条分离的链路连接到交换机的。==每个站点或交换机，都能够独立地发送或接收、而不必考虑冲突；在站点和交换机之间的每一条链路，都是点到点的专用链路，它们不再需要载波检测，也不再需要冲突检测==。因此，MAC层的工作将变得更加容易，**MAC子层的载波检测和冲突检测的功能可以不要了**。

### 2.MAC控制层
==标准以太网被设计为**在MAC子层的无连接的协议**，没有显式的流量控制和差错控制去通知发送方「帧已经无误地到达目的地」。在接收方接收到帧后，它不必发送肯定或否定的确认==。为了在全双工交换式以太网中，提供流量控制和差错控制，在LLC子层和MAC子层之间，又增加了一个新的子层，叫做**MAC控制层**`MACcontrol`。

---
#13.4快速以太网
设计快速以太网，是为了与诸如`FDDI`或光纤通道等的局域网协议相竞争。IEEE在`802.3u`下创造了快速以太网。**快速以太网是标准以太网的向后兼容**，但是它的传输速度是$100\textrm{Mbps}$，快了$10$倍。快速以太网的目标是：
1.将数据速率升级为$100\textrm{Mbps}$。
2.**使它能与标准以太网兼容**。
3.保留$48$位地址。
4.保留相同的帧格式。
5.保留帧长度的最大值和最小值。
## 13.4.1MAC子层
使以太网从$10\textrm{Mbps}$向$100\textrm{Mbps}$过渡，总的思想是**不触及MAC子层**。但做出的决定是**放弃总线拓扑、而只保留星型拓扑**。在星型拓扑中，正如我们之前介绍的，有两种选择：半双工和全双工。在半双工方法中，站点通过集线器连接；在全双工方法中，通过每个端口都带有缓冲区的交换机来进行连接。

对于半双工方法来说，访问方法是相同的（CSMA/CD）。**对于全双工快速以太网而言，CSMA/CD是不必要的**。然而，==在实现时还是保留了CSMA/CD，以便于和标准以太网向后兼容==。

###自动协商
快速以太网上增加的一个新特性就是**自动协商**`autonegotiation`。它允许一个站点或一个集线器有一定的能力范围。自动协商允许**两个设备协商它们的运行模式和传输速率**。它的设计更是处于以下的考虑：
-**为了使不兼容的设备间相互连接**。例如，最大能力为$10\textrm{Mbps}$的设备，可以和能力为$100\textrm{Mbps}$的（在低速率下工作的）设备通信。
-为了使一种设备有更多的功能。
-为了使一个站点具有检测集线器的能力。

## 13.4.2物理层
快速以太网的物理层比标准以太网复杂得多，随后将简要地加以介绍。
### 1.拓扑结构
快速以太网被设计用来连接两个或两个以上的站点。如果只有两个站点，它们可以是**点到点的连接**。三个或三个以上的站点，就需要中间有一个**集线器或交换机**来连接，呈**星型拓扑结构**。如图13.19所示。
![图13.19快速以太网拓扑](https://img-blog.csdnimg.cn/9ea4acc8fe84467da95bcdf71a6061b7.png)
### 2.实现
快速以太网在物理层的实现方式可分为**两线或四线的**。两线的实现可以是$5$类UTP（100Base-TX）或者光纤（100Base-FX）。而四线的实现则是仅有$3$类UTP（100Base-T4）。如图13.20所示。

![图13.20快速以太网的实现](https://img-blog.csdnimg.cn/612121158bbb4c49afd440ebc95304b6.png)

###3.编码
为了$100\textrm{Mbps}$的传输速率，曼彻斯特编码需要$200$兆波特的带宽，这使得诸如双绞线这样的介质并不合适。因此，快速以太网的设计者寻求了其他可替代的编码/解码方案。然而，==发现对于三种实现而言，一种编码方案的表现并不是同样的好。因此，选择了三种不同的编码方案==（见图13.21）。
![图13.21快速以太网实现的编码](https://img-blog.csdnimg.cn/3c6dcd3890f54162922bf071f9f61891.png)
#### (1)100Base-TX
对于这种实现而言，基于它有很好的带宽性能，选择`MLT-3`编码方案（见[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)）。然而，**`MLT-3`却不是一个自我同步的线编码方案**，故==使用`4B/5B`块编码，通过防止长序列$0$和$1$的出现来实现位的同步==。这将产生$125\textrm{Mbps}$的数据速率，并将其输入`MLT-3`进行编码。

#### (2)100Base-FX
100Base-FX使用两条双光纤。通过使用简单的编码方案，光纤很容易就能满足高带宽的需求。100Base-FX的设计者，为这个实现选用了`NRZ-I`编码方案（见[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)）。然而，**`NRZ-I`对于一长串的$0$（或者$1$，取决于编码）存在位同步的问题**。为解决这一问题，设计者使用了与100Base-TX中相同的`4B/5B`块编码。块编码将比特率从$100\textrm{Mbps}$提高到$125\textrm{Mps}$，但对于光纤而言这很容易解决。

#### (3)100Base-TX
网络能提供$100\textrm{Mbps}$的传输速率，但需要使用$5$类UTP或者STP电缆。这对于已经安装了`voice-gradetwisted-pair(category3)`的建筑物，成本效益较低。一个称为100Base-T4的新标准，是为了使用$3$类或更高的UTP而设计的。为达到传输速度$100\textrm{Mbps}$，这个实现要用四条UTP。

100Base-T4的编码/解码也复杂得多。因为该实现使用$3$类UTP，每条双绞线都不能轻松应对超过$25\textrm{M}$波特的带宽。在这个设计中，在发送和接收之间有一对交换机。然而，三条$3$类UTP也只能处理$75\textrm{M}$波特（每条$25\textrm{M}$波特）。我们需要使用一个编码方案将$100\textrm{Mbps}$转换成$75\textrm{M}$波特的信号。正如[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)中所介绍的，`8B/6T`满足了这一需求。**在`8B/6T`中，$8$个数据元素被编码成$6$个信号元素**。这就意味着$100\textrm{Mbps}$只需要$6/8\times100\textrm{Mbps}$，即$75\textrm{M}$波特。

###4.总结
表13.2是对快速以太网实现的一个总结。
![表13.2快速以太网实现的总结](https://img-blog.csdnimg.cn/66b500c70c7d4376af462263f66280ee.png)

---
#13.5干兆以太网
对传输速度更高的需求，使得千兆以太网$1000\textrm{Mbps}$应运而生。IEEE委员会称之为标准`802.3z`。千兆以太网设计的目标可总结如下：
1.**将数据速率升级到$1$千兆**。
2.**使其与标准以太网或快速以太网相兼容**。
3.使用相同的$48$位地址。
4.使用相同的帧格式。
5.保留帧长度的最大值和最小值。
6.**支持快速以太网中定义的自动协商**。

## 13.5.1MAC子层
有关以太网发展的总的思想是**尽量不触及到`MAC`子层**，但在实现$1\textrm{Gbps}$的速率发送时，这种想法就不现实了。千兆以太网在介质访问方面有两个独特的方法：半双工或全双工方法。**几乎所有的千兆以太网的实现都采用了全双工方法**。然而，这里会==简要地介绍半双工方法，以说明千兆以太网与前几代以太网是可以兼容的==。

## 13.5.2全双工模式、半双工模式
在全双工模式中，有一个**中心交换机**（全双工交换式以太网）将所有的电脑或其他交换机连接起来。每个交换机的每个进入端口都有缓存区，使数据在传输前得以存储。正如之前讨论的那样，**在这种模式中不存在冲突**。也就是说**CSMA/CD是不必要的**。==缺少冲突意味着，电缆长度的最大值取决于电缆中信号的衰减程度，而不是冲突检测过程==。

千兆以太网也能使用半双工模式，虽然事实上很少用到。==在这种情况下，交换机被集线器所替代，集线器作为普通电缆的一部分就可能有冲突产生。**半双工方法使用CSMA/CD**==。然而，正如我们之前所介绍的，**这种方法下，网络的最大长度完全取决于帧大小的最小值**。于是，定义了三种方法：传统方法，载波扩展方怯和帧突发方法。
-**传统方法**：在传统方法中，保留了与传统以太网中**相同的帧长度的最小值**$512$位。然而，==因为在千兆以太网中一位的长度是$10\textrm{Mbps}$以太网中的$1/100$，因此千兆以太网的时隙时间是$512\textrm{bits}\times1/1000μs$，即为$0.512μs$==。时隙时间的减短，意味着能快$100$倍的时间检测到冲突。这就是说**网络的最大长度是$25$米**。这个长度也许对在一个房间内的所有站点是合适的，但也许还不足以长到可以连接一个办公室的所有电脑。
-**载波扩展方法**：**为了适应更长的网络，增加了帧长度的最小值**。载波扩展方法定义的==帧长度的最小值是$512$字节（$4096$位），即长度最小值是以前的$8$倍==。这个方法使得站点给不满$4096$位的帧，增加了扩展位（填充）。在此方法中，网络长度的最大值也扩大了$7$倍，即$200$米。这就允许从集线器到站点的长度可以是$100$米。
-**帧突发方法**：如果要发送的帧都比较短，那么载波扩展方法是非常低效的，因为每个帧都承载了冗余的数据。为了提高效率，提出了帧突发方法。在此方法中，**发送成倍的帧、而不是给每个帧增加扩展**。然而，==为了使成倍的帧看上去像一个帧，要在帧间加以填充（这与载波扩展方法中的一样）而使通道不会空闲下来==。换言之，这个方法使得其他的站点认为「有一个非常大的帧正在传输」。

## 13.5.3物理层
千兆以太网的物理层比标准以太网或者快速以太网的物理层复杂得多。在此仅简要地讨论其中的某些特性。
### 1.拓扑结构
千兆以太网被设计用来连接两个或两个以上的站点。==如果只有两个站点，它们可以是**点到点的连接**。三个或三个以上的站点就需要有一个**集线器或交换机**来连接，呈**星型拓扑结构**==。另一种可行的配置是，将几个星型拓扑连接起来、或使得一个星型拓扑是另一个星型拓扑结构的一部分，如图13.22所示。
![图13.22千兆以太网的拓扑结构](https://img-blog.csdnimg.cn/188af5d8c7e14e44b5e947eb89a3e5fa.png)

### 2.实现
**千兆以太网可以分为两线或四线的实现**。两线的实现使用光纤（1000Base-SX，双光纤和短波激光源或1000Base-LX，双光纤和长波激光源）或STP（1000Base-CX）。四线的实现使用$5$类双绞线电缆（1000Base-T）。换言之，可以有四种实现，如图13.23所示。
![图13.23千兆以太网的实现](https://img-blog.csdnimg.cn/04c5bba243494fe59fcef968f3ee21df.png)
1000Base-T的设计是为了满足某一类用户，这类用户已经为其他诸如快速以太网或电话服务等目的，进行了线路安装。
###3.编码
图13.24描述了这四种实现的编码/解码方案。
![图13.24千兆以太网实现中的编码](https://img-blog.csdnimg.cn/d811b39ea5dd4766afd7d3281b67a4d8.png)
千兆以太网因为涉及的带宽太大（$2\textrm{G}$波特），故不能使用曼彻斯特编码方案。两线实现使用`NRZ`方案，但是`NRZ`无法正确地进行自同步。为了实现位的自同步，特别是为了适应如此高的传输速率，使用了`8B/10B`块编码（见[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)）。==块编码避免了在数据流中出现长串的$0$或$1$==，但产生的数据流是$1.25\textrm{Gbps}$。注意在此实现中，一条线路（光纤或STP）用来发送而另一条用来接收。

在四线实现中，因为每条线路要承载$500\textrm{Mbps}$，这已经超出了$5$类UTP的承载能力，故更不可能让两条线路专门发送而让另两条专门接收。作为一个解决方案，使用了`4D-PAM5`编码方法来减小带宽（见[【计算机网络】第二部分物理层和介质(4)数字传输](https://memcpy0.blog.csdn.net/article/details/122147006)）。该实现中的$4$条线路既用来输出又可用来输入，每条线路承载$250\textrm{Mbps}$，这是在$5$类UTP的承载能力范围内的。
###4.总结
表13.3对千兆以太网的实现作了一个总结。
![表13.3千兆以太网实现的总结](https://img-blog.csdnimg.cn/7e97a4f967ab4d5c8de4d28b0eaa6cbc.png)

## 13.5.410干兆以太网
IEEE委员会创造了$10$千兆以太网并称之为标准`802.3ae`。$10$千兆以太网的设计目标可总结如下：
1.将数据速率提升为$10\textrm{Gbps}$。
2.**使其与标准以太网、快速以太网和千兆以太网相兼容**。
3.使用相同的$48$位地址。
4.使用相同的帧格式。
5.保留帧长度的最大值和最小值。
6.**允许将现有的局域网与城域网`MAN`或广域网`WAN`相互连接**。
7.使得以太网与诸如帧中继和ATM（见第18章）等的技术相兼容。

### 1.MAC子层
**$10$千兆以太网只在全双工模式下运行**，这意味着不存在竞争。$10$千兆以太网也**不使用CSMA/CD**。
### 2.物理层
10千兆以太网物理层的设计目标是**在长距离内使用光纤**。最常见的三种实现是：`10GBase-S,lOGBase-L,10GBase-E`。表13.4是对10千兆以太网实现的总结。
![表13.410千兆以太网实现的总结](https://img-blog.csdnimg.cn/8e233e3ef81440a0bd4708f473cdf527.png)


