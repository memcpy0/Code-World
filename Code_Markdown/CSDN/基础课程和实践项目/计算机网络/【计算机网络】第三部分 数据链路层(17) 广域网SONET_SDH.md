@[toc]

在本章中，介绍一种**广域网** `SONET`，它用做**承载来自其他WAN数据**的传输网络。先把SONET作为一种协议进行讨论，然后说明**如何从协议定义的标准出发，构建SONET网络**。

==光纤电缆的高带宽适用于今天的高数据速率技术（比如视频会议），同时也适用于承载大量低速率技术== `carrying large numbers of lower-rate technologies` 。基于这一原因，随着需要高数据速率或宽带传输的技术的发展，光纤的重要性与日俱增。继而有了标准化的需要。为此，美国组织 `ANSI` 和欧洲组织 `ITU-T` 定义了相应的标准，虽然两种标准是独立的，但是基本功能相似并且最终是兼容的。

`ANSI` 标准称为**同步光纤网络** `Synchronou Optical Network, SONET`,  `ITU-T` 标准称为**同步数字体系** `Synchronous Digital Hierarchy, SDH` 。SONET由 `ANSI` 定义；SDH由 `ITU-T` 定义。==SONET/SDH是使用**同步TDM多路复用**的同步网络，系统中的所有时钟都锁定于主时钟==。

---
# 17.1 体系结构
先介绍SONET系统的体系结构：信号、设备和连接。
## 17.1.1 信号
SONET定义了称为**同步传输信号** `synchronous transport signal, STS` 的**电子信号等级体系**，每个 STS等级（`STS-1` 到 `STS-192`）支持特定的数据速率（以每秒兆位规定），见表17.1。相应的光信号称为**光载波** `optical carrier, OC` 。SDH也规定了一个相似的系统，称为**同步传输模块** `synchronous transport module,  STM` ，STM用于与现存欧洲体系（比如E线路）和STS等级兼容。最后，最低的STM等级 `STM-1` 定义为 $155.520\textrm{Mbps}$ ，正好等同于 `STS-3` 。
![表17.1 SONET/SDH速率](https://img-blog.csdnimg.cn/b63350883f7a4c50b44b5873ecf23516.png)
粗略一看表17.1 ，就能看出一些有趣的地方。首先，这个体系中最低等级的速率是 $51.840\textrm{Mbps}$ ，它比 `DS-3` 服务 $44.736\textrm{Mbps}$  大。实际上，STS-1设计用于等同于 `DS-3` 的速率，同时提供容量上的差异来处理光系统中的开销需要。

其次，STS-3的速率正好是STS-1速率的三倍，STS-9的速率正好是STS-18速率的一半。这些关系意味着 $18$ 个 STS-1 通道能复用成一个STS-18通道，六个STS-3通道能复用成一个STS-18通道，依此类推。

## 17.1.2 SONET设备
图17.1显示了一个使用SONET设备的简单链路。**SONET传输依靠三个基础设备**：STS多路复用器/分离器、再生器、分插复用器和终端。
### 1. STS多路复用器/分离器
STS多路复用器/分离器**标记SONET链路的开始点和结束点**。它们提供了电子支路网络和光网络之间的接口。**STS多路复用器** `STS multiplexer` 复用来自多个电子源的信号，并产生相应的 `OC` 信号。**STS分离器** `STS demultiplexer` 将光 `OC` 信号分解成相应的电子信号。

### 2. 再生器
再生器**扩展了链路的长度**。**再生器** `regenerator` 是个**中继器**（见[【计算机网络】第三部分 数据链路层(15) 连接局域网、主干网和虚拟局域网](https://memcpy0.blog.csdn.net/article/details/122975047)) ，它把接收到的光信号 `OC-n` 解调成相应的电信号 `STS-n` ， 再生成电信号，最后把电信号调制成相应的 `OC-n1` 信号。

SONET再生器用新的信息替换一些现有的开销信息（头部信息）`A SONET regenerator replaces some of the existing overhead information (header information) with new information` 。
 
![图17.1 使用SONET设备的简单网络](https://img-blog.csdnimg.cn/081c3ea63a7e4e018a5ffcfd09fee748.png)
### 3. 分插复用器
分插复用器允许信号的插入和抽取。**分插复用器** `add/drop multiplexer,  ADM` 可以**把来自多个源的STS加到给定路径中**，或是**从某条路径中除去、并重定向所需的信号而无需多路分解整个信号**。分插复用器使用诸如地址和指针（会在后面描述）的头部信息，来确定单个流，而不是依靠时间和位置。

在图17.1所示的简单配置中：
- 多个进入的电子信号输入一个STS多路复用器中，这些信号在多路复用器里组合成一个单一光信号。
- 光信号传输给再生器，在这里重新生成「不带有传输过程中加入的噪声的信号」。
- 从多个源再生的信号输入到一个分插复用器，**分插复用器重新组织这些信号，如果需要，用数据帧中的信息将它们直接发送出去**。
- 这些再次多路复用的信号发送给另一个再生器，然后再发送给接收STS分离器，在这里以接收链路可以接受的格式返回。

### 4. 终端
**终端** `terminal` 是使用SONET网络服务的设备。例如，在因特网中，==终端可以是一个路由器，该路由器需要向SONET网络另一端的另一个路由器发送分组==。
## 17.1.3 连接
前一节定义的设备使用**段、线路和路径**进行连接。
### 1. 段
**段** `section` 是**连接两个相邻设备**（多路复用器到多路复用器、多路复用器到再生器、或再生器到再生器、再生器到多路分离器）**的光链路**。

### 2. 线路
**线路** `line` 是**两个多路复用器之间**（STS多路复用器到分插复用器、两个分插复用器、或两个STS多路复用器）的**网络部分**。
### 3. 路径
**路径** `path` 是**两个STS多路复用器之间的端到端网络部分**。在两个 STS多路复用器直接互连的简单SONET中，段、线路和路径相同。

---
# 17.2 SONET层
SONET标准包括四个功能层：**光子层、段层、线路层和路径层**。它们对应于**物理层和数据链路层**（见图17.2）。各层中加到帧的头部，会在本章后面讨论。
## 17.2.1 路径层
**路径层** `path layer` 负责**信号从它的光信源到光信宿** `optical source to its optical destination` **的移动**。==在光信源，信号从电形式转换成光形式，再与其他信号复用在一起，**封装成帧**。在光信宿，**接收到的帧被多路分解**，然后将单个光信号转换回它们的电形式==。在这一层**增加了路径层开销**。**STS多路复用器提供路径层功能**。
## 17.2.2 线路层
**线路层** `line layer` 负责**信号在物理线路中的移动**。这一层给帧增加线路层开销。**STS多路复用器和分插复用器提供线路层功能**。
![图17.2 SONET层与OSI或因特网层比较](https://img-blog.csdnimg.cn/2301fe10b5554af19f759aac021afd83.png)

## 17.2.3 段层
**段层** `section layer` 负责信号**在物理段中的移动**。它处理**成帧、串扰和差错控制**。在这一层给帧增加段层开销。
## 17.2.4 光子层
**光子层** `photonic layer` 对应于**OSI模型中的物理层**。它包括光纤通道、接收器敏感度、多路复用功能等等的物理规范说明。SONET使用 `NRZ` 进行编码，光存在为 $1$ ，不存在为 $0$ 。
## 17.2.5 设备-层之间的关系
图17.3显示了用于SONET传输的设备和四层标准之间的关系。正如看到的，**STS多路复用器是四层设备，分插复用器是三层设备，再生器是两层设备**。
![图17.3 SONET中的设备-层之间的关系](https://img-blog.csdnimg.cn/d54404c8a3714431a71016c098505093.png)
 
---
# 17.3 SONET帧
**每个同步传输信号 `STS-n` 由 $8 000$ 个帧组成，每个帧是个 $90 \times n$ 列 $9$ 行的两维矩阵**。例如，STS-1帧有 $90$ 列 $\times 9$ 行（$810$ 字节），STS-3有 $270$ 列 $\times 9$ 行（$2430$ 字节）。图17.4显示STS-1和STS-n的一般格式。
 
![图17.4 STS-1和STS-n帧](https://img-blog.csdnimg.cn/18394da0ad614b338f9fa70383fb8b48.png)

## 17.3.1 帧、字节和位传输
SONET的一个有趣的地方是，**每个 `STS-n` 信号以每秒 $8 000$ 个帧的固定速率传输**，即每次传输一个 `STS-n` 信号。这是数字化语音的速率（见[第4章]()）。==对于每个帧，从左向右、从上到下传输字节。对于每个字节，从高位向低位（从左向右）传输位==。图17.5显示了帧传输和字节传输的顺序。
![图17.5 传输中的STS-1帧](https://img-blog.csdnimg.cn/4d16ee359e4f49c9b37a547215053cf2.png)
如果我们对语音信号进行采样，每个样本 $8$ 位（$1$ 个字节），我们可以说，**SONET帧中的每个字节可以携带来自数字化语音通道的信息**。换言之，STS-1信号能同时携带 $774$ 个语音通道（$810$ 减去用于开销所需的字节）。

【例17.1】求STS-1信号的数据速率。
解：STS-1像其他STS信号一样，每秒发送 $8000$ 个帧。每个STS-1帧由  $9 \times (1 \times 90)$ 个字节组成，每个字节由 $8$ 位组成。STS-1数据速率 $= 8000 \times 9 \times (1 \times 90) \times 8 = 51.840\textrm{Mbps}$ 。

【例17.2】求STS-3信号的数据速率。
解：STS-3像其他STS信号一样，每秒发送 $8000$ 个帧。每个STS-3帧由 $9 \times (3 \times 90)$ 个字节组成，每个字节由 $8$ 位组成。STS-3数据速率 $= 8000 \times 9 \times (3 \times 90) \times 8  =155.52\textrm{Mbps}$ 。
 
注意：==在SONET中，不同STS信号之间的数据速率是有确切关系的。我们可以由STS-1的数据速率，求得STS-3的数据速率（前者乘以 $3$）==。即，**在SONET中，STS-n信号的数据速率是STS-1信号数据速率的 $n$ 倍** 。

【例17.3】STS-1帧的周期是多少？STS-3帧呢？STS-n帧呢？
解：在 SONET中，每秒发送 $8 000$ 个帧。==这表示STS-1、STS-3或STS-n帧的周期相同，等于 $1/8000\textrm{s}$ 或 $125\textrm{μs}$== 。

## 17.3.2 STS-1帧格式
STS-1帧的基本格式如图17.6所示。 正如前面所讲到的，SONET帧是 $9$ 行、每行 $90\times 1$ 个字节（$8$ 位），一共 $810$ 个字节的矩阵。
![图17.6 STS-1帧开销](https://img-blog.csdnimg.cn/ff8af709bb584c36a117992cdc300414.png)
该帧的前三列用于**段和线路开销**：前三列的上面三行用于**段开销** `section overhead, SOH` 。下面六行用于**线路开销** `line overhead,  LOH` 。该帧的其他字节称为**同步有效载荷封装** `synchronous payload envelope, SPE` ，它包括用户数据和用户数据级别所需的路径开销 `path overhead,  POH` 。很快就会介绍SPE的格式。
### 1. 段开销
每个段开销由 $9$ 个八位字节组成。这些八位字节的标签 、 功能和组织如图17.7所示。
![图17.7 STS-1帧：段开销](https://img-blog.csdnimg.cn/b5309fe1060c4d6898838187da3292b8.png)
- **对齐字节** `alignment bytes` ：字节 `A1` 和 `A2` 用于实现成帧和同步，称为对齐字节。这些字节向接收器告警有一个帧即将到达， 并给接收器一个预先确定的、用于同步的位模式。**这两个字节的位模式**的十六进制为 $0xF628$ 。这些字节充当标记。
- **奇偶校验字节** `section parity byte` ：字节 `B1` 用于**位交织奇偶校验** `bit interleaved parity, BIP-8` 。**它的值由前一个帧所有字节计算而得**。换言之，这个字节的第 $i$ 位是前一个 `STS-n` 帧的所有字节的第 $i$ 位计算而得的奇偶位。**这个字节的值只放在 `STS-n` 帧中的第一个 `STS-1` 中**。换言之，虽然一个 `STS-n` 帧有 $n$ 个 `B1` 字节（正如在后面看到的），但是只有第一个字节有这个值，其余用 $0$ 填充。
- **标识字节** `identification byte` ：**字节 `C1` 携带了 `STS-1` 帧的标识**。当多个 `STS-1` 帧复用生成更高速率STS帧（`STS-3, STS-9, STS-12` 等）的时候，需要这个字节。**这个字节中的信息，允许在分解时能轻易辨认出各个信号**。例如，在一个STS-3信号中，对应第一个STS-1的 `C1` 字节的值是 $1$ ，第二个是 $2$ ，第三个是 $3$  。
- **管理字节** `management bytes` ：`D1, D2, D3` 字节一起形成一条称为**数据通信通道**的 $192\textrm{kbps}$ 的通道（$3 \times 8000 \times 8$）。这个通道用于操作、管理和维护信令 `operation, administration, and maintenance signaling, OA&M` 。
- **线路序列字节** `order wire byte` ：字节 `E1` 是线路序列字节。在连续帧中的 `E1` 字节，形成了一条 $64\textrm{kbps}$ 通道（每秒的 $8000$ 个帧乘以每个帧的 $8$ 位）。**这个通道用于再生器之间、或终端和再生器之间的通信**。
- **用户字节** `user's byte` ：在连续帧中的 `F1` 字节形成了一条 $64\textrm{kbps}$ 的通道，**保留用于在段层的用户需求**。

注意，每个SONET设备（再生器和多路复用器）都会重新计算段开销。
### 2. 线路开销
线路开销由 $18$ 个字节组成。这些字节的标签、功能和安排如图17.8所示。
![图17.8 STS-1帧线路开销](https://img-blog.csdnimg.cn/f9a4f2ff3ad1479d9558bf1678e4ab79.png)
- **线路奇偶字节** `line parity byte` 。字节 `B2` 用于**位交织奇偶校验**。它用于线路上（两个多路复用器间）帧的差错检测。在一个 `STS-n` 帧中，**为前一个 `STS-1` 帧中的所有字节计算 `B2`** ，并插入到那个帧的 `B2` 字节中。换言之，**在一个 `STS-3` 帧中，有三个 `B2` 字节，每个都是为一个 `STS-1` 帧计算的**。这个字节与段开销中的 `B1` 字节相对应。
- **数据通信通道字节** `data communication channel bytes` 。在连续帧中的线路开销字节 `D4` 到 `D12` ，形成了一条 $576\textrm{kbps}$ 的通道，该通道提供与 `D1-D3` 字节（`OA&M`）一样的服务，但是在线路级别、而不是在段级别（两个多路复用器之间）。
- **线路序列字节** `order wire byte` 。在连续帧中的 `E2` 字节，形成了一条 $64\textrm{kbps}$ 的通道，该通道提供与 `E1` 线路序列字节一样的功能，只是在线路级别。
- **指针字节** `pointer bytes` 。字节 `H1, H2, H3` 是指针。前两个字节用于说明**帧中 SPE的偏移量**，第三个字节**用于证明**。在后面说明这三个字节的用法。
- **自动保护交换字节** `automatic protection switching bytes` 。在连续帧中的 `K1, K2` 字节，形成了一条 $128\textrm{kbps}$ 的通道，用于在线路终止设备 ` line-terminating equipment` 中的问题自动检测。在后面讨论自动保护交换 `APS`  。
- **成长字节** `growth bytes` 。`Z1` 和 `Z2` 字节保留用于将来的使用。

### 3. 同步有效载荷封装（用户数据和路径开销）
**同步有效载荷封装** `synchronous payload envelope, SPE` 包含用户数据、和与用户数据相关的开销（路径开销）。**并不需要将一个SPE恰好放入一个STS-1帧中**，我们很快会看到它可以分成两个帧。这意味着，==**路径开销（SPE的最左列）** 不需要与段开销或线路开销对齐。必须先把路径开销加到用户数据中生成SPE ，然后将SPE插入到一个或两个帧中==。

路径开销由 $9$ 个字节组成。这些字节的标签、功能和安排如图17.9所示。
![图17.9 STS-1帧：路径开销](https://img-blog.csdnimg.cn/b9075f59119a4668b444fde514c7e80e.png)
- **路径奇偶字节** `path parity byte` 。字节 `B3` 用于**位交织奇偶校验**，像 `B1` 和 `B2` 一样，但是是对SPE位 `SPE bits` 进行计算。它实际上是**对流中前一个SPE进行计算**。
- **路径信号标签字节** `path signal label byte` 。字节 `C2` 是路径标识字节。它用于确认「SPE中所携带的数据」在更高层次上（诸如IP或ATM）所使用的不同协议。
- **路径用户通道字节** `path user channel byte` 。连续帧中的 `F2` 字节，像 `F1` 字节一样，形成一条 $64\textrm{kbps}$ 的通道，它保留用于用户需求，但在路径级别。
- **路径状态字节** `path status byte` 。字节 `G1` 由接收方发送给发送方来告知它的状态。当通信为双工时，它在反向通道上发送 `It is sent on the reverse channel when the communication is duplex` 。在本章后面看到它用于线性或环网络。
- **多帧指示** `multiframe indicator` 。字节 `H4` 是多帧指示。它说明无法放入单个帧的有效载荷。例如，**虚拟支路** `virtual tributaries` 可以组合起来形成一个帧，它比SPE帧更大、需要分成几个帧。在下一节讨论虚拟支路。
- **路径跟踪字节** `path trace byte` 。在连续帧中的 `J1` 字节，形成一条用于跟踪路径的 $64\textrm{kbps}$ 的通道。`J1` 字节发送一个连续的 $64$ 字节字符串来验证连接。字符串的选择留给应用程序。接收方会将每个模式与前一个比较，来保证路径层上的通信没有错误。
- **成长字节** `growth bytes` 。字节 `Z3, Z4, Z5` 保留用于将来的使用。

**路径开销只在端到端（在STS多路复用器之间）计算**。
## 17.3.3 开销总结
表17.2比较并总结了段、线路和路径中使用的开销。
![表17.2 SONET/SDH速率](https://img-blog.csdnimg.cn/0d8932af01fc49c19f553d1435b156b2.png)

【例17.4】STS-1帧的用户数据速率是多少（不考虑开销）？
解：一个STS-1帧中的用户数据由 $9$ 行 $86$ 列组成，因此，STS-1用户数据速率 $= 8000 \times 9 \times (1 \times 86) \times 8 = 49.536\textrm{Mbps}$ 。
## 17.3.4 封装
前面的讨论说明了，SPE需要封装在STS-1帧中。封装会产生两个问题，但SONET可以使用指针 `H1` 到 `H3` 很好地处理它们。在本节讨论这些字节的使用。
### 1. 偏移
==SONET允许一个SPE扩展到两个帧，SPE的一部分在第一个帧中，另一部分在第二个帧中==。当要封装的一个SPE与经过的同步帧 `the passing synchronized frames` 在时间上不对齐时，可能会发生这种情况。图17.10显示了这种情况：SPE字节分在两个帧中，字节的第一组封装在第一个帧中，第二组封装在第二个帧中。图中还显示了路径开销，它与任一个帧中的段/线路开销对齐 `which is aligned with the section/line overhead of any frame` 。
![图17.10 SPE相对于帧边界的偏移](https://img-blog.csdnimg.cn/e0c8081977884cb88bf4c1f18e8ff319.png)
问题是，SONET多路复用器如何知道：在帧中哪里是SPE的开始？哪里是结束？解决方法是，**使用指针 `H1` 和 `H2` 来定义SPE的开始**；因为每个SPE有固定个字节数，所以结束可以确定 `the end can be found because each SPE has a fixed number of bytes` 。SONET允许SPE相对于STS-1帧进行偏移 `SONET allows the offsetting of an SPE with respect to an STS-1 frame.` 。

为了找到帧中每个SPE的开始，我们需要线路开销中的两个指针 `H1` 和 `H20` 。注意：**因为封装发生在多路复用器中，这些指针位于线路开销**。图17.11显示这两个字节如何指向SPE的开始 。
![图17.11 使用H1和H2指针来指示SPE在帧中的开始](https://img-blog.csdnimg.cn/241e66b5505d48069e3ee6bde8f35117.png)
注意：**我们需要 $2$ 个字节来定义在帧中一个字节的位置**，一个帧有 $810$ 个字节，因此不能用 $1$ 个字节来定义 。

【例17.5】如果SPE开始于第 $650$ 个字节，那么 `H1` 和 `H2` 的值是多少 ？
解：数字 $650$ 可以表示成 $4$ 个十六进制数字 $0x028A$ 。这表示 `H1` 的值是 $0x02$ ，`H2` 的值是 $0x8A$ 。
### 2. 证明 
证明  `Justification` ：现在假定有效载荷的传输速率与SONET的传输速率有很小的不同。首先，假设有效载荷的速率较高。这意味着有时有 $1$ 个额外的字节无法放入一个帧中。==这种情况下，SONET允许这个额外的字节插入到 `H3` 字节中== `this extra byte to be inserted in the H3 byte` 。现在，假设有效载荷的速率较低。这表示有时帧中需要留空 $1$ 个字节。SONET允许这个字节放在 `H3` 字节的后面 `this byte to be the byte after the H3 byte` 。

---
# 17.4 STS多路复用
**在SONET中，较低速率的帧会同步时分复用成一个更高速率的帧**。例如，三个STS-1信号（通道）可以组合成一个STS-3信号（通道），四个STS-3信号可以多路复用成一个STS-12信号，等等，如图17.12所示。

==在 `SONET`中，多路复用是同步TDM ，网络中的所有时钟都锁定一个主时钟来实现同步==。
![图17.12 STS多路复用/多路分解](https://img-blog.csdnimg.cn/cd8424c76aff4ba399e0612679a9ce66.png)
要提醒的是，多路复用也可以发生在更高的数据速率。例如，四个STS-3信号可以多路复用成一个STS-12信号。但是，**STS-3信号需要先分离成12个STS-1信号**，然后这十二个信号再多路复用成一个STS-12信号。在讨论字节交替后，我们将清楚地了解进行这项额外工作的原因。 
## 17.4.1 字节交替
==在SONET中，同步TDM多路复用通过**字节交替** `byte interleaving` 实现==。例如，当三个STS-1信号多路复用成一个STS-3信号时，STS-3信号中每组 $3$ 个字节与来自每个STS-1信号的 $1$ 个字节相关。图17.13显示了交替。
![图17.13 字节交替](https://img-blog.csdnimg.cn/4f3030f7309e4f0a9743f5323b93afc9.png)
注意：**STS-1帧的字节保持它的行位置（都是 $9$ 行），但是它移到不同的列**。原因是所有信号帧都有相同的行数 $9$ 、而列数改变了 。STS-n信号帧中的列数是STS-1帧中列数的 $n$ 倍 。因此，STS-n帧的一行能够适应STS-1帧的 $n$ 行。

如图17.14所示，**字节交替还保留了相应的段开销和线路开销** 。 ==来自三个 STS-1帧的段开销，交织在一起生成STS-3帧的段开销。线路开销同理。但是，每个通道都保留了用来控制该通道的相应字节==。换言之，段和线路为每个多路复用通道保留它们自己的控制字节。**这个有趣的特性允许分插复用器的使用**，这己简单讨论过。如图所示，有三个 `A1` 字节，每个 `A1` 字节属于三个被复用信号的每一个。同样有三个 `A2` 字节，三个 `A3` 字节。
![图17.14 STS-3帧](https://img-blog.csdnimg.cn/d582de4f48f9417f86262aa0f7d436b3.png)
这里的多路复用比[【计算机网络】第二部分 物理层和介质(6) 带宽利用（复用和扩频）](https://memcpy0.blog.csdn.net/article/details/123059017)描述过的统计TDM容易，因为分离器除去第一个 `A1` 并把它分给第一个STS-1、除去第二个 `A1` 并把它分给第二个STS-1、除去第三个 `A1` 并把它分给第三个STS-1，与字节的功能无关 `with no regard to the function of the bytes` 。换言之，**分离器仅仅处理字节的位置，而不是它们的功能**。

我们已经讲过的段开销和线路开销并不适用于 `does not exactly apply to ` 路径开销。这是因为路径开销是SPE的一部分，SPE可能已经分到两个STS-1帧了。但是，（路径开销的？）字节交替与SPE的数据部分相同。

**字节交替过程使得在更高数据速率下的多路复用稍微复杂一些**。我们如何把四个 STS-3信号多路复用成一个STS-12信号呢？这可以通过两步做到：==首先，必须先分解STS-3信号生成12个STS-1信号，然后这12个 STS-1信号多路复用成一个STS-12信号==。

## 17.4.2 重组信号
在 SONET的正常工作模式中，STS-n信号由 $n$ 个多路复用的STS-1信号组成。有时，==我们有比STS-1数据速率高的信号==。这种情况下，SONET允许生成一个STS-n信号，**它不被看做是 $n$ 个STS-1信号，它是不可以分解成 $n$ 个STS-1信号的一个STS-n信号**（通道）。
![图17.15 重组STS-3c信号](https://img-blog.csdnimg.cn/759cb10e2cd841c39511b4ce58e900b6.png)
为了指明这个信号不能被分解 `the signal cannot be demultiplexed` ，后缀 `c`（用于说明重组 `concatenated signal`）加到信号名后面。例如，STS-3c是不能分解成三个STS-1信号的信号。但是，我们需要知道，**一个STS-3c信号中的整个有效载荷是一个SPE**，这意味着**我们只有一列路径开销**（$9$ 字节）。这种情况使用的数据占用 $260$ 列，如图17.15所示。
### 携带ATM信元的重组信号
在第18章中讨论ATM和ATM信元。**ATM网络是信元网络**，在ATM网络中每个信元有固定长度 $53$ 个字节。**一个STS-3c信号的SPE可以是ATM信元的承载者**。一个STS-3c信号的SPE能携带 $9 \times 260=2 340$ 个字节，这大约于 $44$ 个ATM信元（$53$ 个字节）。
## 17.4.3 分插复用器
==将多个STS-1信号多路复用成一个STS-n信号，是在STS多路复用器中完成的（在路径层）；STS-n信号分离成STS-1信号，是在STS分离器中完成==。但是，在两者之间，SONET使用分插复用器，它可以用一个信号替换另一个信号。我们需要知道**这不是传统意义上的分离/复用**。

**分插复用器工作在线路层，分插复用器不创建段、线路或路径开销**。它几乎作为交换机，它除去一个STS-1信号，加上另一个STS-1信号。**分插复用器的输入和输出的信号类型相同**（比如两个STS-3或两个STS-12）。==分插复用器 `ADM` 只移去相应的字节，然后用新的字节替换它们（包括段开销和线路开销中的字节）==。图17.16显示ADM的工作机制。
![图17.16 在分插复用器中丢弃并加上STS-1帧](https://img-blog.csdnimg.cn/4937cc92042f4e16aa73296298aef610.png)

---
# 17.5 SONET网络
使用SONET设备，我们可以建立一个SONET网络，**它可以用做承载来自诸如ATM（[第18章]()）或IP（[第20章](https://memcpy0.blog.csdn.net/article/details/122375582))负载的高速骨干网**。我们可以大致把SONET分为三类：线状、环状和网状网络 `linear, ring, and mesh networks` ，如图17.17所示。
![图17.17 SONET网络分类](https://img-blog.csdnimg.cn/6b6c3d8c473d4a82afe9604ef5987c6e.png)
## 17.5.1 线状网络
线状SONET网络可以是点到点的，也可以是多点的。
### 1. 点到点网络
点到点网络通常由**一个STS多路复用器、一个STS分离器、$0$ 个或更多没有分插复用器的再生器** `zero or more regenerators with no add/drop multiplexers` 组成，如图17.18所示。信号流可以是单向的、也可以是双向的，虽然图17.18为了简单只显示了单向。
![图17.18 点到点SONET网络](https://img-blog.csdnimg.cn/227086be511a47189f2fc8f688c65302.png)
### 2. 多点网络
**多点网络使用ADM，以允许多个终端间的通信**。 ADM删除「属于与其连接的终端」的信号，并添加从另一个终端发送的信号 `An ADM removes the signal belonging to the terminal connected to it and adds the signal transmitted from another terminal` 。  **每个终端可以发送数据给一个或多个下游终端**。图17.19显示了一个单向方案，在这个方案中每个终端可以只发送数据给下游终端，但多点网络也可以是双向的。

在图17.19中，$T_1$ 同时发送数据给 $T_2$ 和 $T_3$ ，但是 $T_2$ 只能发送数据给 $T_3$ 。该图显示了一个简单的配置，在正常情况下我们可以有多个ADM以及更多的终端。
![图17.19 多点SONET网络](https://img-blog.csdnimg.cn/2307f775e61f4f73ad088a711f6177e1.png)

### 3. 自动保护交换
为了建立保护、对抗线状网络中的故障，SONET定义了**自动保护交换** `automatic protection switching,  APS` 。**线状网络中的APS定义在线路层**，这意味着保护是在两个ADM或一对STS多路复用器/分离器之间。这个主意提供了冗余性。在发生故障的情况下，可以使用一条冗余线路（光纤），**主线路称为工作线路，冗余线路称为保护线路**。

在线状通道中通常有三种保护方案：一加一 、一到一和一到多 `one-plus-one, one-to-one, and one-to-many` 。图17.20显示这三种方案。
![图17.20 线状网络中自动保护交换](https://img-blog.csdnimg.cn/63c5255344fe4d8781bf321187e84133.png)
#### (1) 一加一APS
在这个方案中，通常有两条线路：**一条工作线路和一条保护线路**。==两条线路总是活跃的：发送方的多路复用器在两条线路上都发送相同的数据；接收方多路复用器监控线路，并选择质量更好的那条线路。如果其中一条线路发生故障了，它丢失了信号，接收方会选择另一条线路==。虽然这种方案中会立即恢复故障，但是因为需要两倍带宽，所以这个方案的效率不高。注意：**一加一交换在路径层实现**。
#### (2) 一到一APS
在这个方案中，看起来像一加一方案，**也有一条工作线路和一条保护线路**。但是，==数据通常只在工作线路上发送、直到它发生故障。这时，接收方使用反向线路通知发送方使用保护线路==。很明显，故障恢复比一加一方案慢，但是这个方案效率更高，因为**保护线路只有在工作线路发生故障时、才会用来传输数据**。注意：**一到一交换在线路层实现**。
#### (3) 一到多APS
这个方案与一到一方案相似，不同的是**对于许多条工作线路，它只有一条保护线路**。==当其中一条工作线路发生故障时，保护线路就会接管控制、直到发生故障的线路被修复==。**它没有一到一方案安全**，因为如果多于一条工作线路同时发生故障，保护线路只能替换其中一条。注意：**一到多APS在线路层实现**。
 
## 17.5.2 环状网络
ADM使得SONET环状网络成为可能。SONET环可以用于单向或双向配置。在每种情况下，**我们可以增加一个额外环、使得网络能自我修复线路故障**。
### 1.单向路径交换环
**单向路径交换环** `unidirectional path switching ring,  UPSR` 是有两个环的单向网络：**一个环用做工作环、而另一个用做保护环**。这个主意与在线状网络中讨论过的**一加一APS类似**：相同的信号从两个环都经过，一个顺时针而另一个逆时针。

它称为 `UPSR` ，是因为**监控在路径层实现**——一个节点在路径层接收到电信号的两个复本，比较它们、并选择质量更好的一个。如果两个ADM之间的环发生故障，另一个环仍然能保证数据流的继续。

UPSR像一加一方案一样**有快速的故障恢复**，但是因为需要两个环来完成工作，所以**效率不高，一半的带宽被浪费掉了**。图17.21显示了一个UPSR网络。
![图17.21 单向路径交换网](https://img-blog.csdnimg.cn/b975dffba902451e93cd3413d658d176.png)

虽然在图中选择了一个发送方和三个接收方，但是可以有许多其他配置。发送方使用两路连接来同时发送数据给两个环；接收方使用选择交换机来选择信号质量更好的环。我们使用一个STS多路复用器和三个STS分离器，来强调工作在路径层的节点。

### 2. 双向线路交换环
SONET环状网络的另一个方案是**双向线路交换环** `bidirectional line switching ring,  BLSR` 。这种情况下，**通信是双向的**，这意味着我们需要两个环来作为工作线路。我们还需要两个环作为保护线路。这意味着**BLSR使用四个环**。但是工作机制**与一到一APS方案类似**。

==如果两个节点间一个方向的工作环发生故障，接收方节点可以使用反向环，通知故障方向的上游节点使用保护环==。网络能恢复许多种不同的故障，就不在这讨论了。注意：**BLSR中的故障恢复是在线路层**、而不是在路径层，**ADM发现故障、并通知邻近节点使用保护环**。图17.22显示了一个BLSR环。
![图17.22 单向线路交换环](https://img-blog.csdnimg.cn/3059cc83a2534a4e91d3345e7164820d.png)
### 3. 环的组合
今天，SONET网络使用互连环的组合来提供广大区域的服务。例如，SONET网络可以有一个区域环、多个本地环和许多站点环，来为广大区域提供服务。这些环可以是UPSR、BLSR、或者两者的组合。图17.23显示了这样一个**广域环网络**的概念。
![图17.23 SONET网络中环的组合](https://img-blog.csdnimg.cn/e79fd164326943f18248258c329b4625.png)

## 17.5.3 网状网络
环网络的一个问题是**缺乏扩展性**：==当环中的流量上升时，我们不仅需要升级线路、也需要升级ADM==。这种情况下，有多个交换机的网状网络有可能提供更好的性能。

网状网络中的交换机称为**交叉连接** `cross-connect` 。交叉连接像看到的其他交换机一样，有输入端口和输出端口：
- 在输入端口，交换机接到一个 `OC-n` 信号，把它转换成一个 `STS-n` 信号，再把它分解成相应的 `STS-1` 信号，并把每个 `STS-1` 信号发送给正确的输出端口；
- 输出端口接收到来自不同输入端口的 `STS-1` 信号，把它们多路复用成一个 `STS-n` 信号，并生成一个 `OC-n` 信号传输。

图17.24显示了一个网状SONET网络、以及交换机的结构。
![图17.24 一个网状SONET网络](https://img-blog.csdnimg.cn/442ac59f13064604984ae4d4a850b662.png)

---
# 17.6 虚拟支路
SONET设计用来承载宽带载荷。现在的数字体系的数据速率 `DS-1` 到 `DS-3` 比 `STS-1` 低。为了使SONET**向后兼容** `backward-compatible` 现在的体系（在一条时间轴 $X$ 轴上，向正方向为**向前兼容**，向负方向为**向后兼容**），它的帧设计包括了**虚拟支路** `virtual tributaries, VT` 系统（见图17.25）。

==**虚拟支路是**可以插入到STS-1、并与其他部分有效载荷 `other partial payloads` 组合以填充帧的**部分有效载荷**== `A virtual tributary is a partial payload that can be inserted into an STS-1 and combined with other partial payloads to fill out the frame` 。对于来自同一个源的数据，我们把**同步有效载荷封装** `SPE` 分割开来，并称每一部分为VT，而不是使用STS-1帧的所有 $86$ 个有效载荷列 `all 86 payload columns` 。
## VT类型
已经定义了四种VT类型来适应现在的数字体系（见图17.26）。
![图17.25 虚拟支路](https://img-blog.csdnimg.cn/b0190324b30741ef894fb3ed6598e83a.png)
注意：**每种类型的VT允许的列数** `the number of columns` ，**可以通过将类型标识号翻倍** `doubling the type identification number` 来确定（VT1.5得到 $3$ 列，VT2得到 $4$ 列等等）。
-  VT 1.5适应 `U.S. DS-1` 服务（$1.544\textrm{Mbps}$）
- VT2适应 `European CEPT-1` 服务（$2.048\textrm{Mbps}$）
- VT3适应 `DS-1C` 服务（部分 `DS-1` ，$3.152\textrm{Mbps}$）
- VT6适应 `DS-2` 服务（$6.312\textrm{Mbps}$）
![图17.26 虚拟支路类型](https://img-blog.csdnimg.cn/50babf61b2804ff2b21b224431d76c92.png)

**当两个或更多支路被插入到单个STS-1帧中时，它们逐列交织** `they are
interleaved column by column` 。SONET提供了确定每个VT、并把它们分开而无需分解整个流的机制。这些机制的讨论以及后面的控制问题，超出了范围。
 



