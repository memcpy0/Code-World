技术与工龄
前几天被卷入了一场辩论，起因是有人说四十岁还在写代码便是人生输家。我当然是站在反方的，这年头坐在电脑面前就可以建设社会，既有成就感还能养家糊口的职业有多少？3W咖啡馆里那么多怀揣idea的创业青年，都只差一个程序员就可以改变世界了，还不够你自豪的吗？不过反方提出的一些论据也很不科学，比如吹嘘自己身边的老工程师有多牛多牛，好像工龄长了都能修炼成仙一样。这一点我在刚毕业时就很不以为然，今天就借一个Wireshark案例表达一下我的看法。

这是我刚参加工作不久的事情。当时我还在休假，老板的电话就追杀过来了，说是有位大客户发飙，发来一封措辞极其严厉的邮件，导致我司没有工程师敢再跟他对话了。由于该邮件中贴了很多Wireshark截图，所以老板觉得由我来回应好一些。

虽然有被迫出台的感觉，但我还是仔细读了那封邮件。原来事情是这样的：这位客户买了我司最高端的服务器，可是上线后发现性能不太好，于是就投诉了。我司的技术支持认为瓶颈是在网络上，与服务器无关。客户闻之大怒，说自己已经分析过网络包，发现是**服务器的缓存太小导致的，因为TCP接收窗口最大只有16KB**（如图1方框所示）。
图1
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307091728737.png)
这个截图果然把技术支持镇住了，因为Wireshark是不会骗人的，16KB的确是太小了啊。它意味着客户端每发16KB的数据就不得不停下来等待服务器的Ack，我一台廉价笔记本的接收窗口都不只64KB呢。更糟糕的是，这位在签名档中特意注明了“首席工程师”的客户很不配合，嫌技术支持的资历太浅。整封邮件用词之傲娇，语气之自信，让我等新毕业生望而生畏。说实话，我之前见过的活人中，只有理发师是有首席头衔的。幸好本人脸皮够厚，而且擅长在复杂的纠纷中过滤出纯技术部分。

从Wireshark可见服务器的TCP接收窗口的确很小，这也是客户的论据。**接收窗口太小肯定会影响网络性能。当前网络性能的确是很差**。这个推理过程看起来没有问题，我只能从最初始的论据着手研究了——服务器的接收窗口真的很小吗？仔细分析之后，我发现还真不一定。请看图1底部的Wireshark提示：“window size scaling factor:-1(unknown)”，我当时也不懂是什么意思，只是觉得有必要搞清楚，查了很多文档后才知道里头大有文章。

**在TCP协议刚被发明的时代，全世界的带宽都很小，因此不能一口气向网络中发送大量数据**。基于这个原因，TCP头中只给接收窗口预留了16个比特，这就意味着它最大只能表示 $2^{16}−1=65535$ 字节。随着硬件的革命性进步，网络带宽越来越大，65535字节已经不够用了。那有什么办法可以扩展接收窗口呢？TCP头里是肯定没有多余的空间了，所以RFC1323提供了一个有创意的方案，就是**在三次握手时双方都把一个叫“WindowScale”的值告知对方。对方收到后会把这个值当作2的指数，算出来的值再作为接收窗口的系数。有了这个系数就可以把接收窗口扩展好多倍了**。

理论说起来有点复杂，我们举个实际的例子，图2是三次握手的过程，服务器在2号包中声明它的WindowScale为3，于是客户端收到后就把3作为2的指数，算得 $2^3$ 等于8。**在此后的传输过程中，客户端收到服务器所声明的接收窗口就会自动乘以8**。比如在接下来的3569号包中（见图3），服务器声明其接收窗口为16384，那客户端就知道其**真实的接收窗口**应该是16384×8=131072，从而突破了65535的限制。**Wireshark也是根据三次握手里看到的WindowScale值帮我们计算的**，然后在括号中提示出来（注意，==当你在Wireshark里看到一个括号，那往往意味着其内容是附加提示，而不是网络包本身的内容==）。
图2
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307091730412.png)
图3
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202307091732761.png)
于是问题来了，**如果在三次握手之后才开始抓包会怎么样**？不难想象，==因为Wireshark无从知晓WindowScale的值，所以就无法计算出系数，只好显示出没有系数时的大小==，图1中的“window size scaling factor: -1(unknown)”正好提示了这种情况。这也说明图1显示的“window size scaling factor: -1(unknown)”是因为Wireshark只看到了这个值，但不意味着真实的接收窗口就是16384字节。

客户听了这些分析后恍然大悟，完全忘记我是刚毕业的，很配合地去查他的网路瓶颈了，最后果然发现问题根源和服务器无关。可见只要技术研究得足够深入，资历都可以当作浮云。

现在的我已经不会因为工龄受到歧视了，有些客户甚至要叫我叔叔，但类似遭遇还是会发生在年轻的同事身上。这也不是中国特有的问题，似乎东方文化都特别重视工龄。有一次请日本同事吃饭，才知道他们出电梯时竟然要以“社龄”为顺序，由入职早的“前辈”走在前面。幸好我也算老人了，否则就显得很不礼貌。

也许这也算是对经验的一种尊重吧，但我觉得没必要重视成这样，更不应该歧视新人。**工龄的确可以累积经验，但不一定能提高多少技能**，就像你花足够多的时间也可以把相对论背诵下来，但物理水平不会因此提高多少。我见到过最兢兢业业的老工程师，简直就是一个活体知识库，**遇到很多问题都能在笔记本中翻出解决方案来。可是遇到新问题他就解决不了，因为没有深入钻研问题的习惯，对工具（比如Wireshark）也不感兴趣**。假如这位工程师和一个喜欢动脑筋的应届生应聘同一职位，我会毫不犹豫地选择应届生，**因为专业知识容易补，钻研精神却很难养成**，很可能一年后两个人的水平就差不多，再过一年就被反超了。何况工龄长的人也不一定就经验丰富。在一个职位呆了很多年的人，有可能是因为爱岗敬业，也可能是因为实在太弱了，一直想跳槽却没成功（我又暴露刻薄的本性了）。