> 本文属于「数据库系统学习实践」系列文章之一，这一系列着重于「数据库系统知识的学习与实践」。由于文章内容随时可能发生更新变动，欢迎关注和收藏[数据库系统系列文章汇总目录](https://memcpy0.blog.csdn.net/article/details/119996493)一文以作备忘。需要特别说明的是，为了透彻理解和全面掌握数据库系统，本系列文章中参考了诸多博客、教程、文档、书籍等资料，限于时间精力有限，这里无法一一列出。部分重要资料的不完全参考目录如下所示，在后续学习整理中还会逐渐补充：
> - 数据库系统概念 第六版 `Database System Concepts, Sixth Edition` ，作者是 `Abraham Silberschatz, Henry F. Korth, S. Sudarshan` ，机械工业出版社
> - 数据库系统概论 第五版，王珊 萨师煊编著，高等教育出版社


@[toc]
 
---
# 6. 空值的处理
前面已经多处提到**空值** `NULL` 的概念和处理，这里再系统介绍一下这个问题。==所谓空值就是「不知道」或「不存在」或「无意义」的值==。SQL语言中允许某些元组的某些属性在一定情况下取空值，一般有以下几种情况：
- 该属性应该有一个值，但目前不知道它的具体值。例如，某学生的年龄属性，因为学生登记表漏填了，不知道该学生年龄，因此取空值。
- 该属性不应该有值。例如，缺考学生的成绩为空，因为他没有参加考试。
- 由于某些原因不便于填写。例如，一个人的电话号码不想让大家知道，则取空值。

因此，==空值是一个很特殊的值，含有不确定性==，给关系运算带来特殊的问题，需要做特殊的处理。

## 6.1 空值的产生
插入 `insert into` 和更新 `update` 操作会产生空值，外连接（参见**3.4.2节**）和空值的关系运算也会产生空值。

例79 向 `SC` 表中插入一个元组，学生号是 `201215126` ，课程号是 `1` ，成绩为空。
答：
```sql
insert into SC(Sno, Cno, Grade)
values('201215126', '1', NULL); /* 在插入时该学生还没有考试成绩，取空值 */
```
或
```sql
insert into SC(Sno, Cno, Grade)
values('201215126', '1'); 	    /* 在插入语句中没有赋值的属性，其值为空值 */
```
例80 将 `Student` 表中学生号为 `201215200` 的学生所属的系改为空值。
答：
```sql
update Student
set Sdept = NULL
where Sno = '201215200';
```
## 6.2 空值的判断
判断一个属性的值是否为空值，用 `is NULL`（不能用 `= NULL` 代替）或 `is not NULL` 来表示。

例81 从 `Student` 表中找到漏填了数据的学生信息。
```sql
select *
from Student
where Sname is NULL or Ssex is NULL or Sage is NULL or Sdept is NULL;
```
## 6.3 空值的约束条件
**属性定义（或域定义）中有 `not NULL` 约束条件的不能取空值，加了 `unique` 限制的属性不能取空值，主键属性不能取空值**。
## 6.4 空值的算术运算、比较运算和逻辑运算
**空值与另一个值（包括另一个空值）的算术运算的结果为空值，空值与另一个值（包括另一个空值）的比较运算的结果为 `UNKNOWN`** 。有了 `UNKNOWN` 后，传统的逻辑运算中二值 `(TRUE, FALSE)` 逻辑就扩展成了**三值逻辑**。`AND, OR, NOT` 的真值表如下表所示，其中 `T` 表示 `TRUE` ，`F` 表示 `FALSE` ，`U` 表示 `UNKNOWN` 。
|  `x` | `y` | `x AND y` | `x OR y` | `NOT x`
|:-|:-|:-|:-|:-
| `T` | `T` | `T` | `T` | `F`
| `T` | `U` | `U` | `T` | `F`
| `T` | `F` | `F` | `T` | `F`
|  `U` | `T` | `U` | `T` | `U`
| `U`  | `U` | `U` | `U` | `U`
| `U` | `F` | `F` | `U` | `U`
| `F` | `T` | `F` | `T` | `T`
|  `F` | `U` | `F` | `U` | `T`
| `F` | `F` | `F` | `F` | `T` 

**在查询语句中，只有使 `where` 和 `having` 子句中的选择条件为 `TRUE` 的元组，才被选出作为输出结果**。

例82 找出选修1号课程的不及格的学生。
答：选出的学生是那些参加了考试（`Grade` 属性为非空值）而不及格的学生，不包括缺考的学生。因为前者使条件 `Grade < 60` 的值为 `TRUE` ，后者使条件 `Grade < 60` 的值为 `UNKNOWN` 。
```sql
select Sno
from SC
where Grade < 60 and Cno = '1';
```

例83 找出选修1号课程的不及格的学生，以及缺考的学生。
答：
```sql
select Sno
from SC
where Cno = '1' and (Grade < 60 or Grade is NULL);
```
或
```sql
select Sno
from SC
where Grade < 60 and Cno = '1'
union
select Sno
from SC
where Grade is NULL and Cno = '1';
```
特别地，对于空值，排序时显示的次序由具体系统实现来决定，各个系统的实现可以不同，只要保持一致就行，例如将空值作为最大值来理解。
