
@[toc]
# 一、数据库设计概述

数据库设计是指对于一个**给定的应用环境**，构造设计**最优的数据模型**，然后据此**建立数据库及其应用系统**，使之能够有效地存储数据，满足各种用户的应用需求。

## 1. 数据库设计的目标和特点
数据库设计的目标：
- 满足应用需求；
- 模拟精确程度高；
- 良好的数据库性能。

数据库设计的特点：
-   数据库建设是硬件、软件和干件(技术与管理的界面称为干件)的结合。
-   数据库设计和应用系统设计相结合，在整个设计过程中，要把结构(数据)设计和行为(处理、功能)设计密切结合起来。

## 2. 数据库设计的方法
数据库设计方法众多，按照自动化程度可以分为四类：手工的、设计规则指导的、计算机辅助的、自动的设计方法。在数据库设计历史上比较有影响的有：
1. **新奥尔良设计方法**，认为数据库设计生命期包括：公司要求分析、信息分析和定义、设计实现、物理数据库设计 $4$ 个阶段；
2. **基于3NF的数据库设计方法**：对每一组数据元素推导出 `3NF`	关系，据此画出数据库企业模式，并根据企业模式，选用某种数据模型，得出适应某个DBMS的逻辑模式；
3. **基于E-R方法的数据库设计方法**：首先设计一个企业模式，是现实世界的反映，而与存储组织、存取方法等无关，然后将企业模式变换为某个DBMS的数据模式；
4. **计算机辅助数据库设计方法**：提供一个交互式过程，充分利用计算机性能，完成比较规则、重复性大的设计方法；同时充分发挥设计者的技术和经验，人机结合。
5. **统一建模语言(UML)方法**。一种面向对象的数据库结构设计方法，最适合数据建模、对象建模等。它是一组标准符号的图形表示法，便于表示对象及其复杂关系。

下面将要介绍的、实际使用的设计方法，是由上述的几种方法结合、扩展而来的。

---
# 二、数据库设计的步骤 
1.需求分析阶段：
用户需求的收集和分析，定义数据库应用的主要任务和目标，确定系统范围和边界。结果得到**数据字典**描述的数据需求和**数据流图**描述的处理需求。

2.概念结构设计阶段：
对用户需求进行综合、归纳与抽象，形成一个独立于具体DBMS的概念模型，用E-R图表示。

3.逻辑结构设计阶段：
将概念结构**转换为**某个DBMS所支持的**数据模型**(例如关系模型)，并对其进行优化。

4.物理结构设计阶段：
为逻辑数据模型**选取**一个最适合应用环境的**物理结构**(包括存储结构和存取方法)。

5.数据库实施阶段：
运用DBMS提供的数据语言(例如SQL)及其宿主语言，根据逻辑设计和物理设计的结果**建立数据库**，**编制与调试应用程序**，**组织数据入库**，并进行**试运行**。

6.数据库运行和维护阶段 ：
数据库应用系统经过试运行后即可投入正式运行。在数据库系统运行过程中必须**不断地对其进行评价、调整与修改**。
<img src="https://img-blog.csdnimg.cn/20200504170337102.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="40%">

以上的六个阶段绝非一蹴而就，一个完善的数据库应用系统设计往往是对这六个阶段的不断反复、修改和扩充，是一个螺旋式上升的过程。

# 三、需求分析
需求分析是**非常重要**的一步，它是其他各步的基础，而且也是最困难、最麻烦的一步。原因在于：了解、分析、表达客观世界并不容易。而且，由于这一步和计算机专业业务相距太远，往往被计算机专业人员忽视。所以需特别强调需求分析的重要性。

## 1. 需求分析的任务
通过详细调查现实世界要处理的对象(组织、部门、企业等)，充分了解原系统(手工系统或计算机系统)工作概况，**明确用户的各种需求(数据需求、完整性约束、操作处理、安全性要求等)**，然后在此基础上**确定新系统的任务、目标与功能**。

新系统必须充分考虑今后可能的扩充和改变，不能仅仅按当前应用需求来设计数据库。

最终，要将结果按照一定的格式形成需求说明书。
## 2. 需求分析的重点
 调查、收集与分析用户在数据管理中的**信息要求、处理要求、安全性与完整性要求**。
- 信息要求：用户需要从数据库中获得信息的内容与性质。
- 数据要求：由用户的信息要求可以导出，即在数据库中需要存储哪些数据。
- 处理要求是指用户要求完成什么处理功能，对处理的响应时间有什么要求，处理方式是批处理还是联机处理。


## 3. 需求分析的方法
### (1) 调查用户需求的步骤
<img src="https://img-blog.csdnimg.cn/20200419173510344.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="35%">

其中，确定新系统的边界是指：确定哪些功能由计算机完成，哪些活动由人工完成。前者就是新系统应该实现的功能。

### (2) 常用的调查方法
- 检查文档：查阅原有系统或者实际工作的文档；
- 跟班作业：通过亲自参与业务工作了解业务活动的情况，从而准确了解用户的需求；
- 面谈调研：与用户交谈来了解业务活动和用户需求，必须选择合适的谈话人选，准备的问题涉及面要广，要引导谈话有效进行；
- 开调查会
- 请专人介绍 
- 设计调查表请用户填写


### (3) 需求信息的分析整理
了解用户的需求后，需要进一步分析和表达用户的需求。这主要用到自顶向下的结构化分析方法，即从抽象到具体，从最上层的系统组织机构入手，逐层分解，每层用数据流图和数据字典描述。
 
 如：
<img src="https://img-blog.csdnimg.cn/20200419173530975.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="32%">

<img src="https://img-blog.csdnimg.cn/20200419173535270.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="32%">

## 4. 需求分析的工具
数据库设计过程中，可以利用各种辅助工具进行，需求分析阶段的两个主要工具是数据流图和数据字典。

### (1) 数据流图(DFD—Data Flow Diagram)
DFD用来表示收集到的各业务流程中涉及到的**数据和处理过程**的关系。

数据流图的基本成分：
- 处理：输入数据经过处理变换产生输出数据；需要注明处理的名称；
- 源点和汇点：输入源点和输出汇点；要注明源点和汇点的名称；
- 数据流：含被加工的数据名称，及数据流动方向；
- 数据存储：常代表一个数据表，其中注明表的名称；
<img src="https://img-blog.csdnimg.cn/20200419173543977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="42%">

数据流图(例)：
<img src="https://img-blog.csdnimg.cn/20200419173615999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="40%">

### (2) 数据字典(DD—Data Dictionary)
数据字典是数据库中**数据的描述信息的集合**。DBMS的数据字典是每个DBMS必须提供的功能。

1.数据字典在DBMS中的作用 
（1）满足DBMS**快速查询有关对象**的要求。 
（2）供数据库管理员**掌握整个系统运行的情况**。

2.DBMS数据字典的内容 
（1）数据库系统所有对象及其属性的描述信息。 
（2）数据库系统对象之间关系的描述信息。 
（3）数据安全性、完整性约束条件、数据库日志等。 
（4）记录数据字典变化的历史。 

3.数据库应用系统的数据字典 
   包括：
数据项
数据结构
数据流   
数据存储
处理过程
4.关于数据字典的说明
用来说明或描述系统中数据的静态组成结构。
数据库系统中所有数据的详尽描述，是各类数据属性的清单。
数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善。
 例：下图给出了某机器制造厂的零配件采购子系统的数据流图。该子系统要处理的工作是生产部门提出的生产计划根据零配件当前价格计算成本送主管部门审批，对已批准生产计划制定采购计划，准备好订货单给供应商。
        零配件采购子系统DFD
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020041917364094.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70) 数据项描述＝｛数据项名，数据项含义说明，别名，数据类型，长度， 取值范围，取值含义，与其他数据项的逻辑关系｝

例：数据项名：订货单号
    类型：    CHAR
    长度：    8
    别名：    采购单号
    取值范围：10000000--99999999
    
数据结构是**若干数据项**有意义的**集合**。

 数据结构描述＝｛数据结构名，含义说明，组成:｛数据项或数据结构｝｝

例：数据结构：采购细节
    说明：作为采购计划的组成部分，说明对某个产品要采购哪些零件，哪种零件采购多少数量。
    组成：零件号、零件名、数量
    
  数据流表示加工处理过程的输入或输出数据。

 数据流描述＝｛数据流名，说明，数据流来源，数据流去向，组成:｛数据结构｝，平均流量，高峰期流量｝

例：数据流名：采购计划
    说明：由各产品所需零件数，选定的供应商，审核情况组成采购零配件计划。
    来源：确定采购计划
    去向：编制订货单
    数据结构：--采购细节
              --采购审核
  数据存储是处理过程中要存取的数据。

 数据存储描述＝｛数据存储名，说明，编号，流入的数据流，流出的数据流，组成:｛数据结构｝，数据量，存取方式｝

例：数据存储名：产品
    说明：对每种产品的品名、规格的描述，并对每种产品做成本预算。在核对生产计划书的成本时用。
    输出数据流：预算
    组成：产品号、产品名、预算
    数据量：每月30—40件
    存取方式：随机存取
  处理过程是对加工处理过程的描述。
 处理过程描述＝｛处理过程名，说明，输入:｛数据流｝，输出:｛数据流｝，处理:｛简要说明｝｝
例：处理过程：确定采购计划
    说明：对要采购的每一零件，根据零件库存量确定采购数量，
          再根据每位供应商的报价选择适当的供应商，制定采购
          计划。
    输入：供应商报价、零件库存、已批准生产计划
    输出：采购计划
    简要说明:（1）对应采购的每种零件查找供应商报价表，选
                   择报价最低的供应商号。
             （2）将此供应商号填入应采购零件表的相应列中。

---
# 四、概念结构设计
## 1. 概念结构
概念模型主要特点：    
 - 能反映现实、满足处理要求
 - 易于理解
 - 易于更改
 - 易于数据模型转换

概念结构设计任务：将用户需求抽象为**概念模型**(E-R图)
    
## 2、概念结构设计的方法
- 自顶向下
- 自底向上
- 逐步扩张
- 混合策略

步骤：
<img src="https://img-blog.csdnimg.cn/20200419173716364.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="18%">

自底向上方法步骤：
一、 数据抽象与局部视图设计：根据需求分析的结果（数据流图、数据字典等）对现实世界的数据进行抽象，**设计各个局部视图**，即分E-R图。
   (1) 选择局部应用：可利用机构职能关系进行局部处理。
	(2) 逐一设计分E-R图。设计时注意：实体与属性的划分原则；属性应是系统中最小的信息单位，**不再具有主体性质**；一个实体的属性**不能与其他实体有联系**。          
 
 设计分E-R图和合E-R图的例子如下：
1. 有职工、部门及其相关信息。在“职工”这一实体中，所属部门是职工的一个描述属性；但是在部门E-R图中，“部门”是一个实体；如果要将它们合起来，需要将“职工”实体的部门描述，**改为与“部门”实体的一个联系**。
2. 同理，“病人”实体的病房号和“病房”这一实体，在合并的时候需要将病房号改为联系。 
<img src="https://img-blog.csdnimg.cn/20200419173731163.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%"><img src="https://img-blog.csdnimg.cn/20200419184930354.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%"> 

3.E-R图扩展
下面是对普通E-R图的扩展。

(1) 数据抽象(两种抽象)：
- 聚集：定义了某一类型的组成成分。它抽象了**对象内部类型和成分之间**的“is part of”的语义。 
- 概括(继承)：定义了类型之间的**一种子集联系**。它抽象了类型之间的“is subset of”的语义。
<img src="https://img-blog.csdnimg.cn/20200419184949769.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">

(2) 属性
- 单值属性：用椭圆表示，该属性只有一个值，如出生日期，职工号，姓名等；
- 多值属性：用双椭圆表示，该属性有多于一个值；
- 派生属性：用虚椭圆表示；可以从其他的属性计算得到，如年龄，可以通过出生日期计算出来；
- 复合属性：包含其它属性的属性，如地址属性，它包括 `{省，市，街道，邮编}` 复合而成，其中街道又由 `{街道号，街道名，楼栋号}` 复合而成。
<img src="https://img-blog.csdnimg.cn/20200419184957324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">

(3) 基数：在**相互联系的实体**中，实体出现一次而**可能引起**的另一个实体出现的**最小和最大次数**称为**前一个实体的基数**。如下图，学生和课程存在选课联系，“学生”出现一次(这里是选课)可能引起的课程出现的次数为 $1...6$ ，即最少选一门课，最多选六门课。同理，课程最少没有学生选课，最多可以有 $40$ 个学生选课。
<img src="https://img-blog.csdnimg.cn/20200419185008219.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">

从这里可以看出，基数存在的意义在于**实现数据完整性约束**。

（4）弱实体 
  必须以**另一个实体或多个实体的存在为前提**的实体。用双线矩形框表示。   
<img src="https://img-blog.csdnimg.cn/20200419185015499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">

二、视图集成（全局视图设计）
1. 视图集成概述：局部视图反映局部的数据观点，可能由不同的人员设计，存在**不一致、冲突、信息冗余**等问题，需要通过**集成处理**形成**全局范围内单一**的数据视图。
视图集成的本质是统一与归并：等同、聚合和普遍化。
视图集成的策略：二元集成与 $n$ 元集成。

2. **==合并分E-R图==**，生成初步E-R图：合并的过程实际上是一个**发现冲突和解决冲突**的过程。冲突主要有：
   (1) 属性冲突：属性值类型、取值范围等发生冲突 $\Longrightarrow$ 尽量大的覆盖；
   (2) 命名冲突：同名异义、异名同义 $\Longrightarrow$ 重新命名；
  (3) 结构冲突：
  同一对象在不同视图中**有不同抽象** $\Longrightarrow$  统一为实体或属性；
 同一实体在不同视图中**属性组成不同** $\Longrightarrow$  取并，得到全部的属性；
 **相同实体间的联系**在不同视图中**呈现不同类型** $\Longrightarrow$ 应用语义

3. ==**消除不必要的冗余**==，设计基本E-R图：冗余的**数据**是指可**由基本数据导出的数据**，冗余的**联系**是指可**由其他联系导出的联系**。比如说上面讲过的派生属性。
 (1) 用分析法消除冗余数据。例：实发工资、应发工资
  **==注意：并不是所有的冗余都必须消除。有时为了提高效率，不得不以冗余为代价。==**
 (2) 利用关系规范化理论来消除冗余联系
      ① 确定局部E-R图实体之间的**函数依赖**。 
      ② 求 $F$ 的最小依赖集 $F_m$，求其差集，即 $D=F-F_m$
      ③ 逐一考察 $D$ 中每一函数依赖，确定是否为冗余，若是，就把它去掉。
       
   
例：设计一个工厂产品、零件和材料的基本E-R模型。
- 局部E-R模型设计
 技术部门：关心的是产品的编号、性能、由哪些零件组成，每个零件的零件号、消耗的材料名和数量。
 供销部门：关心的是产品的编号、价格和库存量。
- 初步E-R模型设计
- 基本E-R模型设计
<img src="https://img-blog.csdnimg.cn/20200419185038307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%"><img src="https://img-blog.csdnimg.cn/20200419185049693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%"><img src="https://img-blog.csdnimg.cn/20200419185055555.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">

任务：将基本E-R模型转换为DBMS所支持的数据模型。

关系型逻辑结构设计的步骤：
1) 将概念结构转换为关系模型
2) 优化模型
3) 设计适合DBMS的子模式
<img src="https://img-blog.csdnimg.cn/20200419185107758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">
---
# 五、逻辑结构设计
## 1. E-R模型向关系模型的转换
转换的一般原则：
-  (1) 一个实体型转换为一个关系模式。
-  (2) 一个 $1:1$ 联系可转换为一个**独立的关系模式**，也可**与任一端对应的关系模式合并**。
-  (3) 一个 $1:n$ 联系可转换为一个**独立的关系模式**，也可**与 $n$ 端对应的关系模式合并**。
-  (4) 一个 $m: n$ 联系转换为一个**关系模式**。
-  (5) 三个或三个以上实体间的多元联系可转换为一个关系模式。
-  (6) **相同键**的关系模式可合并。

例子：
<img src="https://img-blog.csdnimg.cn/20200419185151428.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">
对于上图，产生了下面的关系模式：(#为<u>主键</u>)
- P(P#，PP，PC)
- S(S#，SP)
- M(M#，MC)
- L(L#，LC)
- P-S(P#，S#，Q1)
- S-M(S#，M#，Q2) **独立的关系模式不是我们推荐的，这里S-M联系完全可以和 $n$ 方关系模式合并**。
- M-L(M#，L#，Q3)



弱实体的转换：
<img src="https://img-blog.csdnimg.cn/20200419185247782.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="48%">
关系模式：
- 职工（<u>工号</u>，姓名，年龄，性别，职务）
- 亲属（<u>工号</u>，亲属姓名，亲属关系）


 **自联系**的 $1:m$ 关系转换
<img src="https://img-blog.csdnimg.cn/2020041918521922.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="44%">
关系模式：
- 职工（<u>工号</u>，姓名，年龄，性别，职称，领导者工号，民意测验），其中领导者的工号需要改名。

自联系的 $m:n$ 关系转换 
<img src="https://img-blog.csdnimg.cn/20200419185309563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="40%">
关系模式：
- 零件（<u>代号</u>，名称，价格）
- 组装（<u>代号，组装件代号</u>，数量）

**超-子关系转换**

<img src="https://img-blog.csdnimg.cn/20200419185326311.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="40%">

关系模式：(**每个超类和子类**都需要转换为一个关系模式；为查询方便，可**在超类实体表中增加一个指示器属性**，根据指示器的值直接查询子类实体表)
- 职工（<u>职工号</u>，姓名，性别，年龄，参加工作时间）+ 指示器属性
- 飞行员（<u>职工号</u>，飞行时间，健康检查，飞机型号）
- 机械师（<u>职工号</u>，学历，级别，专业职称）
- 管理人员（<u>职工号</u>，职务，职称）


多种属性的转换
<img src="https://img-blog.csdnimg.cn/20200419185334593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width="40%">
职工（职工号，姓名，出生日期，省，市，邮政编码，街道号，街道名，楼栋号）
职工电话（职工号，电话号码）

## 二、数据模型的优化
(1) 分析数据依赖。
(2) 对数据依赖进行极小化处理，**消除冗余的联系**。
(3) 确定各关系模式的范式。
(4) 按照处理要求，对某些模式进行合并或分解。    
(5) 为提高效率和利用率，对关系模式**进一步分解**。

常用的两种分解方法：
- 垂直分解(有公共主键，两个关系的
- 水平分解(通过选择操作，两个关系的型是一样的，行是不一样的)
## 三 、设计用户子模式 
在SQL中就是设计视图！要考虑：系统的使用安全、简便、用户习惯

---

# 六、数据库物理设计

为给定的数据模型选取一个**最适合应用要求**的物理结构的过程。

步骤：
1. 确定DB的**物理结构**(存取方法、存储结构)
2. 评价结构的**时空效率**(取决于DBMS)

目标：设计优化的物理DB结构，使得**响应时间短、空间利用率高、事务吞吐率大**。
      
设计准备：
1、分析数据特性和**面向的应用**。
2、了解DBMS的特性，特别是其**索引机制**和**查询处理**技术。

## 1. 系统存储结构的设计
(1) 确定数据的存放位置
-    将大表采用**水平、垂直分解**的方法存放在**不同磁盘**上。
 -    经常访问的数据为**热点数据**(==局部性原理==)，热点数据可分散到多个磁盘上。
 -    常用的数据保存在高性能的外存上，而数据库备份、日志备份等可放在磁带上。

(2) 确定系统的配置参数：用户数、缓冲区、时间片、数据库大小及对象数、装填因子等。

      
## 2. 创建索引的考虑(关系数据库中重要的问题)
1、是否建索引？—— 索引本身有代价；
2、在哪建索引？
3、是否聚簇？
4、索引维护的代价


1、是否建索引？
不适合建立索引的情况有：
 ① 太小的表。
 ② **不出现**或**很少出现**在**查询条件**中的属性。
 ③ **经常更新**的属性和表。
 ④ **经常查询大部分记录**的属性和表。
 ⑤ 属性值可能**取值的个数很少**的属性（如：性别）。
 ⑥ 属性值**分布严重不均**的属性（如：年龄）。

2、在哪建索引？**WHERE子句中提到的属性**是建索引的候选。
建立索引的一般原则是：
① **主键和外键**上一般建立索引。有利于主键惟一性的检查；有助于参照完整性的检查；可加快以主键和外键为连接条件属性的连接操作。
 ② 若经常**按某列顺序访问**记录，则在该列上建立索引。
 ③ 为**经常有如下情况的列**建立索引
  -  查询
   - ORDER BY
   - GROUP BY
   - DISTINCT
 
 ④ 在**经常作为最大值和最小值**等**聚集函数的列**上建立索引。
 ⑤ 在**经常作为连接操作的连接条件**中出现的列上建立索引。

3、是否聚簇
聚簇是将**相关数据集中存放**的物理存储技术(索引项的次序与数据记录的**次序一致**)，借以**提高I/O的数据命中率**而改善存取速度。==一个表至多建一个聚簇索引==。  

建立聚簇的一般原则是：
 ① **通过聚簇码进行访问或连接**是该关系的主要应用，与聚簇码无关的其他访问很少或者是次要的 。 
 ② 对应每个聚簇码值的**平均元组数既不太少，也不太多**。太少了，聚簇效益不明显，甚至浪费块的空间；太多了，就要采用多个连接块，同样对提高性能不利。
 ③ 聚簇码值**相对稳定**，以减少修改聚簇码值所引起的维护开销。 

# 七、数据库实施与维护
## 1. 数据库实施主要任务 
(1) 定义数据库结构 
(2) 组织数据入库
   - 筛选数据
   - 转换数据格式
   - 输入数据
   - 校验数据

(3) 编制与调试应用程序 
(4) 数据库试运行。  
- 功能测试：即实际运行应用程序，执行对数据库的各种操作，测试应用程序的各种功能。 
- 性能测试：即**测量系统的性能指标**，分析是否符合设计目标。 

## 2. 数据库的维护
**数据库投入运行并不意味着设计过程的终结**，由于应用环境在不断变化，数据库运行过程中物理存储也会不断变化，数据库经常性的维护工作主要是由DBA完成的，它包括：

(1) 数据的转储与恢复
(2) 数据库的安全性、完整性控制 
(3) 数据库的性能监督、分析和改造 
(4) 数据库的重组织与重构造 

1.数据库的转储和恢复
    定期对数据库和日志文件进行备份，以保证一旦发生故障，能利用数据库备份及日志文件备份，尽快将数据库恢复到某种一致性状态，并尽可能减少对数据库的破坏。
2.数据库的安全性、完整性控制
        DBA必须根据用户的实际需要授予不同的操作权限。另外，由于应用环境的变化，数据库的完整性约束条件也会变化，也需要DBA不断修正，以满足用户要求。
3.数据库性能的监督、分析和改进
    目前许多DBMS产品都提供了监测系统性能参数的工具，DBA可以利用
这些工具方便地得到系统运行过程中一系列性能参数的值。DBA应该仔细
分析这些数据，通过调整某些参数来进一步改进数据库性能。
4.数据库的重组织和重构造
    数据库运行一段时间后，由于记录不断增、删、改，会使数据库的物
理存储情况变坏，降低了数据的存取效率，数据库性能下降，这时DBA就要
对数据库进行重组织，或部分重组织（只对频繁增、删的表进行重组织）；
若原有的数据库设计不能满足新的需求，需对数据库结构进行重构造 。
DBMS一般都提供了重组织数据库用的实用程序，帮助DBA重新组织数据库。 
要点
DB设计的基本步骤、各阶段的任务
数据字典的作用
概念结构设计方法
逻辑结构设计方法
关系数据库中提高查询效率的主要方法

单位（单位名，电话）

职工（职员名，姓名，性别，单位名，工程名，开始时间）

工程（工程名，地点）

供应商（姓名，电话）

设备（设备号，设备名，产地）

供应商-工程-设备（工程名，供应商姓名，设备号，设备的数量）


---
# 习题
8.设要建立一个公司数据库，该公司有**多个下属单位**，毎一个单位**有多个职员**，一个职员**仅隶属于一个单位**，且**一个职员在一个工程**中工作，但**一个工程中有很多职员**参加建设，有**多个供应商**为各个工程供应不同设备。
- 单位的属性有：单位名、电话。
- 职员的属性有：职员号、姓名、性别。
- 设备的属性有：设备号、设备名、产地。
- 供应商的属性有：姓名、电话。
- 工程的属性有：工程名、地点。

请完成以下处理：
(1) 设计满足上述要求的E-R图。

(2) 将该E-R图转换为等价的关系模式。

(3) 根据你的理解，用下划线标明毎个关系中的键。



9.有以下运动队和运动会两个方面的实体：
运动队方面有：
- 运动队：队名、教练姓名、队员姓名。
- 队员：队名、队员姓名、性别、项目名。

其中，一个运动队有多个队员，一个队员仅属于一个运动队，一个队仅一个教练。
运动会方面有：
- 运动队：队编号、队名、教练姓名。
- 项目：项目名、参加运动队的编号、队员姓名、性别、比赛场地。
   
 其中，**一个项目有多个运动队参加**，**一个运动员可参加多个项目**，**一个项目一个比赛场地**。

请完成以下设计与分析：
(1) 分别设计运动队和运动会两个局部E-R图。

(2) 将它们合并为一个全局E-R图。

(3) 合并时存在什么冲突？如何解决这些冲突？
