@[toc]

要学习《微机原理与技术》，结果开始就介绍的是 $8086$ 的汇编......啊，麻烦。与其等着老师xjb讲，没有重点，也没有真正的实践，还不如自己动手。

教材是王爽《汇编语言》第三版。学习的是 $8086$， $8086$ 是一个很经典的 CPU，而且学起来比较简单。（学过MIPS后觉得MIPS是真的简洁又优雅）

第一章，对硬件系统结构的问题进行一部分的探讨，打下基础。
> 原则是，以后用到的知识，以后再说。


# 1.1 机器语言

**机器语言是机器指令的集合**。机器指令就是一台机器可以正确执行的命令。

$e.g.$ 指令：01010000 (PUSH AX)，电平脉冲：
<img src="https://img-blog.csdnimg.cn/20200323210034326.png" width = "40%">

$e.g.$ 应用 $8086CPU$ 完成运算：$S = 768 + 12288 – 1280$：
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323210307173.png)
很难看懂，而且出了 $bug$ 很难修。


# 1.2 汇编语言的产生
**汇编语言主要是汇编指令的集合**。

汇编指令和机器指令的**差别在于指令的表示方法上**。汇编指令是机器指令**便于记忆**的书写格式，是机器指令的**助记符**。每一种CPU都有自己的汇编指令集。

相当于 $C$ 的宏定义，把每一条机器指令“定义”了一个好记好用的“宏”。

$e.g.$ 机器指令： 1000100111011000；操作：寄存器BX的内容送到AX中；汇编指令：$MOV AX,BX$。

这样的写法与人类语言接近，**便于阅读和记忆**。

> 寄存器：是CPU中可以**存储数据**的器件，一个CPU中有多个寄存器。AX、BX是两个寄存器的代号。

假设我们使用汇编语言编写程序，那么计算机如何读懂我们的程序呢？
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323210936638.png)作为中介的就是编译器，把汇编指令转换成机器码，这样计算机就可以执行指令了。
# 1.3 汇编语言的组成
汇编语言由以下3类组成：
1、**汇编指令**（机器码的助记符）
2、伪指令   （由编译器执行）
3、其它符号（由编译器识别）

汇编语言的**核心是汇编指令**，它决定了汇编语言的特性。 

---
# 1.4 存储器
$CPU$ 是计算机的核心部件．它控制整个计算机的运作并进行运算，要想让一个 $CPU$ 工作，就必须**向它提供指令和数据**。

CPU可以直接使用的信息——指令和数据在**存储器**中存放，也就是平时所说的内存。我记得在学MIPS时，学了**指令存储器和数据存储器**。

在一台PC机中内存的作用仅次于CPU。离开了内存，性能再好的CPU也无法工作。**磁盘(外存)不是内存**，磁盘上的数据或程序如果不读到内存中，就无法被CPU 使用。 
# 1.5 指令和数据

**指令和数据**是应用上的概念。在内存或磁盘上，**指令和数据没有任何区别，都是二进制信息**。

$e.g.$ 前面提到的例子：$1000100111011000_2$，表示为数据就是 $89D8H$，如果是指令的话，就是 $MOV AX, BX$。

# 1.6 存储单元
**存储器**被划分为**若干个存储单元**，每个存储单元**从0开始**顺序编号；例如： 一个存储器有128个存储单元，编号从 $0 \rightarrow 127$。
<img src="https://img-blog.csdnimg.cn/20200323211639580.png" width = "20%">

下面就是我们对存储器（磁盘/内存）容量的计量单位：（以下用B来代表Byte）：
$$\begin{aligned}
1KB &=1024B\\
1MB &=1024KB\\
1GB&=1024MB\\
1TB&=1024GB
\end{aligned}
$$
 
# 1.7 CPU对存储器的读写
CPU要想进行数据的读写，必须**和外部器件**（标准的说法是芯片）进行三类信息的交互：
- 存储单元的**地址**（地址信息）
- 器件的选择，读或写**命令**（控制信息）
- 读或写的**数据**（数据信息）

那么CPU通过什么将这几类信息传到存储芯片中的呢？计算机能处理、传输的信息都是电信号，电信号当然要用导线传送。

计算机中有专门连接 $CPU$ 和其他芯片的导线，常常称为总线。
- 物理上：一根根导线的集合；
- 逻辑上：分为地址总线；控制总线；数据总线。分别对应那三类信息。

<div align="center">
<img src="https://img-blog.csdnimg.cn/2020032321254811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width = "55%"></div>

 
可是我们如何命令计算机进行数据的读写呢？对于 $8086CPU$，下面的机器码能够完成从3号单元读数据：
- 机器码： 101000000000001100000000
- 含义：从 $3$ 号单元读取数据送入寄存器 $AX$
- 对应的汇编指令：MOV AX,[3]


CPU接收这条机器码后将完成上面所述的读写工作。

---
# 1.8 地址总线
CPU是通过**地址总线**来**指定存储单元**的。地址总线上**能传送多少个不同的信息**，CPU就可以对多少个存储单元进行**寻址**。

比如说 $64$ 位的机器，要有 $64$ 位的 $CPU$、$64$ 位的操作系统和 $64$ 位的软件。
 
<img src="https://img-blog.csdnimg.cn/20200323222427116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width = "30%"> 

一个CPU有 $N$ 根地址总线，则可以说这个CPU的地址总线的宽度为 $N$ 。这样的CPU最多可以寻找 $2^N$ 个内存单元。很显然，地址总线越宽，可寻址的内存单元越多。

顺便说一下，$8080$ 是 $16$ 位地址总线，$8088$ 是 $20$ 位地址总线。
# 1.9 数据总线
CPU与**内存或其它器件**之间的**数据传送**是通过数据总线来进行的。**数据总线的宽度**决定了CPU和外界的**数据传送速度**。

$8080$、$8088$ CPU是 $8$ 位数据总线。传输一个 $16$ 位的数据——比如 $89D8H$，需要传 $2$ 次。
 ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323224752470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70)
 $8086$ 更高级一点，$16$ 位的数据总线，一次就可以传输完毕。
 ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323224835880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70)
# 1.10 控制总线
CPU**对外部器件的控制**是通过控制总线来进行的。在这里控制总线是个总称，**控制总线是一些不同控制线的集合**。有多少根控制总线，就意味着CPU**提供**了对外部器件的多少种控制。

所以，**控制总线的宽度**决定了CPU对外部器件的**控制能力**。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323225028452.png)
内存读或写命令是由几根控制线综合发出的：
- 其中有一根名为**读信号输出控制线**负责由CPU向外传送读信号，CPU 向该控制线上**输出低电平表示将要读取数据**；
- 有一根名为**写信号输出控制线**负责由CPU向外传送写信号。

---
总结：
 每一个CPU芯片都有许多管脚，这些**管脚和总线相连**。也可以说，这些**管脚引出总线**。一个CPU可以**引出三种总线的宽度**，标志了这个CPU的不同方面的性能：
- **地址总线的宽度**决定了CPU的**寻址能力**；
- **数据总线的宽度**决定了CPU**与其它器件进行数据传送**时的一次数据传送量；
- **控制总线宽度**决定了CPU**对系统中其它器件的控制能力**。

---
# 1.11 内存地址空间
什么是内存地址空间呢？一个CPU的地址线宽度为 $10$，那么可以寻址 $1024$ 个内存单元，这 $1024$ 个**可寻到的内存单元就构成这个CPU的内存地址空间**。不过，首先需要介绍两部分基本知识，主板和接口卡。

# 1.12 主板
在**每一台PC机中，都有一个主板**，主板上有核心器件和一些主要器件。这些**器件通过总线（地址总线、数据总线、控制总线）相连**。**扩展插槽**就是其中之一，**上面插有RAM内存条和各类接口卡**。

# 1.13 接口卡
计算机系统中，所有**可用程序**控制其工作的设备，必须受到CPU的控制。但是，**CPU对外部设备不能直接控制**，如显示器、音箱、打印机等。**直接控制这些设备进行工作的是插在扩展插槽上的接口卡**。扩展插槽通过总线与CPU连接，所以，接口卡也通过总线与CPU连接。

==CPU通过总线向接口卡发送命令，接口卡根据CPU的命令控制外设进行工作。==

# 1.14 各类存储器芯片
一台PC上面有多个存储器的芯片：

从**读写属性上**看分为两类：
- 随机存储器（RAM）：可读可写，必须带电存储，关机后存储的内容消失；
- 只读存储器（ROM）：只读不能写，关机后内容不消失。**一般用来存放各种BIOS**。

从**功能和连接上**分类：
- 随机存储器RAM：存放供CPU使用的大部分程序和数据；
- 装有BIOS的ROM：`BIOS(Basic Input/Output System)`，基本输入输出系统。由**主板和各类接口卡**（如：显卡、网卡等）**厂商提供的软件系统**，可以**通过它利用该硬件设备进行最基本的输入输出**。在主板和某些接口卡上插有存储相应BIOS的ROM；
- 接口卡上的RAM
 
   ![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323231807968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70)
# 1.15 内存地址空间
上述的那些存储器在**物理上是独立**的器件。但是它们在以下两点上相同：
- 都和CPU的总线相连；
- CPU对它们进行读或写的时候**都通过控制线发出内存读写命令**。

将各类存储器看作**一个逻辑存储器**：
- 所有的物理存储器被看作**一个由若干存储单元组成的逻辑存储器**；
- ==每个物理存储器在这个逻辑存储器中占有一个地址段，即一段地址空间==；
- CPU在这段地址空间中读写数据，实际上就是**在相对应的物理存储器**中读写数据。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20200324003110650.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70)

假设，上图中的内存空间地址段分配如下：
- 地址 `0~7FFFH` 的 $32KB$ 空间为主随机存储器的地址空间；
- 地址 `8000H~9FFFH` 的 $8KB$ 空间为显存地址空间；
- 地址 `A000H~FFFFH` 的 $24KB$ 空间为**各个ROM的地址空间**，包括显卡、网卡和系统BIOS。

不同的计算机系统的内存地址空间分配情况是不同的。8086PC机的内存地址空间分配如下：

<img src="https://img-blog.csdnimg.cn/20200324003509766.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L215UmVhbGl6YXRpb24=,size_16,color_FFFFFF,t_70" width = "20%">

内存地址空间：
- 最终运行程序的是CPU，我们用汇编编程的时候，必须要从CPU角度考虑问题。
- 对CPU来讲，**系统中的所有存储器中的存储单元都处于一个统一的逻辑存储器中**，它的**容量受CPU寻址能力的限制**。这个逻辑存储器即是我们所说的内存地址空间，它由多个物理上独立的存储器组成。

