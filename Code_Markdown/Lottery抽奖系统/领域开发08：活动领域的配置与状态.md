-   åˆ†æ”¯ï¼š[210911_xfg_activity](https://gitcode.net/KnowledgePlanet/Lottery/-/tree/210911_xfg_activity)
-   æè¿°ï¼šå¼€å‘æ´»åŠ¨é¢†åŸŸéƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼šæ´»åŠ¨åˆ›å»ºã€æ´»åŠ¨çŠ¶æ€å˜æ›´ã€‚ä¸»è¦ä»¥ domain é¢†åŸŸå±‚ä¸‹æ·»åŠ  activity ä¸ºä¸»ï¼Œå¹¶åœ¨å¯¹åº”çš„ service ä¸­æ·»åŠ  deploy(åˆ›å»ºæ´»åŠ¨)ã€partake(é¢†å–æ´»åŠ¨ï¼Œå¾…å¼€å‘)ã€stateflow(çŠ¶æ€æµè½¬) ä¸‰ä¸ªæ¨¡å—ã€‚ä»¥åŠè°ƒæ•´ä»“å‚¨æœåŠ¡å®ç°åˆ°åŸºç¡€å±‚ã€‚

## ä¸€ã€å¼€å‘æ—¥å¿—
-   æŒ‰ç…§ DDD æ¨¡å‹ï¼Œè°ƒæ•´**åŒ…å¼•ç”¨ lottery-infrastructure å¼•å…¥ lottery-domain**ï¼Œè°ƒæ•´åæ•ˆæœ **`é¢†åŸŸå±‚ domain`Â å®šä¹‰ä»“å‚¨æ¥å£ï¼Œ`åŸºç¡€å±‚ infrastructure`Â å®ç°ä»“å‚¨æ¥å£**ã€‚(ä¸Šå±‚å®šä¹‰æ¥å£ï¼Œä¸‹å±‚å®ç°æ¥å£) è€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·ï¼Œdomainå±‚çš„repositoryä¸‹é¢è¿˜æœ‰ä¸ªimplåŒ…â€¦â€¦ç°åœ¨è¿™äº›IXxxRepositoryçš„å®ç°ç±»éƒ½ç§»åŠ¨åˆ°infrastructrureä¸­äº†â€¦â€¦
-   æ´»åŠ¨é¢†åŸŸå±‚éœ€è¦æä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼š**æ´»åŠ¨åˆ›å»ºã€æ´»åŠ¨çŠ¶æ€å¤„ç†å’Œç”¨æˆ·é¢†å–æ´»åŠ¨æ“ä½œ**ï¼Œæœ¬ç« å…ˆå®ç°å‰ä¸¤ä¸ªéœ€æ±‚ï¼Œä¸‹èŠ‚ç»§ç»­å¼€å‘å…¶ä»–åŠŸèƒ½ã€‚
-   æ´»åŠ¨åˆ›å»ºçš„æ“ä½œä¸»è¦ä¼š**ç”¨åˆ°äº‹åŠ¡**ï¼Œå› ä¸ºæ´»åŠ¨ç³»ç»Ÿæä¾›ç»™è¿è¥åå°**åˆ›å»ºæ´»åŠ¨**æ—¶ï¼Œéœ€è¦åŒ…æ‹¬ï¼šæ´»åŠ¨ä¿¡æ¯ã€å¥–å“ä¿¡æ¯ã€ç­–ç•¥ä¿¡æ¯ã€ç­–ç•¥æ˜ç»†ä»¥åŠå…¶ä»–é¢å¤–æ‰©å±•çš„å†…å®¹ï¼Œ**è¿™äº›ä¿¡æ¯éƒ½éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸‹è¿›è¡Œè½åº“**ã€‚
-   æ´»åŠ¨çŠ¶æ€çš„å®¡æ ¸ï¼Œã€1ç¼–è¾‘ã€2æå®¡ã€3æ’¤å®¡ã€4é€šè¿‡ã€5è¿è¡Œ(å®¡æ ¸é€šè¿‡åworkeræ‰«æçŠ¶æ€)ã€6æ‹’ç»ã€7å…³é—­ã€8å¼€å¯ã€‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šç”¨åˆ°**è®¾è®¡æ¨¡å¼ä¸­çš„`çŠ¶æ€æ¨¡å¼`è¿›è¡Œå¤„ç†**ã€‚
- ==ä¸€ä¸ªæ´»åŠ¨å¯ä»¥æœ‰æ´»åŠ¨ç›¸å…³ä¿¡æ¯ã€è¿˜æœ‰å¥–å“é›†åˆä¿¡æ¯ã€ç­–ç•¥ä¿¡æ¯å’Œç­–ç•¥æ˜ç»†é›†åˆï¼Œè¿˜å¯èƒ½å˜æ›´æ´»åŠ¨çŠ¶æ€==ã€‚

```java
package com.memcpy0.lottery.domain.activity.repository;  
  
import com.memcpy0.lottery.domain.activity.model.vo.ActivityVO;  
import com.memcpy0.lottery.domain.activity.model.vo.AwardVO;  
import com.memcpy0.lottery.domain.activity.model.vo.StrategyDetailVO;  
import com.memcpy0.lottery.domain.activity.model.vo.StrategyVO;  
  
import java.util.List;  
  
/**  
 * @description: æ´»åŠ¨ä»“åº“æœåŠ¡(æ´»åŠ¨è¡¨ã€å¥–å“è¡¨ã€ç­–ç•¥è¡¨ã€ç­–ç•¥æ˜ç»†è¡¨)  
 * @author: å°å‚…å“¥ï¼Œå¾®ä¿¡ï¼šfustack  
 * @date: 2021/9/11  
 * @github: https://github.com/fuzhengwei  
 * @Copyright: å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ | åšå®¢ï¼šhttps://bugstack.cn - æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼  
 */  
public interface IActivityRepository {  
  
    /**  
     * æ·»åŠ æ´»åŠ¨é…ç½®  
     * @param activity æ´»åŠ¨é…ç½®  
     */  
    void addActivity(ActivityVO activity);  
  
    /**  
     * æ·»åŠ å¥–å“é…ç½®é›†åˆ  
     *  
     * @param awardList å¥–å“é…ç½®é›†åˆ  
     */  
    void addAward(List<AwardVO> awardList);  
  
    /**  
     * æ·»åŠ ç­–ç•¥é…ç½®  
     *  
     * @param strategy ç­–ç•¥é…ç½®  
     */  
    void addStrategy(StrategyVO strategy);  
  
    /**  
     * æ·»åŠ ç­–ç•¥æ˜ç»†é…ç½®  
     *  
     * @param strategyDetailList ç­–ç•¥æ˜ç»†é›†åˆ  
     */  
    void addStrategyDetailList(List<StrategyDetailVO> strategyDetailList);  
  
    /**  
     * å˜æ›´æ´»åŠ¨çŠ¶æ€  
     *  
     * @param activityId    æ´»åŠ¨ID  
     * @param beforeState   ä¿®æ”¹å‰çŠ¶æ€  
     * @param afterState    ä¿®æ”¹åçŠ¶æ€  
     * @return              æ›´æ–°ç»“æœ  
     */  
    boolean alterStatus(Long activityId, Enum<Constants.ActivityState> beforeState, Enum<Constants.ActivityState> afterState);  
}
```
## äºŒã€æ´»åŠ¨åˆ›å»º
æ´»åŠ¨åˆ›å»ºéœ€è¦å°†ç›¸å…³çš„æ´»åŠ¨é…ç½®ã€å¥–å“åŠå…¶æ˜ç»†é…ç½®ã€ç­–ç•¥åŠå…¶æ˜ç»†é…ç½®
**cn.itedus.lottery.domain.activity.service.deploy.impl.ActivityDeployImpl**
```java
public class ActivityDeployImpl implements IActivityDeploy {

    private Logger logger = LoggerFactory.getLogger(ActivityDeployImpl.class);

    @Resource
    private IActivityRepository activityRepository;

    @Transactional(rollbackFor = Exception.class)
    @Override
    public void createActivity(ActivityConfigReq req) {
        logger.info("åˆ›å»ºæ´»åŠ¨é…ç½®å¼€å§‹ï¼ŒactivityIdï¼š{}", req.getActivityId());
        ActivityConfigRich activityConfigRich = req.getActivityConfigRich();
        try {
            // æ·»åŠ æ´»åŠ¨é…ç½®
            ActivityVO activity = activityConfigRich.getActivity();
            activityRepository.addActivity(activity);

            // æ·»åŠ å¥–å“é…ç½®
            List<AwardVO> awardList = activityConfigRich.getAwardList();
            activityRepository.addAward(awardList);

            // æ·»åŠ ç­–ç•¥é…ç½®
            StrategyVO strategy = activityConfigRich.getStrategy();
            activityRepository.addStrategy(strategy);

            // æ·»åŠ ç­–ç•¥æ˜ç»†é…ç½®
            List<StrategyDetailVO> strategyDetailList = activityConfigRich.getStrategy().getStrategyDetailList();
            activityRepository.addStrategyDetailList(strategyDetailList);

            logger.info("åˆ›å»ºæ´»åŠ¨é…ç½®å®Œæˆï¼ŒactivityIdï¼š{}", req.getActivityId());
        } catch (DuplicateKeyException e) {
            logger.error("åˆ›å»ºæ´»åŠ¨é…ç½®å¤±è´¥ï¼Œå”¯ä¸€ç´¢å¼•å†²çª activityIdï¼š{} reqJsonï¼š{}", req.getActivityId(), JSON.toJSONString(req), e);
            throw e;
        }
    }
    @Override
    public void updateActivity(ActivityConfigReq req) {
        // TODO: éæ ¸å¿ƒåŠŸèƒ½åç»­è¡¥å……
    }
}
```
-  æ´»åŠ¨çš„åˆ›å»ºæ“ä½œä¸»è¦åŒ…æ‹¬ï¼š**æ·»åŠ æ´»åŠ¨é…ç½®ã€æ·»åŠ å¥–å“é…ç½®ã€æ·»åŠ ç­–ç•¥é…ç½®ã€æ·»åŠ ç­–ç•¥æ˜ç»†é…ç½®**ï¼Œè¿™äº›éƒ½æ˜¯**åœ¨åŒä¸€ä¸ªæ³¨è§£äº‹åŠ¡é…ç½®ä¸‹**ï¼Œè¿›è¡Œå¤„ç†Â `@Transactional(rollbackFor = Exception.class)`
- è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œ**å¥–å“é…ç½®å’Œç­–ç•¥é…ç½®éƒ½æ˜¯é›†åˆå½¢å¼çš„**ï¼Œè¿™é‡Œä½¿ç”¨äº† Mybatis çš„**ä¸€æ¬¡æ’å…¥å¤šæ¡æ•°æ®é…ç½®**ã€‚_å¦‚æœä¹‹å‰æ²¡ç”¨è¿‡ï¼Œå¯ä»¥æ³¨æ„ä¸‹ä½¿ç”¨æ–¹å¼_

## ä¸‰ã€çŠ¶æ€å˜æ›´(çŠ¶æ€æ¨¡å¼)
çŠ¶æ€æ¨¡å¼ï¼š**ç±»çš„è¡Œä¸ºæ˜¯åŸºäºå®ƒçš„çŠ¶æ€æ”¹å˜çš„**ï¼Œè¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚å®ƒæè¿°çš„æ˜¯ä¸€ä¸ªè¡Œä¸ºä¸‹çš„å¤šç§çŠ¶æ€å˜æ›´ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸è§çš„ä¸€ä¸ªç½‘ç«™çš„é¡µé¢ï¼Œåœ¨ä½ ç™»å½•ä¸ä¸ç™»å½•ä¸‹å±•ç¤ºçš„å†…å®¹æ˜¯ç•¥æœ‰å·®å¼‚çš„(ä¸ç™»å½•ä¸èƒ½å±•ç¤ºä¸ªäººä¿¡æ¯)ï¼Œè€Œè¿™ç§ç™»å½•ä¸ä¸ç™»å½•å°±æ˜¯æˆ‘ä»¬é€šè¿‡æ”¹å˜çŠ¶æ€ï¼Œè€Œè®©æ•´ä¸ªè¡Œä¸ºå‘ç”Ÿäº†å˜åŒ–ã€‚
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202305250040822.png)
åœ¨ä¸Šå›¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æµç¨‹èŠ‚ç‚¹ä¸­åŒ…æ‹¬äº†å„ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€æ‰­è½¬çš„å…³è”æ¡ä»¶ï¼Œæ¯”å¦‚ï¼›**å®¡æ ¸é€šè¿‡æ‰èƒ½åˆ°æ´»åŠ¨ä¸­**ï¼Œè€Œä¸èƒ½ä»ç¼–è¾‘ä¸­ç›´æ¥åˆ°æ´»åŠ¨ä¸­ï¼Œè€Œ**è¿™äº›çŠ¶æ€çš„è½¬å˜å°±æ˜¯æˆ‘ä»¬è¦å®Œæˆçš„åœºæ™¯å¤„ç†**ã€‚

==å¤§éƒ¨åˆ†ç¨‹åºå‘˜åŸºæœ¬éƒ½å¼€å‘è¿‡ç±»ä¼¼çš„ä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦å¯¹æ´»åŠ¨æˆ–è€…ä¸€äº›é…ç½®éœ€è¦å®¡æ ¸åæ‰èƒ½å¯¹å¤–å‘å¸ƒ==ï¼Œè€Œè¿™ä¸ªå®¡æ ¸è¿‡ç¨‹ï¼Œå¾€å¾€ä¼šéšç€ç³»ç»Ÿçš„é‡è¦ç¨‹åº¦è€Œè®¾ç«‹å¤šçº§æ§åˆ¶ï¼Œæ¥**ä¿è¯ä¸€ä¸ªæ´»åŠ¨å¯ä»¥å®‰å…¨ä¸Šçº¿**ï¼Œé¿å…é€ æˆè¯¯æ“ä½œå¼•èµ·èµ„æŸã€‚

### 1. å·¥ç¨‹ç»“æ„
```java
lottery-domain
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ cn.itedus.lottery.domain.activity
                â”œâ”€â”€ model
                â”œâ”€â”€ repository
                â”‚   â””â”€â”€ IActivityRepository
                â””â”€â”€ service
                    â”œâ”€â”€ deploy
                    â”œâ”€â”€ partake [å¾…å¼€å‘]
                    â””â”€â”€ stateflow
                        â”œâ”€â”€ event
                        â”‚   â”œâ”€â”€ ArraignmentState.java
                        â”‚   â”œâ”€â”€ CloseState.java
                        â”‚   â”œâ”€â”€ DoingState.java
                        â”‚   â”œâ”€â”€ EditingState.java
                        â”‚   â”œâ”€â”€ OpenState.java
                        â”‚   â”œâ”€â”€ PassState.java
                        â”‚   â””â”€â”€ RefuseState.java
                        â”œâ”€â”€ impl
                        â”‚   â””â”€â”€ StateHandlerImpl.java
                        â”œâ”€â”€ AbstractState.java
                        â”œâ”€â”€ IStateHandler.java
                        â””â”€â”€ StateConfig.java
```
-   activity æ´»åŠ¨é¢†åŸŸå±‚åŒ…æ‹¬ï¼šdeployã€partakeã€stateflow
-   stateflow çŠ¶æ€æµè½¬è¿ç”¨çš„çŠ¶æ€æ¨¡å¼ï¼Œä¸»è¦åŒ…æ‹¬**æŠ½è±¡å‡ºçŠ¶æ€æŠ½è±¡ç±»AbstractState å’Œå¯¹åº”çš„ event åŒ…ä¸‹çš„çŠ¶æ€å¤„ç†**ï¼Œæœ€ç»ˆä½¿ç”¨ **StateHandlerImpl æ¥æä¾›å¯¹å¤–çš„æ¥å£æœåŠ¡**ã€‚

### 2. å®šä¹‰æŠ½è±¡ç±»
```java
public abstract class AbstractState {
    @Resource
    protected IActivityRepository activityRepository;

    /**
     * æ´»åŠ¨æå®¡
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * å®¡æ ¸é€šè¿‡
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * å®¡æ ¸æ‹’ç»
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * æ’¤å®¡æ’¤é”€
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * æ´»åŠ¨å…³é—­
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result close(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * æ´»åŠ¨å¼€å¯
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result open(Long activityId, Enum<Constants.ActivityState> currentState);

    /**
     * æ´»åŠ¨æ‰§è¡Œ
     *
     * @param activityId   æ´»åŠ¨ID
     * @param currentState å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result doing(Long activityId, Enum<Constants.ActivityState> currentState);
}
```
-   åœ¨æ•´ä¸ªæ¥å£ä¸­æä¾›äº†**å„é¡¹çŠ¶æ€æµè½¬æœåŠ¡çš„æ¥å£**ï¼Œä¾‹å¦‚ï¼›æ´»åŠ¨æå®¡ã€å®¡æ ¸é€šè¿‡ã€å®¡æ ¸æ‹’ç»ã€æ’¤å®¡æ’¤é”€ç­‰7ä¸ªæ–¹æ³•ã€‚
-   **åœ¨è¿™äº›æ–¹æ³•ä¸­æ‰€æœ‰çš„å…¥å‚éƒ½æ˜¯ä¸€æ ·çš„**ï¼ŒactivityId(æ´»åŠ¨ID)ã€currentStatus(å½“å‰çŠ¶æ€)ï¼Œåªæœ‰ä»–ä»¬çš„å…·ä½“å®ç°æ˜¯ä¸åŒçš„ã€‚


### 3. æå®¡çŠ¶æ€(å…¶ä»–æ›´å¤šçŠ¶æ€å¯ä»¥å‚è€ƒæºç )
```java
@Component
public class ArraignmentState extends AbstractState {

    @Override
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å¾…å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡");
    }

    @Override
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.PASS);
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸é€šè¿‡å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");
    }

    @Override
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.REFUSE);
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸æ‹’ç»å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");
    }

    @Override
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.EDIT);
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸æ’¤é”€å›åˆ°ç¼–è¾‘ä¸­") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");
    }

    @Override
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸å…³é—­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");
    }

    @Override
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");
    }

    @Override
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å¾…å®¡æ ¸æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´");
    }

}
```
-   ArraignmentState **æå®¡çŠ¶æ€ä¸­çš„æµç¨‹**ï¼Œæ¯”å¦‚ï¼šå¾…å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡ã€éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯ã€å¾…å®¡æ ¸æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´ï¼Œè€Œï¼š`å®¡æ ¸é€šè¿‡ã€å®¡æ ¸æ‹’ç»ã€æ’¤é”€å®¡æ ¸ã€æ´»åŠ¨å…³é—­ï¼Œéƒ½å¯ä»¥æ“ä½œ`ã€‚
-   ==é€šè¿‡è¿™æ ·çš„è®¾è®¡æ¨¡å¼ç»“æ„ï¼Œä¼˜åŒ–æ‰åŸæœ¬éœ€è¦åœ¨å„ä¸ªæµç¨‹èŠ‚ç‚¹ä¸­çš„è½¬æ¢ä½¿ç”¨ ifelse çš„åœºæ™¯ï¼Œè¿™æ ·æ“ä½œä»¥åä¹Ÿå¯ä»¥æ›´åŠ æ–¹ä¾¿ä½ è¿›è¡Œæ‰©å±•==ã€‚_å½“ç„¶å…¶å®è¿™é‡Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚å·¥ä½œæµçš„æ–¹å¼è¿›è¡Œå¤„ç†_

#### å…³é—­çŠ¶æ€
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: æ´»åŠ¨å…³é—­çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */@Component  
public class CloseState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯æå®¡");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯å®¡æ ¸é€šè¿‡");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯å®¡æ ¸æ‹’ç»");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯æ’¤é”€å®¡æ ¸");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯é‡å¤å…³é—­");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.OPEN);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å¼€å¯å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å…³é—­ä¸å¯å˜æ›´æ´»åŠ¨ä¸­");  
    }  
  
}
```
#### æ´»åŠ¨ä¸­çŠ¶æ€
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: è¿è¡Œ(æ´»åŠ¨ä¸­)çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */@Component  
public class DoingState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯æå®¡");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯å®¡æ ¸é€šè¿‡");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯å®¡æ ¸æ‹’ç»");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯æ’¤é”€å®¡æ ¸");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å…³é—­æˆåŠŸ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯å¼€å¯");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸­ä¸å¯é‡å¤æ‰§è¡Œ");  
    }  
  
}
```

#### ç¼–è¾‘ä¸­çŠ¶æ€
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: ç¼–è¾‘çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */@Component  
public class EditingState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.ARRAIGNMENT);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨æå®¡æˆåŠŸ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸é€šè¿‡");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸æ‹’ç»");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "ç¼–è¾‘ä¸­ä¸å¯æ’¤é”€å®¡æ ¸");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å…³é—­æˆåŠŸ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "ç¼–è¾‘ä¸­æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´");  
    }  
  
}
```
#### å¼€å¯æ´»åŠ¨
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: æ´»åŠ¨å¼€å¯çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */@Component  
public class OpenState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å¼€å¯ä¸å¯æå®¡");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å¼€å¯ä¸å¯å®¡æ ¸é€šè¿‡");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å¼€å¯ä¸å¯å®¡æ ¸æ‹’ç»");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å¼€å¯ä¸å¯æ’¤é”€å®¡æ ¸");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å…³é—­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨ä¸å¯é‡å¤å¼€å¯");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.DOING);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å˜æ›´æ´»åŠ¨ä¸­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
}
```
#### æ´»åŠ¨å®¡æ ¸é€šè¿‡
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: å®¡æ ¸é€šè¿‡çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */@Component  
public class PassState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å·²å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å·²å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤å®¡æ ¸");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.REFUSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸æ‹’ç»å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å®¡æ ¸é€šè¿‡ä¸å¯æ’¤é”€(å¯å…ˆæ‹’ç»å®¡æ ¸)");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸å…³é—­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.DOING);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å˜æ›´æ´»åŠ¨ä¸­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
}
```
#### æ‹’ç»
```java
package com.memcpy0.lottery.domain.activity.service.stateflow.event;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
import com.memcpy0.lottery.domain.activity.service.stateflow.AbstractState;  
import org.springframework.stereotype.Component;  
  
/**  
 * @description: å®¡æ ¸æ‹’ç»çŠ¶æ€  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0   
 */  
@Component  
public class RefuseState extends AbstractState {  
  
    @Override  
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å·²å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡");  
    }  
  
    @Override  
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å·²å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤å®¡æ ¸");  
    }  
  
    @Override  
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "æ´»åŠ¨å®¡æ ¸æ‹’ç»ä¸å¯é‡å¤å®¡æ ¸");  
    }  
  
    @Override  
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.EDIT);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ’¤é”€å®¡æ ¸å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result close(Long activityId, Enum<Constants.ActivityState> currentState) {  
        boolean isSuccess = activityRepository.alterStatus(activityId, currentState, Constants.ActivityState.CLOSE);  
        return isSuccess ? Result.buildResult(Constants.ResponseCode.SUCCESS, "æ´»åŠ¨å®¡æ ¸å…³é—­å®Œæˆ") : Result.buildErrorResult("æ´»åŠ¨çŠ¶æ€å˜æ›´å¤±è´¥");  
    }  
  
    @Override  
    public Result open(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");  
    }  
  
    @Override  
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentState) {  
        return Result.buildResult(Constants.ResponseCode.UN_ERROR, "å®¡æ ¸æ‹’ç»ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸ºè¿›è¡Œä¸­");  
    }  
}
```
### 4. çŠ¶æ€æµè½¬é…ç½®æŠ½è±¡ç±»
```java
public class StateConfig {
    @Resource
    private ArraignmentState arraignmentState;
    @Resource
    private CloseState closeState;
    @Resource
    private DoingState doingState;
    @Resource
    private EditingState editingState;
    @Resource
    private OpenState openState;
    @Resource
    private PassState passState;
    @Resource
    private RefuseState refuseState;

    protected Map<Enum<Constants.ActivityState>, AbstractState> stateGroup = new ConcurrentHashMap<>();

    @PostConstruct
    public void init() {
        stateGroup.put(Constants.ActivityState.ARRAIGNMENT, arraignmentState);
        stateGroup.put(Constants.ActivityState.CLOSE, closeState);
        stateGroup.put(Constants.ActivityState.DOING, doingState);
        stateGroup.put(Constants.ActivityState.EDIT, editingState);
        stateGroup.put(Constants.ActivityState.OPEN, openState);
        stateGroup.put(Constants.ActivityState.PASS, passState);
        stateGroup.put(Constants.ActivityState.REFUSE, refuseState);
    }

}
```
-   **åœ¨çŠ¶æ€æµè½¬é…ç½®ä¸­ï¼Œå®šä¹‰å¥½å„ä¸ªæµè½¬æ“ä½œ**ã€‚

==ç›®å‰å¥½åƒéƒ½æ˜¯ç”¨è¿™ç§æ–¹å¼å®ç°çš„å„ä¸ªé…ç½®ç±»ï¼Œæ¯”å¦‚DrawConfigï¼ˆé…ç½®å¤šä¸ªæŠ½å¥–ç®—æ³•ï¼‰ã€GoodsConfigï¼ˆé…ç½®å¤šä¸ªå­ç±»å‘å¥–å¯¹è±¡ï¼‰==ã€‚
### 5. å®ç°çŠ¶æ€å¤„ç†æœåŠ¡
```java
package com.memcpy0.lottery.domain.activity.service.stateflow;  
  
import com.memcpy0.lottery.common.Constants;  
import com.memcpy0.lottery.common.Result;  
  
/**  
 * @description: çŠ¶æ€å¤„ç†æ¥å£  
 * @author: memcpy0ï¼Œå¾®ä¿¡ï¼šmemcpy0  
 */public interface IStateHandler {  
  
    /**  
     * æå®¡  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result arraignment(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * å®¡æ ¸é€šè¿‡  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result checkPass(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * å®¡æ ¸æ‹’ç»  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * æ’¤é”€å®¡æ ¸  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * å…³é—­  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result close(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * å¼€å¯  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result open(Long activityId, Enum<Constants.ActivityState> currentStatus);  
  
    /**  
     * è¿è¡Œæ´»åŠ¨ä¸­  
     * @param activityId    æ´»åŠ¨ID  
     * @param currentStatus å½“å‰çŠ¶æ€  
     * @return              å®¡æ ¸ç»“æœ  
     */  
    Result doing(Long activityId, Enum<Constants.ActivityState> currentStatus);  
}
```

```java
@Service
public class StateHandlerImpl extends StateConfig implements IStateHandler {

    @Override
    public Result arraignment(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).arraignment(activityId, currentStatus);
    }

    @Override
    public Result checkPass(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).checkPass(activityId, currentStatus);
    }

    @Override
    public Result checkRefuse(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).checkRefuse(activityId, currentStatus);
    }

    @Override
    public Result checkRevoke(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).checkRevoke(activityId, currentStatus);
    }

    @Override
    public Result close(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).close(activityId, currentStatus);
    }

    @Override
    public Result open(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).open(activityId, currentStatus);
    }

    @Override
    public Result doing(Long activityId, Enum<Constants.ActivityState> currentStatus) {
        return stateGroup.get(currentStatus).doing(activityId, currentStatus);
    }

}
```
-   åœ¨çŠ¶æ€æµè½¬æœåŠ¡ä¸­ï¼Œæ ¹æ®**å½“å‰çŠ¶æ€**ã€åœ¨Â **`çŠ¶æ€ç»„ stateGroup`**Â è·å–å¯¹åº”çš„**çŠ¶æ€å¤„ç†æœåŠ¡**ï¼Œæ“ä½œå˜æ›´çŠ¶æ€ï¼Œè¿”å›å˜æ›´ç»“æœã€‚

## ä¸‰ã€æµ‹è¯•éªŒè¯(æ´»åŠ¨åˆ›å»º)
**å•å…ƒæµ‹è¯•**
**cn.itedus.lottery.test.domain.ActivityTest**
```java
@Before
public void init() {
    ActivityVO activity = new ActivityVO();
    activity.setActivityId(activityId);
    activity.setActivityName("æµ‹è¯•æ´»åŠ¨");
    activity.setActivityDesc("æµ‹è¯•æ´»åŠ¨æè¿°");
    activity.setBeginDateTime(new Date());
    activity.setEndDateTime(new Date());
    activity.setStockCount(100);
    activity.setTakeCount(10);
    activity.setState(Constants.ActivityState.EDIT.getCode());
    activity.setCreator("xiaofuge");

    StrategyVO strategy = new StrategyVO();
    strategy.setStrategyId(10002L);
    strategy.setStrategyDesc("æŠ½å¥–ç­–ç•¥");
    strategy.setStrategyMode(Constants.StrategyMode.SINGLE.getCode());
    strategy.setGrantType(1);
    strategy.setGrantDate(new Date());
    strategy.setExtInfo("");

    StrategyDetailVO strategyDetail_01 = new StrategyDetailVO();
    strategyDetail_01.setStrategyId(strategy.getStrategyId());
    strategyDetail_01.setAwardId("101");
    strategyDetail_01.setAwardName("ä¸€ç­‰å¥–");
    strategyDetail_01.setAwardCount(10);
    strategyDetail_01.setAwardSurplusCount(10);
    strategyDetail_01.setAwardRate(new BigDecimal("0.05"));

    StrategyDetailVO strategyDetail_02 = new StrategyDetailVO();
    strategyDetail_02.setStrategyId(strategy.getStrategyId());
    strategyDetail_02.setAwardId("102");
    strategyDetail_02.setAwardName("äºŒç­‰å¥–");
    strategyDetail_02.setAwardCount(20);
    strategyDetail_02.setAwardSurplusCount(20);
    strategyDetail_02.setAwardRate(new BigDecimal("0.15"));
    
    // ...

} 
@Test
public void test_createActivity() {
    activityDeploy.createActivity(new ActivityConfigReq(activityId, activityConfigRich));
}
```
-   è¿™ä¸€éƒ¨åˆ†æŒ‰ç…§è‡ªå·±çš„éœ€è¦é…ç½®è¿è¡Œå³å¯ï¼Œè¿è¡Œåæ£€æŸ¥æ—¥å¿—å’Œæ•°æ®åº“è¡¨ï¼šActivityã€Awardã€Strategyã€StrategyDetail


## å››ã€æµ‹è¯•éªŒè¯(çŠ¶æ€æµè½¬)
**å•å…ƒæµ‹è¯•**
**cn.itedus.lottery.test.domain.ActivityTest**
```java
@Test
public void test_alterState() {
    logger.info("æäº¤å®¡æ ¸ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.arraignment(100001L, Constants.ActivityState.EDIT)));
    logger.info("å®¡æ ¸é€šè¿‡ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.checkPass(100001L, Constants.ActivityState.ARRAIGNMENT)));
    logger.info("è¿è¡Œæ´»åŠ¨ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.doing(100001L, Constants.ActivityState.PASS)));
    logger.info("äºŒæ¬¡æå®¡ï¼Œæµ‹è¯•ï¼š{}", JSON.toJSONString(stateHandler.checkPass(100001L, Constants.ActivityState.EDIT)));
}
```
æµ‹è¯•éªŒè¯ä¹‹å‰å…ˆè§‚å¯Ÿä½ çš„æ´»åŠ¨æ•°æ®çŠ¶æ€ï¼Œå› ä¸ºåç»­ä¼šä¸æ–­çš„å˜æ›´è¿™ä¸ªçŠ¶æ€ï¼Œä»¥åŠå˜æ›´å¤±è´¥æé†’ã€‚Â **æ³¨æ„è¦è®¾ç½®ä¸º $1$** ï¼š
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202305260044063.png)
-   ä»ç¼–è¾‘çŠ¶æ€ï¼ˆå½“å‰æ´»åŠ¨å¤„äºç¼–è¾‘çŠ¶æ€ï¼Œè·å–åˆ°ç¼–è¾‘çŠ¶æ€çš„æœåŠ¡å¤„ç†ç±»ï¼Œè°ƒç”¨å…¶æå®¡æ–¹æ³•ï¼Œå°è¯•æ”¹å˜åˆ°æå®¡çŠ¶æ€ï¼‰åˆ°æå®¡çŠ¶æ€
-   ä»æå®¡çŠ¶æ€åˆ°å®¡æ ¸é€šè¿‡
-   ä»å®¡æ ¸é€šè¿‡åˆ°æ´»åŠ¨è¿è¡Œï¼Œä¹Ÿå°±æ˜¯æ´»åŠ¨ä¸­
-   æ¥ä¸‹æ¥å†äºŒæ¬¡æå®¡ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å®¡æ ¸
![](https://image-1307616428.cos.ap-beijing.myqcloud.com/Obsidian/202305260049652.png)

**æµ‹è¯•ç»“æœ**
```
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : æäº¤å®¡æ ¸ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨æå®¡æˆåŠŸ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : å®¡æ ¸é€šè¿‡ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨å®¡æ ¸é€šè¿‡å®Œæˆ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : è¿è¡Œæ´»åŠ¨ï¼Œæµ‹è¯•ï¼š{"code":"0000","info":"æ´»åŠ¨å˜æ›´æ´»åŠ¨ä¸­å®Œæˆ"}
INFO 13743 --- [main] c.i.lottery.test.domain.ActivityTest     : äºŒæ¬¡æå®¡ï¼Œæµ‹è¯•ï¼š{"code":"0001","info":"ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸é€šè¿‡"}
```
-   ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå¤„äºä¸åŒçŠ¶æ€ä¸‹çš„çŠ¶æ€æ“ä½œåŠ¨ä½œå’Œåé¦ˆç»“æœã€‚

---

1.  æ³¨æ„ domainã€lottery-infrastructureï¼ŒåŒ…ç»“æ„è°ƒæ•´ï¼Œæ¶‰åŠåˆ° POM é…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œ**åœ¨ lottery-infrastructure å¼•å…¥ domain çš„ POM é…ç½®**
2.  Activity æ´»åŠ¨é¢†åŸŸç›®å‰åªå¼€å‘äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œéœ€è¦æ³¨æ„**å¦‚ä½•è€ƒè™‘æŠŠæ´»åŠ¨ä¸€ä¸ªç±»æ€è€ƒğŸ¤”å‡ºéƒ¨ç½²æ´»åŠ¨ã€é¢†å–æ´»åŠ¨å’ŒçŠ¶æ€æµè½¬çš„è®¾è®¡å®ç°**
3.  ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„æ´»åŠ¨åˆ›å»ºè¿˜æ²¡æœ‰ä¸€ä¸ªæ´»åŠ¨å·çš„è®¾è®¡ï¼Œä¸‹ç« æ¶‰åŠåˆ°æ´»åŠ¨IDç­–ç•¥ç”Ÿæˆä»¥åŠé¢†å–æ´»åŠ¨çš„å•å·IDç”Ÿæˆã€‚